<!doctype html>
<html class="no-js" lang="zh-CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="更改基准和投影" href="changing.html" /><link rel="prev" title="先决条件" href="pre-req.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>读取和写入地理空间数据 - python地理空间开发 1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyles.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">python地理空间开发 1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">python地理空间开发 1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">内容</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_author.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_reviewers.html">审稿人简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch1/index.html">1 使用 Python 进行地理空间开发</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch1/python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/geo_dev.html">地理空间开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/applications.html">地理空间开发的应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/recent_dev.html">最新动态</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch2/index.html">2 GIS</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch2/core_concepts.html">核心 GIS 概念</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/gis_data_format.html">GIS 数据格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/working.html">手动处理 GIS 数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch3/index.html">3 用于地理空间开发的 Python 库</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch3/rw.html">读取和写入地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/dealing_proj.html">处理投影</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/analyzing.html">分析和处理地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/visualizing.html">可视化地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch4/index.html">4 地理空间数据来源</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch4/vector_format.html">矢量格式的地理空间数据来源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/raster_format.html">栅格格式地理空间数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/other_format.html">其他类型地理空间数据的来源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/choosing_format.html">选择地理空间数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">5 使用 Python 处理地理空间数据</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pre-req.html">先决条件</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">读取和写入地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="changing.html">更改基准和投影</a></li>
<li class="toctree-l2"><a class="reference internal" href="representing.html">表示和存储地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="performing.html">执行地理空间计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="converting.html">转换和标准化几何和距离单位</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercises.html">练习</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch6/index.html">6 数据库中的 GIS</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch6/spatially.html">空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/spatially-indexes.html">空间索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/open-source.html">支持空间功能的开源数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/commerical.html">商业空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/recommended.html">建议的最佳做法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/working.html">使用 Python 处理地理空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch7/index.html">7 使用空间数据</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch7/about-distal.html">关于 DISTAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/designing.html">设计和构建数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/downloading.html">下载数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/importing-data.html">导入数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/implementing.html">实现 DISTAL 应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/aplication.html">应用程序审查和改进</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch8/index.html">8 使用 Python 和 Mapnik 生成地图</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch8/introducing.html">Mapnik 简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/creating.html">创建示例地图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mapnik.html">Mapnik 深度介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mapgenerator.html">重新审视 MapGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mapdefinition.html">地图定义文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch9/index.html">9 整合所有要素——完整的地图系统</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch9/about-shapeditor.html">关于 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/designing-shape.html">设计 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/prerequisites.html">先决条件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/the-structure-ofdjango.html">Django 应用程序的结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/settingup-database.html">设置数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/settingup-shapeeditor.html">设置 ShapeEditor 项目</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/defining-shapeditor.html">定义 ShapeEditor 的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/creating-shared.html">创建共享应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/defining-datamodel.html">定义数据模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/playing.html">玩转管理系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch10/index.html">10 ShapeEditor – 实现列表视图、导入和导出</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch10/implementing.html">实现“列出 Shapefile”视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/importing.html">导入 Shapefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/exporting.html">导出 shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch11/index.html">11 ShapeEditor – 选择和编辑特征</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch11/selecting.html">选择要编辑的要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/editring.html">编辑要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/adding.html">添加要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/deleting.html">删除要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/deleting-shapefiles.html">删除 shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/using.html">使用 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/further.html">进一步改进和增强</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/summary.html">小结</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="id1">
<h1>读取和写入地理空间数据<a class="headerlink" href="#id1" title="此标题的永久链接">#</a></h1>
<p>Reading and writing geospatial data</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>在本节中，我们将查看一些您可能想要执行的任务示例，这些任务涉及读取和写入矢量和栅格格式的地理空间数据。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>In this section, we will look at some examples of tasks you might want to perform
which involve reading and writing geospatial data in both vector and raster format.</p>
</div>
</div>
<section id="id2">
<h2>任务 – 计算世界上每个国家的边界​​框<a class="headerlink" href="#id2" title="此标题的永久链接">#</a></h2>
<p>Task – calculate the bounding box for each country in the world</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>在这个稍微做了些处理的示例中，我们将利用一个shapefile来计算每个国家的最小和最大经纬度值。这些“边界框”可以用于生成特定国家的地图。例如，土耳其的边界框将如下所示：</p>
<a class="with-border reference internal image-reference" href="../_images/129-0.png"><img alt="../_images/129-0.png" class="with-border align-center" src="../_images/129-0.png" style="width: 787.5px; height: 277.9px;" /></a>
<p>首先，从以下地址下载世界边界数据集：</p>
<p>[<a class="reference external" href="http://thematicmapping.org/downloads/world_borders.php](http://thematicmapping.org/downloads/world_borders.php">http://thematicmapping.org/downloads/world_borders.php](http://thematicmapping.org/downloads/world_borders.php</a>)</p>
<p>解压.zip文件，并将构成shapefile的各个文件（.dbf、.prj、.shp 和 .shx 文件）放置在合适的目录中。</p>
<p>接下来，我们需要创建一个Python程序，读取每个国家的边界。幸运的是，使用OGR读取shapefile的内容是非常简单的：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>

<span class="n">shapefile</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;TM_WORLD_BORDERS-0.3.shp&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>特征由 <strong>几何形状</strong> 和一组 <strong>字段</strong> 组成。对于这个数据，几何形状是定义国家边界的多边形，而字段包含有关国家的各种信息。根据 <em>Readme.txt</em> 文件，shapefile中的字段包括国家的ISO-3166三字母代码（在名为ISO3的字段中）以及国家的名称（在名为NAME的字段中）。这样我们可以通过以下方式获取国家的代码和名称：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countryCode</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;ISO3&quot;</span><span class="p">)</span>
<span class="n">countryName</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>我们还可以使用以下方法获取国家的边界多边形：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
</pre></div>
</div>
<p>我们可以对这个几何形状做很多操作。例如，我们可以计算几何形状的质心、测试某点是否位于多边形内，或将多边形转换为WKT格式。然而，在这个例子中，我们想要获取多边形的边界框或**外包络**。我们可以通过以下方式来实现：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>
</pre></div>
</div>
<p>让我们把这些内容整合成一个完整的工作程序：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># calcBoundingBoxes.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>

<span class="n">shapefile</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;TM_WORLD_BORDERS-0.3.shp&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">countries</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># 存储 (code, name, minLat, maxLat, minLong, maxLong) 元组的列表。</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">countryCode</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;ISO3&quot;</span><span class="p">)</span>
    <span class="n">countryName</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>

    <span class="n">countries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">countryName</span><span class="p">,</span> <span class="n">countryCode</span><span class="p">,</span>
                        <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">))</span>

<span class="n">countries</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) lat=</span><span class="si">%0.4f</span><span class="s2">..</span><span class="si">%0.4f</span><span class="s2">, long=</span><span class="si">%0.4f</span><span class="s2">..</span><span class="si">%0.4f</span><span class="s2">&quot;</span> <span class="o">%</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果您没有将 <cite>TM_WORLD_BORDERS-0.3.shp</cite> shapefile 存储在与脚本相同的目录中，您需要在 <cite>ogr.Open()</cite> 调用中添加shapefile所在目录的路径。如果您愿意，您还可以将 <cite>boundingBoxes.shp</cite> shapefile 存储在不同的目录中，只需更改创建该shapefile的路径。</p>
</div>
<p>运行此程序将输出以下内容：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>% python calcBoundingBoxes.py
Afghanistan (AFG) lat=29.4061..38.4721, long=60.5042..74.9157
Albania (ALB) lat=39.6447..42.6619, long=19.2825..21.0542
Algeria (DZA) lat=18.9764..37.0914, long=-8.6672..11.9865
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>In this slightly contrived example, we will make use of a shapefile to calculate the
minimum and maximum latitude/longitude values for each country in the world.
This “bounding box” can be used, among other things, to generate a map of a
particular country. For example, the bounding box for Turkey would look like this:</p>
<a class="with-border reference internal image-reference" href="../_images/129-0.png"><img alt="../_images/129-0.png" class="with-border align-center" src="../_images/129-0.png" style="width: 787.5px; height: 277.9px;" /></a>
<p>Start by downloading the World Borders Dataset from:</p>
<p><a class="reference external" href="http://thematicmapping.org/downloads/world_borders.php">http://thematicmapping.org/downloads/world_borders.php</a></p>
<p>Decompress the .zip archive and place the various files that make up the shapefile (the .dbf, .prj, .shp, and .shx files) together in a suitable directory.</p>
<p>Next, we need to create a Python program which can read the borders for each country.
Fortunately, using OGR to read through the contents of a shapefile is trivial:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>

<span class="n">shapefile</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;TM_WORLD_BORDERS-0.3.shp&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>The feature consists of a <strong>geometry</strong> and a set of <strong>fields</strong>. For this data, the geometry is a
polygon that defines the outline of the country, while the fields contain various pieces
of information about the country. According to the <em>Readme.txt</em> file, the fields in this
shapefile include the ISO-3166 three-letter code for the country (in a field named ISO3)
as well as the name for the country (in a field named NAME). This allows us to obtain the
country code and name like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">countryCode</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;ISO3&quot;</span><span class="p">)</span>
<span class="n">countryName</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can also obtain the country’s border polygon using:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
</pre></div>
</div>
<p>There are all sorts of things we can do with this geometry. For example, we could
calculate the geometry’s centroid, test if a point lies within the polygon, or convert
the polygon to WKT format. In this case, however, we want to obtain the bounding
box or <strong>envelope</strong> for the polygon. We can do this in the following way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">minLong</span><span class="p">,</span><span class="n">maxLong</span><span class="p">,</span><span class="n">minLat</span><span class="p">,</span><span class="n">maxLat</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>
</pre></div>
</div>
<p>Let’s put all this together into a complete working program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># calcBoundingBoxes.py</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>

<span class="n">shapefile</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;TM_WORLD_BORDERS-0.3.shp&quot;</span><span class="p">)</span>
<span class="n">layer</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">countries</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># List of (code,name,minLat,maxLat,</span>
               <span class="c1"># minLong,maxLong) tuples.</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">countryCode</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;ISO3&quot;</span><span class="p">)</span>
    <span class="n">countryName</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="n">minLong</span><span class="p">,</span><span class="n">maxLong</span><span class="p">,</span><span class="n">minLat</span><span class="p">,</span><span class="n">maxLat</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>

    <span class="n">countries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">countryName</span><span class="p">,</span> <span class="n">countryCode</span><span class="p">,</span>
                      <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">))</span>

<span class="n">countries</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">code</span><span class="p">,</span><span class="n">minLat</span><span class="p">,</span><span class="n">maxLat</span><span class="p">,</span><span class="n">minLong</span><span class="p">,</span><span class="n">maxLong</span> <span class="ow">in</span> <span class="n">countries</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) lat=</span><span class="si">%0.4f</span><span class="s2">..</span><span class="si">%0.4f</span><span class="s2">, long=</span><span class="si">%0.4f</span><span class="s2">..</span><span class="si">%0.4f</span><span class="s2">&quot;</span> \
    <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span><span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">,</span><span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>If you aren’t storing the TM_WORLD_BORDERS-0.3.shp shapefile in the same directory as the script itself, you will need to add the directory where the shapefile is stored to your ogr.Open() call. You can also store the boundingBoxes.shp shapefile in a different directory if you prefer, by changing the path where this shapefile is created.</p>
</div>
<p>Running this program produces the following output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>% python calcBoundingBoxes.py
Afghanistan (AFG) lat=29.4061..38.4721, long=60.5042..74.9157
Albania (ALB) lat=39.6447..42.6619, long=19.2825..21.0542
Algeria (DZA) lat=18.9764..37.0914, long=-8.6672..11.9865
</pre></div>
</div>
</div>
</div>
</section>
<section id="shapefile">
<h2>任务 – 将国家边界框保存到 Shapefile 中<a class="headerlink" href="#shapefile" title="此标题的永久链接">#</a></h2>
<p>Task – save the country bounding boxes into a shapefile</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>在这个示例中，之前的代码只是简单地打印了经纬度值，但实际上，将边界框绘制到地图上可能会更有用。为此，我们需要将边界框转换为多边形，并将这些多边形保存到一个shapefile中。</p>
<p>创建一个shapefile涉及以下几个步骤：</p>
<ol class="arabic simple">
<li><p>定义shapefile数据使用的**空间参考**
在这种情况下，我们将使用WGS84基准和未投影的地理坐标（即经纬度值）。可以通过以下方式使用OGR定义这个空间参考：</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">osr</span>

<span class="n">spatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">spatialReference</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>创建shapefile文件
我们现在可以使用这个空间参考创建shapefile：</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>
<span class="n">dstFile</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="s2">&quot;boundingBoxes.shp&quot;</span><span class="p">)</span>
<span class="n">dstLayer</span> <span class="o">=</span> <span class="n">dstFile</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">spatialReference</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>定义字段以存储每个特征的元数据
接下来，我们定义几个字段，用于存储每个国家的元数据。我们这里添加两个字段来存储国家名称和ISO-3166代码：</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>

<span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>创建每个特征的几何形状（即多边形）
我们现在需要为每个特征创建几何形状——在本例中，为国家的边界框定义一个多边形。多边形由一个或多个线性**环**组成；第一个线性环定义了多边形的外部，而额外的环定义了多边形内部的“孔”。在本例中，我们希望定义一个矩形的外部，没有孔：</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">linearRing</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>

<span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
<span class="n">polygon</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">linearRing</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>您可能注意到，坐标 <cite>(minLong, minLat)</cite> 被添加到了线性环中两次。这是因为我们正在定义线段而不仅仅是点——第一次调用 <cite>AddPoint()</cite> 定义了起点，每个后续的 <cite>AddPoint()</cite> 调用将新线段添加到线性环中。在这种情况下，我们从左下角开始，逆时针绕边界框走一圈，直到回到左下角：</p>
<a class="with-border reference internal image-reference" href="../_images/133-0.png"><img alt="../_images/133-0.png" class="with-border align-center" src="../_images/133-0.png" style="width: 304.0px; height: 252.0px;" /></a>
</div>
<ol class="arabic" start="5">
<li><p>使用几何形状创建特征
一旦我们得到了多边形，就可以使用它来创建一个特征：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">dstLayer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
<span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
<span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">countryName</span><span class="p">)</span>
<span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">countryCode</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="n">feature</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
<p>注意我们如何使用 <cite>SetField()</cite> 方法来存储特征的元数据。我们还需要调用 <cite>Destroy()</cite> 方法来关闭特征，一旦我们完成了它，这样确保该特征被保存到shapefile中。</p>
</li>
<li><p>关闭shapefile文件
最后，我们调用输出shapefile的 <cite>Destroy()</cite> 方法来关闭文件：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dstFile</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
<p>将所有这些步骤结合起来，并结合之前的代码来计算每个国家的边界框，最终的完整程序如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># boundingBoxesToShapefile.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">os.path</span><span class="o">,</span><span class="w"> </span><span class="nn">shutil</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">osr</span>

<span class="c1"># 打开源shapefile。</span>
<span class="n">srcFile</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;TM_WORLD_BORDERS-0.3.shp&quot;</span><span class="p">)</span>
<span class="n">srcLayer</span> <span class="o">=</span> <span class="n">srcFile</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># 打开输出shapefile。</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">)</span>

<span class="n">spatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">spatialReference</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>
<span class="n">dstPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">,</span> <span class="s2">&quot;boundingBoxes.shp&quot;</span><span class="p">)</span>
<span class="n">dstFile</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="n">dstPath</span><span class="p">)</span>
<span class="n">dstLayer</span> <span class="o">=</span> <span class="n">dstFile</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">spatialReference</span><span class="p">)</span>

<span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>

<span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>

<span class="c1"># 读取源shapefile中的国家特征。</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">srcLayer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">srcLayer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">countryCode</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;ISO3&quot;</span><span class="p">)</span>
    <span class="n">countryName</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="n">minLong</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLat</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>

    <span class="c1"># 将边界框保存为输出shapefile中的特征。</span>
    <span class="n">linearRing</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
    <span class="n">polygon</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">linearRing</span><span class="p">)</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">dstLayer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">countryName</span><span class="p">)</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">countryCode</span><span class="p">)</span>
    <span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

<span class="c1"># 完成</span>
<span class="n">srcFile</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
<span class="n">dstFile</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
<p>运行此程序将创建边界框shapefile，我们可以将其绘制到地图上。例如，以下是泰国的轮廓以及从 <em>boundingBox.shp</em> shapefile 获取的边界框：</p>
<a class="with-border reference internal image-reference" href="../_images/136-0.png"><img alt="../_images/136-0.png" class="with-border align-center" src="../_images/136-0.png" style="width: 246.0px; height: 439.5px;" /></a>
<p>我们将在 <em>第8章，使用Python和Mapnik生成地图</em> 中进一步讨论如何绘制这样的地图。</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>While the previous example simply printed out the latitude and longitude values, it
might be more useful to draw the bounding boxes onto a map. To do this, we have to
convert the bounding boxes into polygons, and save these polygons into a shapefile.</p>
<p>Creating a shapefile involves the following steps:</p>
<ol class="arabic">
<li><p>Define the <strong>spatial reference</strong> used by the shapefile’s data. In this case, we’ll use the WGS84 datum and unprojected geographic coordinates (that is latitude and longitude values). You can define this spatial reference using OGR in the following way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">osr</span>

<span class="n">spatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">spatialReference</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>We can now create the shapefile itself using this spatial reference:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>
<span class="n">dstFile</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="s2">&quot;boundingBoxes.shp&quot;</span><span class="p">))</span>
<span class="n">dstLayer</span> <span class="o">=</span> <span class="n">dstFile</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">spatialReference</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>After creating the shapefile, you next define the various fields which will hold the metadata for each feature. In this case, let’s add two fields, to store the country name and ISO-3166 code for each country:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>

<span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>We now need to create the geometry for each feature—in this case, a polygon defining the country’s bounding box. A polygon consists of one or more linear <strong>rings</strong>; the first linear ring defines the exterior of the polygon, while additional rings define “holes” inside the polygon. In this case, we want a simple polygon with a rectangular exterior and no holes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">linearRing</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
<span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>

<span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
<span class="n">polygon</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">linearRing</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>You may have noticed that the coordinate (minLong, minLat) was added to the linear ring twice. This is because we are defining line segments rather than just points—the first call to AddPoint() defines the starting point, and each subsequent call to AddPoint() adds a new line segment to the linear ring. In this case, we start in the lower-left corner and move counter-clockwise around the bounding box until we reach the lower-left corner again:</p>
<a class="with-border reference internal image-reference" href="../_images/133-0.png"><img alt="../_images/133-0.png" class="with-border align-center" src="../_images/133-0.png" style="width: 304.0px; height: 252.0px;" /></a>
</div>
</li>
<li><p>Once we have the polygon, we can use it to create a feature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">dstLayer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
<span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
<span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">countryName</span><span class="p">)</span>
<span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">countryCode</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
<span class="n">feature</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
<p>Notice how we use the setField() method to store the feature’s metadata.
We also have to call the Destroy() method to close the feature once we have
finished with it; this ensures that the feature is saved into the shapefile.</p>
</li>
<li><p>Finally, we call the output shapefile’s Destroy() method to close the file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dstFile</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
<p>Putting all this together, and combining it with the code from the previous recipe to calculate the bounding boxes for each country in the World Borders Dataset shapefile, we end up with the following complete program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># boundingBoxesToShapefile.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">os.path</span><span class="o">,</span><span class="w"> </span><span class="nn">shutil</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">ogr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">osr</span>

<span class="c1"># Open the source shapefile.</span>

<span class="n">srcFile</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;TM_WORLD_BORDERS-0.3.shp&quot;</span><span class="p">)</span>
<span class="n">srcLayer</span> <span class="o">=</span> <span class="n">srcFile</span><span class="o">.</span><span class="n">GetLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Open the output shapefile.</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">):</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">)</span>

<span class="n">spatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
<span class="n">spatialReference</span><span class="o">.</span><span class="n">SetWellKnownGeogCS</span><span class="p">(</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s2">&quot;ESRI Shapefile&quot;</span><span class="p">)</span>
<span class="n">dstPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;bounding-boxes&quot;</span><span class="p">,</span> <span class="s2">&quot;boundingBoxes.shp&quot;</span><span class="p">)</span>
<span class="n">dstFile</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">CreateDataSource</span><span class="p">(</span><span class="n">dstPath</span><span class="p">)</span>
<span class="n">dstLayer</span> <span class="o">=</span> <span class="n">dstFile</span><span class="o">.</span><span class="n">CreateLayer</span><span class="p">(</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">spatialReference</span><span class="p">)</span>

<span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>

<span class="n">fieldDef</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">FieldDefn</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">OFTString</span><span class="p">)</span>
<span class="n">fieldDef</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateField</span><span class="p">(</span><span class="n">fieldDef</span><span class="p">)</span>

<span class="c1"># Read the country features from the source shapefile.</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">srcLayer</span><span class="o">.</span><span class="n">GetFeatureCount</span><span class="p">()):</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">srcLayer</span><span class="o">.</span><span class="n">GetFeature</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">countryCode</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;ISO3&quot;</span><span class="p">)</span>
    <span class="n">countryName</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetField</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">GetGeometryRef</span><span class="p">()</span>
    <span class="n">minLong</span><span class="p">,</span><span class="n">maxLong</span><span class="p">,</span><span class="n">minLat</span><span class="p">,</span><span class="n">maxLat</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>

    <span class="c1"># Save the bounding box as a feature in the output</span>
    <span class="c1"># shapefile.</span>

    <span class="n">linearRing</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbLinearRing</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
    <span class="n">linearRing</span><span class="o">.</span><span class="n">AddPoint</span><span class="p">(</span><span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
    <span class="n">polygon</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">ogr</span><span class="o">.</span><span class="n">wkbPolygon</span><span class="p">)</span>
    <span class="n">polygon</span><span class="o">.</span><span class="n">AddGeometry</span><span class="p">(</span><span class="n">linearRing</span><span class="p">)</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">dstLayer</span><span class="o">.</span><span class="n">GetLayerDefn</span><span class="p">())</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetGeometry</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;COUNTRY&quot;</span><span class="p">,</span> <span class="n">countryName</span><span class="p">)</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">SetField</span><span class="p">(</span><span class="s2">&quot;CODE&quot;</span><span class="p">,</span> <span class="n">countryCode</span><span class="p">)</span>
    <span class="n">dstLayer</span><span class="o">.</span><span class="n">CreateFeature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
    <span class="n">feature</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

<span class="c1"># All done.</span>

<span class="n">srcFile</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
<span class="n">dstFile</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
<p>The only unexpected twist in this program is the use of a subdirectory called
<em>bounding-boxes</em> that is used to store the output shapefile. Because a shapefile is
actually made up of multiple files on disk (a <em>.dbf</em> file, a <em>.prj</em> file, a <em>.shp</em> file, and
a <em>.shx</em> file), it is easier to place these together in a subdirectory. We use the Python
Standard Library module <em>shutil</em> to delete the previous contents of this directory,
and then <em>os.mkdir()</em> to create it again.</p>
<p>Running this program creates the bounding box shapefile, which we can then draw
onto a map. For example, here is the outline of Thailand along with a bounding box
taken from the <em>boundingBox.shp</em> shapefile:</p>
<a class="with-border reference internal image-reference" href="../_images/136-0.png"><img alt="../_images/136-0.png" class="with-border align-center" src="../_images/136-0.png" style="width: 246.0px; height: 439.5px;" /></a>
<p>We will be looking at how to draw maps like this in <em>Chapter 8, Using Python and Mapnik to Generate Maps</em>.</p>
</div>
</div>
</section>
<section id="id3">
<h2>任务 – 使用数字高程图分析高度数据<a class="headerlink" href="#id3" title="此标题的永久链接">#</a></h2>
<p>Task – analyze height data using a digital elevation map</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p><strong>数字高程图（DEM）</strong> 是一种栅格地理空间数据格式，其中每个像素值表示地球表面某一点的高度。在上一章中，我们遇到过DEM文件，那里我们展示了两个提供此类信息的数据源：涵盖美国的国家高程数据集（National Elevation Dataset）和提供全球DEM文件的GLOBE数据集。</p>
<p>由于DEM文件包含高度数据，因此分析某一地区的高度值可能非常有趣。例如，我们可以绘制一个直方图，显示一个国家区域内的高度分布。让我们使用来自GLOBE数据集的DEM数据，并计算一个该数据的高度直方图。</p>
<p>为了简化问题，我们将选择一个小的、被海洋包围的国家：新西兰。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>我们选择一个小国家是为了避免处理过多的数据，同时选择一个被海洋包围的国家是为了让我们可以检查所有位于边界框内的点，而不需要使用多边形来排除国界之外的点。</p>
</div>
<p>要下载DEM数据，请访问GLOBE网站（<a class="reference external" href="http://www.ngdc.noaa.gov/mgg/topo/globe.html">http://www.ngdc.noaa.gov/mgg/topo/globe.html</a>），然后点击 <strong>在线获取数据（Get Data Online）</strong> 超链接。我们将使用该地区已有的数据，因此点击 <strong>任何或所有16个“瓦片”</strong> 超链接。新西兰位于L瓦片中，因此点击该瓦片的超链接以下载。</p>
<p>下载的文件将名为 <em>l10g.zip</em> （如果您选择以GZIP格式下载瓦片，则文件名为*l10g.gz*）。如果您解压它，最终会得到一个名为 <em>l10g</em> 的文件，里面包含原始的高程数据。</p>
<p>单独来看，这个文件并不是很有用——它需要被地理参考到地球表面，这样您才能将每个高度值与其在地球上的位置对应起来。为了做到这一点，您需要下载相关的头文件。不幸的是，GLOBE网站使得这一过程相当复杂；为预制瓦片提供的头文件可以在以下位置找到：</p>
<p><a class="reference external" href="http://www.ngdc.noaa.gov/mgg/topo/elev/esri/hdr">http://www.ngdc.noaa.gov/mgg/topo/elev/esri/hdr</a></p>
<p>下载名为l10g.hdr的文件，并将其放在与您之前下载的l10g文件相同的目录中。然后，您可以使用GDAL读取DEM文件：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdal</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;l10g&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>您一定已经注意到，下载的l10g瓦片不仅仅覆盖新西兰——它还包括了整个澳大利亚、马来西亚、巴布亚新几内亚以及其他一些东亚国家。为了仅使用新西兰的高度数据，我们必须能够识别栅格DEM的相关部分——也就是覆盖新西兰的x和y坐标范围。我们首先查看地图，并确定包含整个新西兰而不包括其他国家的最小和最大纬度/经度值：</p>
<a class="with-border reference internal image-reference" href="../_images/138-0.png"><img alt="../_images/138-0.png" class="with-border align-center" src="../_images/138-0.png" style="width: 350.0px; height: 370.0px;" /></a>
<p>四舍五入到最近的整数，经度/纬度的边界框为（165, -48）…（179, -33）。这是我们要扫描的区域，涵盖新西兰的全部。</p>
<p>然而，有一个问题：栅格数据由像素或“单元格”组成，它们是通过x和y坐标来标识的，而不是经纬度值。我们必须将经度和纬度转换为x和y坐标。为了做到这一点，我们需要使用栅格DEM的 <strong>仿射变换</strong> 。</p>
<p>如果您记得，在 <em>第3章，Python地理空间开发库</em> 中，我们讨论过仿射变换是一个将地理坐标（纬度和经度值）映射到栅格（x，y）坐标的复杂系统。幸运的是，我们不需要直接处理这些公式，因为GDAL会为我们做这件事。我们首先获取数据集的仿射变换：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
</pre></div>
</div>
<p>使用这个变换，我们可以将（x，y）坐标转换为对应的经纬度值。然而，在这种情况下，我们想做的是相反的——我们希望从经纬度获取对应的x和y坐标。</p>
<p>为此，我们需要反转仿射变换。同样，GDAL会为我们完成这项工作：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">success</span><span class="p">,</span><span class="n">tInverse</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">InvGeoTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Failed!&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>有些情况下仿射变换无法反转。这就是为什么 <em>gdal.InvGeoTransform()</em> 返回一个 <em>success</em> 标志和反转变换的原因。然而，对于这组特定的DEM数据，仿射变换应该始终是可反转的。</p>
</div>
<p>现在我们有了反转后的仿射变换，就可以将纬度和经度转换为x和y坐标了，像这样：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
</pre></div>
</div>
<p>通过这个，我们终于可以确定覆盖我们感兴趣区域的最小和最大（x，y）坐标：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>

<span class="n">minX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">maxX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">minY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
<span class="n">maxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
</pre></div>
</div>
<p>现在我们知道了我们感兴趣的DEM部分的x和y坐标，我们可以使用GDAL读取单独的高度值。我们首先获取包含DEM数据的栅格波段：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>GDAL波段编号从1开始。我们使用的DEM数据只有一个栅格波段。</p>
</div>
<p>现在我们有了栅格波段，可以使用 <em>band.ReadRaster()</em> 方法读取原始的DEM数据。 <em>ReadRaster()</em> 方法的样子如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">band</span><span class="o">.</span><span class="n">ReadRaster</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dWidth</span><span class="p">,</span> <span class="n">dHeight</span><span class="p">,</span> <span class="n">pixelType</span><span class="p">)</span>
</pre></div>
</div>
<p>此方法接受以下参数：</p>
<ul class="simple">
<li><p><em>x</em> 是从栅格波段左侧到要读取部分左侧的像素数量</p></li>
<li><p><em>y</em> 是从栅格波段顶部到要读取部分顶部的像素数量</p></li>
<li><p><em>width</em> 是要读取的像素数</p></li>
<li><p><em>height</em> 是要读取的像素数</p></li>
<li><p><em>dWidth</em> 是结果数据的宽度</p></li>
<li><p><em>dHeight</em> 是结果数据的高度</p></li>
<li><p><em>pixelType</em> 是一个常量，定义每个像素值的数据字节数及数据的解释方式</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>通常，您会将dWidth和dHeight设置为与width和height相同的值；如果您不这样做，栅格数据在读取时将被缩放。</p>
</div>
<p>ReadRaster()方法返回一个包含栅格数据的原始字节序列的字符串。然后，您可以使用标准库模块struct从这个字符串中读取单独的整数高度值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;h&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>注意，我们使用”h”格式代码来读取数据，将每对字节当作一个有符号的16位整数读取。”&lt;” 格式代码强制使用小端字节序。这与DEM文件使用的格式匹配。</p>
</div>
<p>将这些内容整合在一起，我们可以使用GDAL打开栅格数据文件，并读取覆盖新西兰的边界框内的所有像素值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># histogram.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">struct</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdalconst</span>

<span class="n">minLat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">48</span>
<span class="n">maxLat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">33</span>

<span class="n">minLong</span> <span class="o">=</span> <span class="mi">165</span>
<span class="n">maxLong</span> <span class="o">=</span> <span class="mi">179</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;l10g&quot;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
<span class="n">success</span><span class="p">,</span><span class="n">tInverse</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">InvGeoTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Failed!&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>

<span class="n">minX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">maxX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">minY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
<span class="n">maxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>

<span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxX</span> <span class="o">-</span> <span class="n">minX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;h&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="n">maxY</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">scanline</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadRaster</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">gdalconst</span><span class="o">.</span><span class="n">GDT_Int16</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">scanline</span><span class="p">)</span>

<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果您将l10g文件放置在其他目录中，别忘了在gdal.Open()语句中添加目录路径。</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxX</span> <span class="o">-</span> <span class="n">minX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;h&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

<span class="n">histogram</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># 映射高度到对应的像素数</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="n">maxY</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">scanline</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadRaster</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">gdalconst</span><span class="o">.</span><span class="n">GDT_Int16</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">scanline</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span> <span class="n">height</span><span class="p">,</span><span class="n">histogram</span><span class="p">[</span><span class="n">height</span><span class="p">]</span>
</pre></div>
</div>
<p>运行此程序，您将看到一列高度（单位：米）和该高度对应的像素数量：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-500 2607581
1 6641
2 909
3 1628
...
3097 1
3119 2
3173 1
</pre></div>
</div>
<p>这揭示了一个最后的问题：有大量像素的值为-500。发生了什么？显然，-500不是有效的高度值。GLOBE文档解释了这一点：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;每个瓦片都包含值为-500的海洋数据，海洋区域的值范围在-500到陆地的最小值之间。&quot;
</pre></div>
</div>
<p>因此，所有这些值为-500的点表示的是海洋上的像素。幸运的是，这些像素很容易排除；每个栅格文件都包含一个无效数据值的概念，这些值用于标识没有有效数据的像素。GDAL提供了GetNoDataValue()方法，使我们可以排除这些像素：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">band</span><span class="o">.</span><span class="n">GetNoDataValue</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>这最终给出了新西兰的高度直方图。如果您愿意，您可以使用这些数据创建图表。例如，以下图表显示了低于某一给定高度的总像素数：</p>
<a class="with-border reference internal image-reference" href="../_images/143-0.png"><img alt="../_images/143-0.png" class="with-border align-center" src="../_images/143-0.png" style="width: 381.5px; height: 241.0px;" /></a>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>A <strong>Digital Elevation Map (DEM)</strong> is a raster geospatial data format where each pixel
value represents the height of a point on the Earth’s surface. We encountered DEM
files in the previous chapter, where we saw two examples of data sources that supply
this type of information: the National Elevation Dataset covering the United States,
and GLOBE which provides DEM files covering the entire Earth.</p>
<p>Because a DEM file contains height data, it can be interesting to analyze the height
values for a given area. For example, we could draw a histogram showing how
much of a country’s area is at a certain elevation. Let’s take some DEM data from
the GLOBE dataset, and calculate a height histogram using that data.</p>
<p>To keep things simple, we will choose a small country surrounded by ocean:
New Zealand.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>We’re using a small country so that we don’t have too much data to work with, and we’re using a country surrounded by ocean so that we can check all the points within a bounding box, rather than having to use a polygon to exclude points outside of the country’s boundaries.</p>
</div>
<p>To download the DEM data, go to the GLOBE website (<a class="reference external" href="http://www.ngdc.noaa">http://www.ngdc.noaa</a>.
gov/mgg/topo/globe.html) and click on the <strong>Get Data Online</strong> hyperlink. We’re
going to use the data already calculated for this area of the world, so click on the
<strong>Any or all 16 “tiles”</strong> hyperlink. New Zealand is in tile L, so click on the hyperlink
for this tile to download it.</p>
<p>The file you download will be called <em>l10g.zip</em> (or <em>l10g.gz</em> if you chose to download
the tile in GZIP format). If you decompress it, you will end up with a single file called
<em>l10g</em> containing the raw elevation data.</p>
<p>By itself, this file isn’t very useful—it needs to be georeferenced onto the Earth’s
surface so that you can match up each height value with its position on the Earth.
To do this, you need to download the associated header file. Unfortunately, the
GLOBE website makes this rather difficult; the header files for the premade tiles
can be found at:</p>
<p><a class="reference external" href="http://www.ngdc.noaa.gov/mgg/topo/elev/esri/hdr">http://www.ngdc.noaa.gov/mgg/topo/elev/esri/hdr</a></p>
<p>Download the file named l10g.hdr and place it into the same directory as the l10g
file you downloaded earlier. You can then read the DEM file using GDAL:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdal</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;l10g&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you must have noticed when you downloaded the l10g tile that this tile covers
much more than just New Zealand—all of Australia is included, as well as Malaysia,
Papua New Guinea, and several other East-Asian countries. To work with the height
data for just New Zealand, we have to be able to identify the relevant portion of the
raster DEM—that is, the range of x and y coordinates which cover New Zealand.
We start by looking at a map and identifying the minimum and maximum latitude/
longitude values which enclose all of New Zealand, but no other country:</p>
<a class="with-border reference internal image-reference" href="../_images/138-0.png"><img alt="../_images/138-0.png" class="with-border align-center" src="../_images/138-0.png" style="width: 350.0px; height: 370.0px;" /></a>
<p>Rounded to the nearest whole degree, we get a longitude/latitude bounding box of
(165, -48)…(179, -33). This is the area we want to scan to cover all of New Zealand.</p>
<p>There is, however, a problem: the raster data consists of pixels or “cells” identified
by x and y coordinates, not longitude and latitude values. We have to convert from
longitudes and latitudes into x and y coordinates. To do this, we need to make use
of the raster DEM’s <strong>affine transformation</strong>.</p>
<p>If you remember, back in <em>Chapter 3, Python Libraries for Geospatial Development</em>, we
discussed that an affine transformation is a complex system for mapping geographic
coordinates (latitude and longitude values) into raster (x, y) coordinates. Fortunately
we don’t have to deal with these formulas directly, as GDAL will do it for us. We
start by obtaining our dataset’s affine transformation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
</pre></div>
</div>
<p>Using this transformation, we can convert an (x, y) coordinate into its associated
latitude and longitude value. In this case, however, we want to do the opposite—we
want to take a latitude and longitude, and calculate the associated x and y coordinate.</p>
<p>To do this, we have to invert the affine transformation. Once again, GDAL will do
this for us:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">success</span><span class="p">,</span><span class="n">tInverse</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">InvGeoTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Failed!&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>There are some cases where an affine transformation can’t be
inverted. This is why <em>gdal.InvGeoTransform()</em> returns a
<em>success</em> flag as well as the inverted transformation. With this
particular set of DEM data, however, the affine transformation
should always be invertible.</p>
</div>
<p>Now that we have the inverse affine transformation, it is possible to convert from a latitude and longitude into an x and y coordinate, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span>
</pre></div>
</div>
<p>Using this, we can finally identify the minimum and maximum (x, y) coordinates that cover the area we are interested in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>

<span class="n">minX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">maxX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">minY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
<span class="n">maxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
</pre></div>
</div>
<p>Now that we know the x and y coordinates for the portion of the DEM that we’re
interested in, we can use GDAL to read in the individual height values. We start
by obtaining the raster band that contains the DEM data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>GDAL band numbers start at one. There is only one raster band in the DEM data we’re using.</p>
</div>
<p>Now that we have the raster band, we can use the <em>band.ReadRaster()</em> method to read the raw DEM data. This is what the <em>ReadRaster()</em> method looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">band</span><span class="o">.</span><span class="n">ReadRaster</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dWidth</span><span class="p">,</span> <span class="n">dHeight</span><span class="p">,</span> <span class="n">pixelType</span><span class="p">)</span>
</pre></div>
</div>
<p>This method takes the following parameters:</p>
<ul class="simple">
<li><p><em>x</em> is the number of pixels from the left-hand side of the raster band to the left-hand side of the portion of the band to read from</p></li>
<li><p><em>y</em> is the number of pixels from the top of the raster band to the top of the portion of the band to read from</p></li>
<li><p><em>width</em> is the number of pixels across to read</p></li>
<li><p><em>height</em> is the number of pixels down to read</p></li>
<li><p><em>dWidth</em> is the width of the resulting data</p></li>
<li><p><em>dHeight</em> is the height of the resulting data</p></li>
<li><p><em>pixelType</em> is a constant defining how many bytes of data there are for each pixel value, and how that data is to be interpreted</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Normally, you would set dWidth and dHeight to the same value as width and height; if you don’t do this, the raster data will be scaled up or down when it is read.</p>
</div>
<p>The ReadRaster() method returns a string containing the raster data as a raw
sequence of bytes. You can then read the individual integer height values from
this string using the struct standard library module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;h&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Notice that we use the h format code to read through the data, treating each pair of bytes as a signed 16-bit integer. The &lt; format code forces the use of little-endian byte order. This matches the format used by the DEM file.</p>
</div>
<p>Putting all this together, we can use GDAL to open the raster data file and read all
the pixel values within the bounding box surrounding New Zealand:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># histogram.py</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">struct</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">osgeo</span><span class="w"> </span><span class="kn">import</span> <span class="n">gdalconst</span>

<span class="n">minLat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">48</span>
<span class="n">maxLat</span> <span class="o">=</span> <span class="o">-</span><span class="mi">33</span>

<span class="n">minLong</span> <span class="o">=</span> <span class="mi">165</span>
<span class="n">maxLong</span> <span class="o">=</span> <span class="mi">179</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;l10g&quot;</span><span class="p">)</span>
<span class="n">band</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
<span class="n">success</span><span class="p">,</span><span class="n">tInverse</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">InvGeoTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;Failed!&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">minLong</span><span class="p">,</span> <span class="n">minLat</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ApplyGeoTransform</span><span class="p">(</span><span class="n">tInverse</span><span class="p">,</span> <span class="n">maxLong</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>

<span class="n">minX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">maxX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">))</span>
<span class="n">minY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
<span class="n">maxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>

<span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxX</span> <span class="o">-</span> <span class="n">minX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;h&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="n">maxY</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">scanline</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadRaster</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">gdalconst</span><span class="o">.</span><span class="n">GDT_Int16</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">scanline</span><span class="p">)</span>

<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Don’t forget to add a directory path to the gdal.Open() statement if you placed the l10g file in a different directory.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxX</span> <span class="o">-</span> <span class="n">minX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;h&quot;</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

<span class="n">histogram</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Maps height to # pixels with that height.</span>

<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="n">maxY</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">scanline</span> <span class="o">=</span> <span class="n">band</span><span class="o">.</span><span class="n">ReadRaster</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                               <span class="n">gdalconst</span><span class="o">.</span><span class="n">GDT_Int16</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">scanline</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">height</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span> <span class="n">height</span><span class="p">,</span><span class="n">histogram</span><span class="p">[</span><span class="n">height</span><span class="p">]</span>
</pre></div>
</div>
<p>If you run this, you will see a list of heights (in meters) and how many pixels there are at that height:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-500 2607581
1 6641
2 909
3 1628
...
3097 1
3119 2
3173 1
</pre></div>
</div>
<p>This reveals one final problem: there are a large number of pixels with a value of
-500. What is going on here? Clearly -500 is not a valid height value. The GLOBE
documentation explains this as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&quot;Every tile contains values of -500 for oceans, with no values between -500 and the
minimum value for land noted here.&quot;
</pre></div>
</div>
<p>So all those points with a value of -500 represents pixels over the ocean. Fortunately,
it is easy to exclude these; every raster file includes the concept of a no data value,
which is used for pixels without valid data. GDAL includes the GetNoDataValue()
method that allows us to exclude these pixels:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">band</span><span class="o">.</span><span class="n">GetNoDataValue</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">histogram</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>This finally gives us a histogram of the heights across New Zealand. You could create a graph using this data if you wished. For example, the following chart shows the total number of pixels at or below a given height:</p>
<a class="with-border reference internal image-reference" href="../_images/143-0.png"><img alt="../_images/143-0.png" class="with-border align-center" src="../_images/143-0.png" style="width: 381.5px; height: 241.0px;" /></a>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="changing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">更改基准和投影</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="pre-req.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">先决条件</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2025, Erik Westra
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">读取和写入地理空间数据</a><ul>
<li><a class="reference internal" href="#id2">任务 – 计算世界上每个国家的边界​​框</a></li>
<li><a class="reference internal" href="#shapefile">任务 – 将国家边界框保存到 Shapefile 中</a></li>
<li><a class="reference internal" href="#id3">任务 – 使用数字高程图分析高度数据</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/translations.js"></script>
    </body>
</html>