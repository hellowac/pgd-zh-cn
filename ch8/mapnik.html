<!doctype html>
<html class="no-js" lang="zh-CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="重新审视 MapGenerator" href="mapgenerator.html" /><link rel="prev" title="创建示例地图" href="creating.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Mapnik 深度介绍 - python地理空间开发 1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyles.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">python地理空间开发 1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">python地理空间开发 1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">内容</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_author.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_reviewers.html">审稿人简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch1/index.html">1 使用 Python 进行地理空间开发</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch1/python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/geo_dev.html">地理空间开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/applications.html">地理空间开发的应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/recent_dev.html">最新动态</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch2/index.html">2 GIS</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch2/core_concepts.html">核心 GIS 概念</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/gis_data_format.html">GIS 数据格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/working.html">手动处理 GIS 数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch3/index.html">3 用于地理空间开发的 Python 库</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch3/rw.html">读取和写入地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/dealing_proj.html">处理投影</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/analyzing.html">分析和处理地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/visualizing.html">可视化地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch4/index.html">4 地理空间数据来源</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch4/vector_format.html">矢量格式的地理空间数据来源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/raster_format.html">栅格格式地理空间数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/other_format.html">其他类型地理空间数据的来源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/choosing_format.html">选择地理空间数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch5/index.html">5 使用 Python 处理地理空间数据</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch5/pre-req.html">先决条件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/rw.html">读取和写入地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/changing.html">更改基准和投影</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/representing.html">表示和存储地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/performing.html">执行地理空间计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/converting.html">转换和标准化几何和距离单位</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/exercises.html">练习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch6/index.html">6 数据库中的 GIS</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch6/spatially.html">空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/spatially-indexes.html">空间索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/open-source.html">支持空间功能的开源数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/commerical.html">商业空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/recommended.html">建议的最佳做法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/working.html">使用 Python 处理地理空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch7/index.html">7 使用空间数据</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch7/about-distal.html">关于 DISTAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/designing.html">设计和构建数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/downloading.html">下载数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/importing-data.html">导入数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/implementing.html">实现 DISTAL 应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/aplication.html">应用程序审查和改进</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">8 使用 Python 和 Mapnik 生成地图</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introducing.html">Mapnik 简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating.html">创建示例地图</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Mapnik 深度介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="mapgenerator.html">重新审视 MapGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="mapdefinition.html">地图定义文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch9/index.html">9 整合所有要素——完整的地图系统</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch9/about-shapeditor.html">关于 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/designing-shape.html">设计 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/prerequisites.html">先决条件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/the-structure-ofdjango.html">Django 应用程序的结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/settingup-database.html">设置数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/settingup-shapeeditor.html">设置 ShapeEditor 项目</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/defining-shapeditor.html">定义 ShapeEditor 的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/creating-shared.html">创建共享应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/defining-datamodel.html">定义数据模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/playing.html">玩转管理系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch9/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch10/index.html">10 ShapeEditor – 实现列表视图、导入和导出</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch10/implementing.html">实现“列出 Shapefile”视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/importing.html">导入 Shapefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/exporting.html">导出 shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch11/index.html">11 ShapeEditor – 选择和编辑特征</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch11/selecting.html">选择要编辑的要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/editring.html">编辑要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/adding.html">添加要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/deleting.html">删除要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/deleting-shapefiles.html">删除 shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/using.html">使用 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/further.html">进一步改进和增强</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/summary.html">小结</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="mapnik">
<h1>Mapnik 深度介绍<a class="headerlink" href="#mapnik" title="此标题的永久链接">#</a></h1>
<p>Mapnik in depth</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>在本节中，我们将更详细地研究 Mapnik 工具包的 Python 接口。Mapnik 的 Python 文档（<a class="reference external" href="http://media.mapnik.org/api_docs/python">http://media.mapnik.org/api_docs/python</a>）比较混乱且不完整，因此在编写你自己的基于 Mapnik 的程序时，你可能会发现本节内容是一个有用的参考指南。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Mapnik 工具包是用 C++ 编写的，并提供绑定让你可以通过 Python 访问它。并非 Mapnik 中实现的所有功能都可以在 Python 中使用；这里只会讨论那些可以通过 Python 访问且对 Python 开发者相关的功能。</p>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>In this section, we will examine the Python interface of the Mapnik toolkit in much more detail. The Python documentation for Mapnik (<a class="reference external" href="http://media.mapnik.org/api_docs/python">http://media.mapnik.org/api_docs/python</a>) is confusing and incomplete, so you may find this section to be a useful reference guide while writing your own Mapnik-based programs.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The Mapnik toolkit is written in C++, and provides bindings to let you access it via Python. Not every feature implemented in Mapnik is available from Python; only those features that are available and relevant to the Python developer will be discussed here.</p>
</div>
</div>
</div>
<section id="id1">
<h2>数据源<a class="headerlink" href="#id1" title="此标题的永久链接">#</a></h2>
<p>Data sources</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>在你能够访问地图中的特定地理空间数据之前，首先需要设置一个 Mapnik <strong>Datasource</strong> 对象。它充当 Mapnik 与你的地理空间数据之间的“桥梁”：</p>
<img alt="../_images/314-0.png" class="align-center" src="../_images/314-0.png" />
<p>通常，你会使用这里描述的便捷构造函数来创建数据源。然后，你将这个数据源添加到任何 Mapnik 图层对象中，这些图层会使用该数据源：</p>
<blockquote>
<div><p>layer.datasource = datasource</p>
</div></blockquote>
<p>一个 Datasource 对象可以被多个图层共享，或者只被一个图层使用。</p>
<p>Mapnik 支持多种不同类型的数据源，其中一些是实验性的，或者可以访问商业数据库中的数据。接下来，我们将更详细地了解你可能会觉得有用的数据源类型。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>Before you can access a given set of geospatial data within a map, you need to set up a Mapnik <strong>Datasource</strong> object. This acts as a “bridge” between Mapnik and your geospatial data:</p>
<img alt="../_images/314-0.png" class="align-center" src="../_images/314-0.png" />
<p>You typically create the data source using one of the convenience constructors
described here. Then you add that data source to any Mapnik Layer objects,
which will use that data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
</pre></div>
</div>
<p>A single Datasource object can be shared by multiple layers, or it can be used by
just one layer.</p>
<p>There are many different types of data sources supported by Mapnik, some of
which are experimental or access data in commercial databases. Let’s take a closer
look at the types of data sources you are likely to find useful.</p>
</div>
</div>
<section id="shapefile">
<h3>Shapefile<a class="headerlink" href="#shapefile" title="此标题的永久链接">#</a></h3>
<p>Shapefile</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>使用 shapefile 作为 Mapnik 数据源非常简单。你需要做的就是将所需 shapefile 的名称和目录路径传递给 <cite>mapnik.Shapefile()</cite> 便捷构造函数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span>
<span class="o">...</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Shapefile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;shapefile.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果 shapefile 位于不同的目录中，可以使用 <cite>os.path.join()</cite> 来定义完整的路径。例如，你可以像这样打开相对于 Python 程序的目录中的 shapefile：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Shapefile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;shapes.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>当你打开一个 shapefile 数据源时，可以在过滤器表达式中使用 shapefile 的属性，并作为字段通过 <cite>TextSymbolizer</cite> 来显示。默认情况下，shapefile 中的所有文本都会被假定为 UTF-8 字符编码；如果你需要使用不同的字符编码，可以使用 <cite>encoding</cite> 参数，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Shapefile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;shapefile.shp&quot;</span><span class="p">,</span>
                                <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>It is easy to use a shapefile as a Mapnik data source. All you need to do is supply
the name and directory path for the desired shapefile to the mapnik.Shapefile()
convenience constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span>
<span class="o">...</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Shapefile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;shapefile.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the shapefile is in a different directory, you can use os.path.join() to define
the full path. For example, you can open a shapefile in a directory relative to your
Python program like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Shapefile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
                                                <span class="s2">&quot;shapes.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>When you open a shapefile data source, the shapefile’s attributes can be used within
a filter expression, and as fields to be displayed by a TextSymbolizer. By default, all
text within the shapefile will be assumed to be in UTF-8 character encoding; if you
need to use a different character encoding, you can use the encoding parameter,
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Shapefile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;shapefile.shp&quot;</span><span class="p">,</span>
                              <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin1&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="postgis">
<h3>PostGIS<a class="headerlink" href="#postgis" title="此标题的永久链接">#</a></h3>
<p>PostGIS</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>这个数据源允许你在地图中使用 PostGIS 数据库中的数据。PostGIS 数据源的基本用法如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span>
<span class="o">...</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PostGIS</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;...&quot;</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
                            <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>你只需要传递用于访问 PostGIS 数据库的用户名和密码、数据库的名称，以及包含你想在地图上显示的空间数据的表名。与 shapefile 一样，数据库表中的字段可以在过滤器表达式中使用，也可以作为字段通过 <cite>TextSymbolizer</cite> 来显示。</p>
<p>在从 PostGIS 数据库检索数据时，有一些性能问题需要注意。假设我们正在访问一个大型数据库表，并使用以下方式来生成地图的图层：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PostGIS</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
                            <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;myBigTable&quot;</span><span class="p">)</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">)</span>

<span class="n">symbol</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#406080&quot;</span><span class="p">))</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
<span class="n">rule</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
<span class="n">style</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
<p>注意，数据源引用了 PostGIS 数据库中的 <cite>myBigTable</cite> 表，并使用过滤器表达式 (<cite>[level] = 1</cite>) 选择该数据库表中需要显示的特定记录，以通过 <cite>PolygonSymbolizer</cite> 绘制。</p>
<p>在渲染这个地图图层时，Mapnik 将扫描表中的每一条记录，依次将过滤器表达式应用于每条记录，然后仅在记录匹配过滤器表达式时，使用 <cite>PolygonSymbolizer</cite> 来绘制该记录的多边形。如果表中记录不多，或者大部分记录都符合过滤条件，这种做法是可以的。但假设 <cite>myBigTable</cite> 表包含一百万条记录，而其中只有 10,000 条记录的 <cite>level</cite> 值为 1。在这种情况下，Mapnik 将扫描整个表并丢弃 99% 的记录，只有剩下的 1% 记录会被绘制出来。</p>
<p>正如你能想象的那样，这样的做法非常低效。Mapnik 会浪费大量时间在数据库中过滤记录，而实际上 PostGIS 本身更适合完成这一任务。在这种情况下，你可以使用 <strong>子选择查询</strong>，这样数据库本身会在数据被 Mapnik 接收之前进行过滤。我们在前一章中实际上使用了一个子选择查询，从 PostGIS 数据库中检索了瓦片状的海岸线数据，尽管我们并没有深入解释其工作原理。</p>
<p>要使用子选择查询，你可以用一个 SQL 的 <em>select</em> 语句来替换表名，该语句执行过滤并返回 Mapnik 生成地图图层所需的字段。下面是一个使用子选择查询的更新版本：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;(select geom from myBigTable where level=1) as data&quot;</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PostGIS</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
                            <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">)</span>

<span class="n">symbol</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#406080&quot;</span><span class="p">))</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
<span class="n">style</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
<p>我们用一个 PostGIS 子选择语句替换了表名，该语句过滤掉了所有 <cite>level</cite> 值不等于 1 的记录，并将匹配记录的 <cite>geom</cite> 字段返回给 Mapnik。我们还删除了代码中的 <cite>rule.filter =</cite> 行，因为数据源只会返回已经匹配过滤器表达式的记录。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>请注意，子选择语句以 <cite>… as data</cite> 结尾。我们必须给子选择语句的结果命名，尽管这个名称会被忽略。在这个例子中，我们将结果命名为 <cite>data</cite>，但你可以使用任何你喜欢的名称。</p>
</div>
<p>如果你使用子选择查询，重要的是你要包括所有在过滤器表达式和符号化器中使用的字段。如果你没有在子选择语句中包括某个字段，那么该字段将无法供 Mapnik 使用。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>This data source allows you to use data from a PostGIS database on your map.
The basic usage of the PostGIS data source is like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span>
<span class="o">...</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PostGIS</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;...&quot;</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
                            <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You simply pass in the username and password used to access the PostGIS
database, the name of the database, and the name of the table that contains the
spatial data you want to include on your map. As with the shapefiles, the fields in
the database table can be used inside a filter expression, and fields to be displayed
using a TextSymbolizer.</p>
<p>There are some performance issues to be aware of when retrieving data from a
PostGIS database. Imagine that we’re accessing a large database table, and use
the following to generate our map’s layer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PostGIS</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
                            <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="s2">&quot;myBigTable&quot;</span><span class="p">)</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">)</span>

<span class="n">symbol</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#406080&quot;</span><span class="p">))</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
<span class="n">rule</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
<span class="n">style</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
<p>Note how the data source refers to the myBigTable table within the PostGIS
database, and we use a filter expression ([level] = 1) to select the particular
records within that database table to be displayed using our PolygonSymbolizer.</p>
<p>When rendering this map layer, Mapnik will scan through every record in
the table, apply the filter expression to each record in turn, and then use the
PolygonSymbolizer to draw the record’s polygon if and only if the record matches
the filter expression. This is fine if there aren’t many records in the table, or if most
of the records will match the filter expression. But imagine that the myBigTable table
contains a million records, with only 10,000 records having a level value of 1. In this
case, Mapnik will scan through the entire table and discard 99 percent of the records.
Only the remaining 1 percent will actually be drawn.</p>
<p>As you can imagine, this is extremely inefficient. Mapnik will waste a lot of time
filtering the records in the database when PostGIS itself is much better suited to the
task. In situations like this, you can make use of a <strong>subselect query</strong> so that the database
itself will do the filtering before the data is received by Mapnik. We actually used a
subselect query in the previous chapter, where we retrieved tiled shoreline data from
our PostGIS database, though we didn’t explain how it worked in any depth.</p>
<p>To use a subselect query, you replace the table name with an SQL <em>select</em> statement
that does the filtering and returns the fields needed by Mapnik to generate the map’s
layer. Here is an updated version of the preceding example that uses a subselect query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;(select geom from myBigTable where level=1) as data&quot;</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PostGIS</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span>
                            <span class="n">dbname</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>

<span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">)</span>

<span class="n">symbol</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#406080&quot;</span><span class="p">))</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
<span class="n">style</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
<p>We’ve replaced the table name with a PostGIS subselect statement that filters out
all records with a level value not equal to 1 and returns just the geom field for the
matching records back to Mapnik. We’ve also removed the rule.filter = line in
our code, as the data source will only ever return records that already match the
filter expression.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Note that the subselect statement ends with …as data. We have to give the results of the subselect statement a name, even though that name is ignored. In this case, we’ve called the results data, though you can use any name you like.</p>
</div>
<p>If you use a subselect, it is important that you include all the fields used by your filter
expressions and symbolizers. If you don’t include a field in the subselect statement,
it won’t be available for Mapnik to use.</p>
</div>
</div>
</section>
<section id="gdal">
<h3>Gdal<a class="headerlink" href="#gdal" title="此标题的永久链接">#</a></h3>
<p>Gdal</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>Gdal 数据源允许你在地图中包含任何 GDAL 兼容的栅格图像数据文件。使用 Gdal 数据源非常简单：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Gdal</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;myRasterImage.tiff&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>一旦你有了一个 Gdal 数据源，你需要使用 <cite>RasterSymbolizer</cite> 将其绘制到地图上：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">)</span>

<span class="n">symbol</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">RasterSymbolizer</span><span class="p">()</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
<span class="n">style</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Mapnik 提供了另一种读取 TIFF 格式栅格图像的方式，使用 Raster 数据源。一般来说，使用 Gdal 数据源比使用 Raster 数据源更灵活、更简便。</p>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>The Gdal data source allows you to include any GDAL-compatible raster image data
file within your map. The Gdal data source is straightforward to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Gdal</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;myRasterImage.tiff&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once you have a Gdal data source, you need to use a RasterSymbolizer to draw it onto the map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">datasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">)</span>

<span class="n">symbol</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">RasterSymbolizer</span><span class="p">()</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>

<span class="n">style</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Style</span><span class="p">()</span>
<span class="n">style</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;myLayerStyle&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Mapnik provides another way of reading TIFF-format raster images, using the Raster data source. In general, using the Gdal data source is more flexible and easier than using Raster.</p>
</div>
</div>
</div>
</section>
<section id="ogr">
<h3>Ogr<a class="headerlink" href="#ogr" title="此标题的永久链接">#</a></h3>
<p>Ogr</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">中文</label><div class="tab-content docutils container">
<p>Ogr 数据源允许你在地图上显示任何 OGR 兼容的矢量数据。Ogr 数据源的便利构造函数至少需要两个命名参数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Ogr</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>file</cite> 参数是 OGR 兼容数据文件的名称，而 <cite>layer</cite> 是该数据文件中所需图层的名称。例如，你可以使用它通过 OGR 驱动读取 shapefile：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Ogr</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;shapefile.shp&quot;</span><span class="p">,</span>
                        <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;shapefile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>更有用的是，你可以使用它从 OGR 支持的任何矢量格式数据文件中加载数据。各种支持的格式可以在以下网页中找到：</p>
<p><a class="reference external" href="http://www.gdal.org/ogr/ogr_formats.html">http://www.gdal.org/ogr/ogr_formats.html</a></p>
<p><strong>虚拟数据源（VRT）</strong> 格式对我们来说尤其重要。VRT 格式是一个 XML 格式的文件，它允许你设置一个 OGR 数据源，而这个数据源并不是存储在磁盘上的简单文件中。我们在前一章中看到了如何使用它在地图上显示来自 MySQL 数据库的数据，尽管 Mapnik 本身并不实现 MySQL 数据源。</p>
<p>VRT 文件格式相对复杂，但在 OGR 网站上有详细解释。以下是如何使用 VRT 文件设置 MySQL 虚拟数据源的示例：</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;OGRVRTDataSource&gt;</span>
<span class="w">    </span><span class="nt">&lt;OGRVRTLayer</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;myLayer&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;SrcDataSource&gt;</span>MYSQL:mydb,user=user,password=pass,
<span class="w">                        </span>tables=myTable<span class="nt">&lt;/SrcDataSource&gt;</span>
<span class="w">        </span><span class="nt">&lt;SrcSQL&gt;</span>
<span class="w">            </span>SELECT<span class="w"> </span>name,geom<span class="w"> </span>FROM<span class="w"> </span>myTable
<span class="w">        </span><span class="nt">&lt;/SrcSQL&gt;</span>
<span class="w">    </span><span class="nt">&lt;/OGRVRTLayer&gt;</span>
<span class="nt">&lt;/OGRVRTDataSource&gt;</span>
</pre></div>
</div>
<p><cite>&lt;SrcDataSource&gt;</cite> 元素包含一个字符串，用于设置 OGR MySQL 数据源。这个字符串的格式如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>MySQL:«dbName»,user<span class="o">=</span>«username»,password<span class="o">=</span>«pass»,tables<span class="o">=</span>«tables»
</pre></div>
</div>
<p>你需要将 <cite>«dbName»</cite> 替换为你的数据库名称，将 <cite>«username»</cite> 和 <cite>«pass»</cite> 替换为用于访问 MySQL 数据库的用户名和密码，将 <cite>«tables»</cite> 替换为你想从中检索数据的数据库表的列表。如果你从多个表中检索数据，你需要使用分号分隔表名，如下所示：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">tables</span><span class="o">=</span>lakes<span class="p">;</span>rivers<span class="p">;</span>coastlines
</pre></div>
</div>
<p>注意，<cite>&lt;SrcDataSource&gt;</cite> 和 <cite>&lt;/SrcDataSource&gt;</cite> 之间的所有文本必须写在同一行。</p>
<p><cite>&lt;SrcSQL&gt;</cite> 元素中的文本应该是一个 MySQL 查询语句，用于从数据库表中检索所需的信息。和 PostGIS 数据源一样，你可以使用它在数据传递到 Mapnik 之前筛选掉不需要的记录，这将显著提高性能。</p>
<p>VRT 文件应该保存到磁盘上。例如，上面的虚拟文件定义可能会保存为名为 <cite>myLayer.vrt</cite> 的文件。然后，你可以使用这个文件来定义你的 Ogr 数据源，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Ogr</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;myLayer.vrt&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">英文</label><div class="tab-content docutils container">
<p>The Ogr data source lets you display any OGR-compatible vector data on your
map. The convenience constructor for an Ogr data source requires at least two
named parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Ogr</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The file parameter is the name of an OGR-compatible data file, while layer is
the name of the desired layer within that data file. You could use this, for example,
to read a shapefile via the OGR driver:</p>
<blockquote>
<div><dl class="simple">
<dt>datasource = mapnik.Ogr(file=”shapefile.shp”,</dt><dd><p>layer=”shapefile”)</p>
</dd>
</dl>
</div></blockquote>
<p>More usefully, you can use this to load data from any vector-format data file
supported by OGR. The various supported formats are listed on the following
web page:</p>
<p><a class="reference external" href="http://www.gdal.org/ogr/ogr_formats.html">http://www.gdal.org/ogr/ogr_formats.html</a></p>
<p>The <strong>Virtual Datasource (VRT)</strong> format is of particular interest to us. The VRT format
is an XML-formatted file that allows you to set up an OGR data source, which isn’t
stored in a simple file on disk. We saw in the previous chapter how this can be used
to display data from a MySQL database on a map, despite the fact that Mapnik itself
does not implement a MySQL data source.</p>
<p>The VRT file format is relatively complex, though it is explained fully on the OGR
website. Here is an example of how you can use a VRT file to set up a MySQL virtual
data source:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;OGRVRTDataSource&gt;</span>
<span class="w">    </span><span class="nt">&lt;OGRVRTLayer</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;myLayer&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;SrcDataSource&gt;</span>MYSQL:mydb,user=user,password=pass,
<span class="w">                       </span>tables=myTable<span class="nt">&lt;/SrcDataSource&gt;</span>
<span class="w">        </span><span class="nt">&lt;SrcSQL&gt;</span>
<span class="w">            </span>SELECT<span class="w"> </span>name,geom<span class="w"> </span>FROM<span class="w"> </span>myTable
<span class="w">        </span><span class="nt">&lt;/SrcSQL&gt;</span>
<span class="w">    </span><span class="nt">&lt;/OGRVRTLayer&gt;</span>
<span class="nt">&lt;/OGRVRTDataSource&gt;</span>
</pre></div>
</div>
<p>The &lt;SrcDataSource&gt; element contains a string that sets up the OGR MySQL data
source. This string is of the following format:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>MySQL:«dbName»,user<span class="o">=</span>«username»,password<span class="o">=</span>«pass»,tables<span class="o">=</span>«tables»
</pre></div>
</div>
<p>You need to replace «dbName» with the name of your database, «username» and
«pass» with the username and password used to access your MySQL database,
and «tables» with a list of the database tables you want to retrieve your data from.
If you are retrieving data from multiple tables, you need to separate the table names
with a semicolon like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tables</span><span class="o">=</span><span class="n">lakes</span><span class="p">;</span><span class="n">rivers</span><span class="p">;</span><span class="n">coastlines</span>
</pre></div>
</div>
<p>Note that all the text between &lt;SrcDataSource&gt; and &lt;/SrcDataSource&gt; must be on
a single line.</p>
<p>The text inside the &lt;SrcSQL&gt; element should be a MySQL select statement that
retrieves the desired information from the database table(s). As with the PostGIS
data source, you can use this to filter out unwanted records before they are passed
to Mapnik, which will significantly improve performance.</p>
<p>The VRT file should be saved to disk. For example, the preceding virtual file
definition might be saved to a file named myLayer.vrt. You would then use
this file to define your Ogr data source like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Ogr</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;myLayer.vrt&quot;</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;myLayer&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sqlite">
<h3>SQLite<a class="headerlink" href="#sqlite" title="此标题的永久链接">#</a></h3>
<p>SQLite</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">中文</label><div class="tab-content docutils container">
<p>SQLite 数据源允许你在地图上包含来自 SQLite（或 SpatiaLite）数据库的数据。mapnik.SQLite() 便利构造函数接受多个关键字参数；最常用的参数包括：</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>file=”…”</cite></dt><dd><p>SQLite 数据库文件的名称和可选路径。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>table=”…”</cite></dt><dd><p>数据库中所需表的名称。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>geometry_field=”…”</cite></dt><dd><p>表中存储要显示的几何形状的字段名称。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>key_field=”…”</cite></dt><dd><p>表中主键字段的名称。</p>
</dd>
</dl>
</li>
</ul>
<p>例如，要访问名为 <cite>mapData.db</cite> 的 SpatiaLite 数据库中的名为 <cite>countries</cite> 的表，你可以使用以下代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">SQLite</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;mapData.db&quot;</span><span class="p">,</span>
                            <span class="n">table</span><span class="o">=</span><span class="s2">&quot;countries&quot;</span><span class="p">,</span>
                            <span class="n">geometry_field</span><span class="o">=</span><span class="s2">&quot;outline&quot;</span><span class="p">,</span>
                            <span class="n">key_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>countries</cite> 表中的所有字段都可以在 Mapnik 筛选器中使用，并且可以通过 TextSymbolizer 显示。各种符号化工具将使用 <cite>outline</cite> 字段中存储的几何数据来绘制线条、多边形等。</p>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">英文</label><div class="tab-content docutils container">
<p>The SQLite data source allows you to include data from an SQLite (or SpatiaLite)
database on a map. The mapnik.SQLite() convenience constructor accepts a
number of keyword parameters; the ones most likely to be useful are:</p>
<ul class="simple">
<li><dl class="simple">
<dt>file=”…”</dt><dd><p>The name and optional path to the SQLite database file.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>table=”…”</dt><dd><p>The name of the desired table within this database.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>geometry_field=”…”</dt><dd><p>The name of a field within this table that holds the geometry to be displayed.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>key_field=”…”</dt><dd><p>The name of the primary key field within the table.</p>
</dd>
</dl>
</li>
</ul>
<p>For example, to access a table named countries in a SpatiaLite database named
mapData.db, you might use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">SQLite</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;mapData.db&quot;</span><span class="p">,</span>
                           <span class="n">table</span><span class="o">=</span><span class="s2">&quot;countries&quot;</span><span class="p">,</span>
                           <span class="n">geometry_field</span><span class="o">=</span><span class="s2">&quot;outline&quot;</span><span class="p">,</span>
                           <span class="n">key_field</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>All of the fields within the countries table will be available for use in Mapnik
filters and for display using a TextSymbolizer. The various symbolizers will use
the geometry stored in the outline field for drawing lines, polygons, and so on.</p>
</div>
</div>
</section>
<section id="osm">
<h3>OSM<a class="headerlink" href="#osm" title="此标题的永久链接">#</a></h3>
<p>OSM</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">中文</label><div class="tab-content docutils container">
<p>OSM 数据源允许你将 OpenStreetMap 数据包含到地图中。OpenStreetMap 数据存储在 .osm 格式中，这是一个包含 OpenStreetMap 使用的基本节点、路径和关系的 XML 格式。OpenStreetMap 数据格式以及下载 .osm 文件的选项可以在以下网址找到：</p>
<p><a class="reference external" href="http://wiki.openstreetmap.org/wiki/.osm">http://wiki.openstreetmap.org/wiki/.osm</a></p>
<p>如果你已经下载了一个 .osm 文件并想要在本地访问它，可以像这样设置数据源：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">OSM</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;myData.osm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你希望使用 OpenStreetMap API 调用来动态检索 OSM 数据，可以通过提供一个 URL 来读取数据，同时提供一个边界框（bounding box）来确定你想要下载的数据集。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">osmURL</span> <span class="o">=</span> <span class="s2">&quot;http://api.openstreetmap.org/api/0.6/map&quot;</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="s2">&quot;176.193,-38.172,176.276,-38.108&quot;</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">OSM</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">osmURL</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
<p>边界框是一个包含左、下、右、上四个坐标的字符串，分别表示所需边界框的坐标。</p>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">英文</label><div class="tab-content docutils container">
<p>The OSM data source allows you to include OpenStreetMap data onto a map.
The OpenStreetMap data is stored in .osm format, which is an XML format
containing the underlying nodes, ways and relations used by OpenStreetMap.
The OpenStreetMap data format, and options for downloading .osm files,
can be found at:</p>
<p><a class="reference external" href="http://wiki.openstreetmap.org/wiki/.osm">http://wiki.openstreetmap.org/wiki/.osm</a></p>
<p>If you have downloaded a .osm file and want to access it locally, you can set up
your data source like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">OSM</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">&quot;myData.osm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you wish to use an OpenStreetMap API call to retrieve the OSM data on the fly,
you can do this by supplying a URL to read the data from, along with a bounding
box to identify which set of data you want to download. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osmURL</span> <span class="o">=</span> <span class="s2">&quot;http://api.openstreetmap.org/api/0.6/map&quot;</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="s2">&quot;176.193,-38.172,176.276,-38.108&quot;</span>
<span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">OSM</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">osmURL</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
<p>The bounding box is a string containing the left, bottom, right, and top coordinates
for the desired bounding box, respectively.</p>
</div>
</div>
</section>
<section id="memorydatasource">
<h3>MemoryDatasource<a class="headerlink" href="#memorydatasource" title="此标题的永久链接">#</a></h3>
<p>MemoryDatasource</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">中文</label><div class="tab-content docutils container">
<p>MemoryDatasource 允许你手动定义出现在地图上的地理空间数据。要使用 MemoryDatasource，你首先需要创建一个 mapnik.Context 对象，定义你希望与每个要素关联的属性：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="n">context</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;ELEVATION&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>然后，你为每个要包含在地图中的要素创建一个 mapnik.Feature 对象，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</pre></div>
</div>
<p>在前面的 feature 中，id 是该要素的唯一整数 ID 值。</p>
<p>一旦要素被创建，你可以像操作 Python 字典一样定义该要素的属性：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hawkins Hill&quot;</span>
<span class="n">feature</span><span class="p">[</span><span class="s1">&#39;ELEVATION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1624</span>
</pre></div>
</div>
<p>这些属性可以被规则用于选择显示哪些要素，也可以被 TextSymbolizer 用来在地图上绘制属性的值。</p>
<p>每个要素可以有一个或多个几何形状与之关联。设置要素几何形状的最简单方法是使用 <cite>add_geometries_from_wkt()</cite> 方法，如下所示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="o">.</span><span class="n">add_geometries_from_wkt</span><span class="p">(</span><span class="s2">&quot;POINT (174.73 -41.33)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>最后，你可以使用 <cite>add_feature()</cite> 方法将该要素添加到 MemoryDatasource：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">MemoryDatasource</span><span class="p">()</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">英文</label><div class="tab-content docutils container">
<p>The MemoryDatasource allows you to manually define the geospatial data, which
appears on the map. To use a MemoryDatasource, you first create a mapnik.Context
object that defines the attributes you want to associate with each feature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">context</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="n">context</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;NAME&quot;</span><span class="p">)</span>
<span class="n">context</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;ELEVATION&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You then create a mapnik.Feature object for each of the features you want to
include on the map, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</pre></div>
</div>
<p>In the preceding feature, id is a unique integer ID value for this feature.</p>
<p>Once the feature has been created, you can define the feature’s attributes as if it was
a Python dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hawkins Hill&quot;</span>
<span class="n">feature</span><span class="p">[</span><span class="s1">&#39;ELEVATION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1624</span>
</pre></div>
</div>
<p>These attributes can be used by rules to select which features to display, and they
can also be used by a TextSymbolizer to draw an attribute’s value onto the map.</p>
<p>Each feature can have one or more geometries associated with it. The easiest way
to set the feature’s geometry is to use the add_geometries_from_wkt() method,
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feature</span><span class="o">.</span><span class="n">add_geometries_from_wkt</span><span class="p">(</span><span class="s2">&quot;POINT (174.73 -41.33)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can add the feature to the MemoryDatasource using the add_feature() method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datasource</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">MemoryDatasource</span><span class="p">()</span>
<span class="n">datasource</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id2">
<h2>规则、过滤器和样式<a class="headerlink" href="#id2" title="此标题的永久链接">#</a></h2>
<p>Rules, filters, and styles</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--9-input--1" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--1">中文</label><div class="tab-content docutils container">
<p>正如我们在本章之前所看到的，Mapnik 使用 <strong>规则</strong> 来指定用于渲染特定要素的符号化器。规则被组织到一个 <strong>样式</strong> 中，多个样式会添加到地图中，然后通过名称在设置图层时进行引用。在本节中，我们将深入探讨规则、过滤器和样式之间的关系，看看这些 Mapnik 类到底能做些什么。</p>
<p>让我们更详细地了解一下 Mapnik 的 Rule 类。一个 Mapnik 规则有两个部分：一组条件和一组符号化器。如果规则的条件满足，则会使用这些符号化器将匹配的要素绘制到地图上。</p>
<p>规则支持四种类型的条件：</p>
<ul class="simple">
<li><p><strong>过滤器</strong> （filter）：Mapnik <strong>过滤器</strong> 可以用来指定必须满足的表达式，只有满足该条件的要素才会被绘制。</p></li>
<li><p><strong>比例尺分母</strong> （scale denominators）：规则本身可以指定必须应用的最小和最大比例尺分母。可以用来设置规则，仅在地图以特定比例尺绘制时使用。</p></li>
<li><p><strong>else</strong> 条件：规则可以有一个 <strong>else</strong> 条件，这意味着只有当样式中的其他规则没有满足其条件时，这个规则才会被应用。</p></li>
<li><p><strong>also</strong> 条件：规则可以有一个 <strong>also</strong> 条件，这意味着只有当样式中至少有一个其他规则满足其条件时，这个规则才会被应用。</p></li>
</ul>
<p>如果规则的所有条件都满足，则会使用与该规则相关联的符号化器列表将要素渲染到地图上。</p>
<p>接下来，我们将更详细地看一下这些条件。</p>
</div>
<input class="tab-input" id="tab-set--9-input--2" name="tab-set--9" type="radio"><label class="tab-label" for="tab-set--9-input--2">英文</label><div class="tab-content docutils container">
<p>As we saw earlier in this chapter, Mapnik uses <strong>rules</strong> to specify which particular
symbolizers will be used to render a given feature. Rules are grouped together
into a <strong>style</strong>, and the various styles are added to your map and then referred to by
name when you set up your layer. In this section, we will examine the relationship
between rules, filters and styles, and see just what can be done with these various
Mapnik classes.</p>
<p>Let’s take a closer look at Mapnik’s Rule class. A Mapnik rule has two parts: a set
of conditions, and a list of symbolizers. If the rule’s conditions are met, then the
symbolizers will be used to draw the matching features onto the map.</p>
<p>There are four types of conditions supported by a rule:</p>
<ul class="simple">
<li><p>A mapnik <strong>filter</strong> can be used to specify an expression that must be met by the feature if it is to be drawn.</p></li>
<li><p>The rule itself can specify minimum and maximum <strong>scale denominators</strong> which must apply. This can be used to set up rules that are only used if the map is drawn at a given scale.</p></li>
<li><p>The rule can have an <strong>else</strong> condition, which means that the rule will only be applied if no other rule in the style has had its conditions met.</p></li>
<li><p>The rule can have an <strong>also</strong> condition, which means that the rule will only be applied if at least one other rule in the style has had its conditions met.</p></li>
</ul>
<p>If all the conditions for a rule are met, then the associated list of symbolizers will
be used to render the feature onto the map.</p>
<p>Let’s take a look at these conditions in more detail.</p>
</div>
</div>
<section id="id3">
<h3>过滤器<a class="headerlink" href="#id3" title="此标题的永久链接">#</a></h3>
<p>Filters</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--10-input--1" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--1">中文</label><div class="tab-content docutils container">
<p>Mapnik 的 <cite>Filter()</cite> 构造函数接受一个参数，这是一个字符串，定义了一个表达式，只有在要素满足该表达式时，规则才会应用。然后，你将返回的 <cite>Filter</cite> 对象存储到规则的 <cite>filter</cite> 属性中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>让我们考虑一个非常简单的过滤器表达式，它将字段或属性与特定值进行比较:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>字符串值可以通过在值周围加上单引号来进行比较，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;CITY&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>注意，字段名称和值都是区分大小写的，并且你必须使用方括号包围字段或属性名称。</p>
<p>当然，仅仅将字段与值进行比较是你可以进行的最基本的比较类型。过滤器表达式具有强大且灵活的语法，用于定义条件，类似于 SQL 的 <cite>WHERE</cite> 表达式。以下语法图描述了编写过滤器表达式字符串的所有选项：</p>
<img alt="../_images/323-0.png" class="align-center" src="../_images/323-0.png" />
<p>Mapnik 还允许你根据几何体的类型进行过滤，使用特殊的语法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[mapnik::geometry_type] = point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>以下几何体类型是该过滤器表达式所支持的：</p>
<ul class="simple">
<li><p>point</p></li>
<li><p>linestring</p></li>
<li><p>polygon</p></li>
<li><p>collection</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--10-input--2" name="tab-set--10" type="radio"><label class="tab-label" for="tab-set--10-input--2">英文</label><div class="tab-content docutils container">
<p>Mapnik’s Filter() constructor takes a single parameter, a string defining an
expression which the feature must match if the rule is to apply. You then store
the returned Filter object into the rule’s filter attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s consider a very simple filter expression, comparing a field or attribute against
a specific value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>String values can be compared by putting single quote marks around the value,
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;CITY&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the field name and value are both case-sensitive, and that you must
surround the field or attribute name with square brackets.</p>
<p>Of course, simply comparing a field with a value is the most basic type of comparison
you can do. Filter expressions have their own powerful and flexible syntax for defining
conditions, similar in concept to an SQL where expression. The following syntax
diagram describes all the options for writing filter expression strings:</p>
<img alt="../_images/323-0.png" class="align-center" src="../_images/323-0.png" />
<p>Mapnik also allows you to filter on the type of geometry, using a special syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[mapnik::geometry_type] = point&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following geometry types are supported by this filter expression:</p>
<ul class="simple">
<li><p>point</p></li>
<li><p>linestring</p></li>
<li><p>polygon</p></li>
<li><p>collection</p></li>
</ul>
</div>
</div>
</section>
<section id="id4">
<h3>比例分母<a class="headerlink" href="#id4" title="此标题的永久链接">#</a></h3>
<p>Scale denominators</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--11-input--1" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--1">中文</label><div class="tab-content docutils container">
<p>考虑以下两张地图：</p>
<img alt="../_images/324-0.png" class="with-border align-center" src="../_images/324-0.png" />
<p>显然，在整个世界的地图上绘制街道是没有意义的。同样，世界地图上显示的国家轮廓的比例太大，以至于无法为单个城市绘制详细的海岸线。但是，如果您的应用程序允许用户从世界地图缩放到单个街道，您将需要使用一套 Mapnik 样式来生成地图，无论您绘制的比例是多少。</p>
<p>Mapnik 允许您通过根据地图的比例分母有选择性地显示要素来实现这一点。如果您有一张以 1:100,000 比例打印的纸质地图，那么比例分母就是冒号后的数字（在本例中是 100,000）。数字化绘制地图使得这一点变得更加复杂，但其基本思想保持不变。</p>
<p>Mapnik 规则可以关联最小和最大比例分母值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="o">.</span><span class="n">min_scale</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">rule</span><span class="o">.</span><span class="n">max_scale</span> <span class="o">=</span> <span class="mi">100000</span>
</pre></div>
</div>
<p>如果设置了最小和最大比例分母，则规则只会在地图的比例分母在此范围内时应用。</p>
<p>您还可以对整个图层应用最小和最大缩放因子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">minzoom</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">100000</span>
<span class="n">layer</span><span class="o">.</span><span class="n">maxzoom</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">200000</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>请注意，规则使用比例分母，而图层使用缩放因子。这可能会有些混淆，因为两者之间的关系并不直接。有关缩放因子和比例分母的更多信息，请参见 <a class="reference external" href="http://trac.mapnik.org/wiki/ScaleAndPpi">http://trac.mapnik.org/wiki/ScaleAndPpi</a>。</p>
</div>
<p>只有当地图当前的缩放因子在此范围内时，整个图层才会显示。这在您有一个数据源只应在显示地图的某个特定比例时使用时非常有用，例如，仅在用户缩放时使用高分辨率的海岸线数据。</p>
<p>比例分母可以直观地使用，例如，比例分母值为 200,000 表示地图大约是 1:200,000 的比例。但这只是一个近似值；实际计算比例分母时必须考虑两个重要因素：</p>
<ul class="simple">
<li><p>因为 Mapnik 将地图渲染为位图图像，所以图像中每个像素的大小也会起作用。由于位图图像可以显示在不同分辨率的计算机屏幕上，Mapnik 使用由开放地理空间联盟定义的“标准化渲染像素大小”来定义像素的大小。该值为 0.28 毫米，约等于现代视频显示器上像素的大小。</p></li>
<li><p>使用的地图投影可能对计算出的比例分母产生巨大影响。地图投影总是会扭曲真实的距离，一个在赤道准确的投影可能在靠近极地时极其不准确。</p></li>
</ul>
<p>根据使用的投影不同，Mapnik 用来计算比例分母的公式可能变得相当复杂。与其担心公式，不如直接让 Mapnik 为我们计算比例分母和缩放因子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">zoom_to_box</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="nb">print</span> <span class="nb">map</span><span class="o">.</span><span class="n">scale_denominator</span><span class="p">(),</span> <span class="nb">map</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span>
</pre></div>
</div>
<p>然后，您可以将地图缩放到所需的比例，并查看缩放因子和分母，然后将其插入到样式中，选择在给定的比例分母范围内应显示哪些要素。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果您在使用多个投影时，请小心。适用于某个投影的比例分母在切换投影时可能需要进行调整。</p>
</div>
</div>
<input class="tab-input" id="tab-set--11-input--2" name="tab-set--11" type="radio"><label class="tab-label" for="tab-set--11-input--2">英文</label><div class="tab-content docutils container">
<p>Consider the following two maps:</p>
<img alt="../_images/324-0.png" class="with-border align-center" src="../_images/324-0.png" />
<p>Obviously, there’s no point in drawing streets onto a map of the entire world.
Similarly, the country outlines shown on the world map are at too large a scale to
draw detailed coastlines for an individual city. But if your application allows the
user to zoom in from the world map right down to an individual street, you will
need to use a single set of Mapnik styles to generate the map regardless of the
scale at which you are drawing it.</p>
<p>Mapnik allows you to do this by selectively displaying features based on the map’s
scale denominator. If you had a map printed on paper at 1:100,000 scale, then
the scale denominator would be the number after the colon (100,000 in this case).
Drawing maps digitally makes this a bit more complicated, but the idea remains
the same.</p>
<p>A Mapnik rule can have a minimum and maximum scale denominator value
associated with it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule</span><span class="o">.</span><span class="n">min_scale</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">rule</span><span class="o">.</span><span class="n">max_scale</span> <span class="o">=</span> <span class="mi">100000</span>
</pre></div>
</div>
<p>If the minimum and maximum scale denominators are set, then the rule will only
apply if the map’s scale denominator is within this range.</p>
<p>You can also apply minimum and maximum scale factors to an entire layer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">minzoom</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">100000</span>
<span class="n">layer</span><span class="o">.</span><span class="n">maxzoom</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">200000</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Note that rules use scale denominators while layers use scale factors.
This can be rather confusing, as the relationship between the two is
not straightforward. For more information on scale factors and scale
denominators, please refer to <a class="reference external" href="http://trac.mapnik.org/wiki/">http://trac.mapnik.org/wiki/</a>
ScaleAndPpi.</p>
</div>
<p>The whole layer will only be displayed when the map’s current scale factor is within
this range. This is useful if you have a data source that should only be used when
displaying the map at a certain scale—for example, only using high-resolution
shoreline data when the user has zoomed in.</p>
<p>Scale denominators can be used intuitively, for example a scale denominator
value of 200,000 represents a map drawn at roughly 1:200,000 scale. But this is
only an approximation; the actual calculation of a scale denominator has to take
into account two important factors:</p>
<ul class="simple">
<li><p>Because Mapnik renders a map as a bitmapped image, the size of the individual pixels within the image comes into play. Since bitmapped images can be displayed on a variety of different computer screens with different pixel sizes, Mapnik uses a “standardized rendering pixel size” as defined by the Open Geospatial Consortium to define how big a pixel is going to be. This value is 0.28 mm, and is approximately the size of a pixel on modern video displays.</p></li>
<li><p>The map projection being used can have a huge effect on the calculated scale denominator. Map projections always distort true distances, and a projection which is accurate at the equator may be wildly inaccurate closer to the poles.</p></li>
</ul>
<p>Depending on the projection being used, the formula Mapnik uses to calculate
the scale denominator can get rather complicated. Rather than worrying about
the formulas, it is much easier just to ask Mapnik to calculate the scale denominator
and scale factor for us:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">projection</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">zoom_to_box</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="nb">print</span> <span class="nb">map</span><span class="o">.</span><span class="n">scale_denominator</span><span class="p">(),</span> <span class="nb">map</span><span class="o">.</span><span class="n">scale</span><span class="p">()</span>
</pre></div>
</div>
<p>You can then zoom the map to your desired scale and see what the scale factor and
denominator are, which you can then plug into your styles to choose which features
should be displayed at a given scale denominator range.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Be careful if you are working with multiple projections. A scale denominator that works for one projection may need to be adjusted if you switch projections.</p>
</div>
</div>
</div>
</section>
<section id="else">
<h3>“Else”规则<a class="headerlink" href="#else" title="此标题的永久链接">#</a></h3>
<p>“Else” rules</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--12-input--1" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--1">中文</label><div class="tab-content docutils container">
<p>假设您想要将一些要素绘制成一种颜色，而所有其他要素绘制成另一种颜色。实现这一目标的一种方式是使用 Mapnik 规则，像这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] != 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>对于简单的筛选表达式，这样的方法是有效的，但当表达式变得更加复杂时，使用 “else” 规则会更加方便，像这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">set_else</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>如果您对一个规则调用 <cite>set_else(True)</cite>，那么这个规则将在只有当同一样式中没有任何先前规则满足其筛选条件时才会被应用。</p>
<p>“Else” 规则特别有用，尤其是在您有多个筛选条件，并且希望在没有其他规则被使用来绘制要素时，拥有一个“捕获所有”规则。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;city&#39;&quot;</span><span class="p">)</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;town&#39;&quot;</span><span class="p">)</span>
<span class="n">rule3</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;village&#39;&quot;</span><span class="p">)</span>
<span class="n">rule4</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">set_else</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--12-input--2" name="tab-set--12" type="radio"><label class="tab-label" for="tab-set--12-input--2">英文</label><div class="tab-content docutils container">
<p>Imagine that you want to draw some features in one color, and all other features in
a different color. One way to achieve this is by using Mapnik rules, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] != 1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is fine for simple filter expressions, but when the expressions get more
complicated it is a lot easier to use an “else” rule, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[level] = 1&quot;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">set_else</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If you call set_else(True) for a rule, then this rule is to be used if and only if no
previous rule in the same style has had its filter conditions met.</p>
<p>Else rules are particularly useful if you have a number of filter conditions and
want to have a “catch-all” rule at the end, which will apply if no other rule has
been used to draw the feature. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;city&#39;&quot;</span><span class="p">)</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;town&#39;&quot;</span><span class="p">)</span>
<span class="n">rule3</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[type] = &#39;village&#39;&quot;</span><span class="p">)</span>
<span class="n">rule4</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">set_else</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="also">
<h3>“Also”规则<a class="headerlink" href="#also" title="此标题的永久链接">#</a></h3>
<p>“Also” rules</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--13-input--1" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--1">中文</label><div class="tab-content docutils container">
<p>假设您已经定义了一系列规则，用不同的颜色绘制国家多边形，取决于联合国区域代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;002&#39;&quot;</span><span class="p">)</span>  <span class="c1"># 非洲</span>
<span class="n">rule1</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color1</span><span class="p">))</span>

<span class="n">rule2</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;019&#39;&quot;</span><span class="p">)</span>  <span class="c1"># 美洲</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color2</span><span class="p">))</span>

<span class="n">rule3</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule3</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;142&#39;&quot;</span><span class="p">)</span>  <span class="c1"># 亚洲</span>
<span class="n">rule3</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color3</span><span class="p">))</span>

<span class="n">rule4</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule4</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;150&#39;&quot;</span><span class="p">)</span>  <span class="c1"># 欧洲</span>
<span class="n">rule4</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color3</span><span class="p">))</span>

<span class="n">rule5</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule5</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;009&#39;&quot;</span><span class="p">)</span>  <span class="c1"># 大洋洲</span>
<span class="n">rule5</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color3</span><span class="p">))</span>
</pre></div>
</div>
<p>在填充这些多边形之后，您现在想要在多边形的边界画上一条黑色的线。您可以通过两种方式来实现：要么为您的五个规则中的每一个添加一个 <cite>LineSymbolizer</cite>，要么使用一个 <strong>also</strong> 规则。</p>
<p><strong>Also</strong> 规则基本上是 <strong>else</strong> 规则的反面： <strong>also</strong> 规则仅在至少一个其他规则适用于该要素时才会应用。</p>
<p>这是如何使用 <strong>also</strong> 规则在所有填充的多边形周围画上边框的方法：</p>
<blockquote>
<div><p>rule6 = mapnik.Rule()
rule6.set_also(True)
rule6.symbols.append(mapnik.LineSymbolizer(color6, 0.1))</p>
</div></blockquote>
<p>如果任何其他规则应用于该要素，那么这个规则就会被应用——也就是说，它会在任何填充的多边形周围画上边框。但如果某个要素位于其他规则未覆盖的区域内，则不会画出边框。</p>
</div>
<input class="tab-input" id="tab-set--13-input--2" name="tab-set--13" type="radio"><label class="tab-label" for="tab-set--13-input--2">英文</label><div class="tab-content docutils container">
<p>Imagine that you’ve defined a series of rules to draw country polygons in different
colors depending on the UN region code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule1</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule1</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;002&quot;</span><span class="p">)</span> <span class="c1"># Africa.</span>
<span class="n">rule1</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color1</span><span class="p">))</span>

<span class="n">rule2</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule2</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;019&#39;&quot;</span><span class="p">)</span> <span class="c1"># Americas.</span>
<span class="n">rule1</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color2</span><span class="p">))</span>

<span class="n">rule3</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule3</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;142&#39;&quot;</span><span class="p">)</span> <span class="c1"># Asia.</span>
<span class="n">rule3</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color3</span><span class="p">))</span>

<span class="n">rule4</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule4</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;150&#39;&quot;</span><span class="p">)</span> <span class="c1"># Europe.</span>
<span class="n">rule4</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color3</span><span class="p">))</span>

<span class="n">rule5</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule5</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s2">&quot;[region] = &#39;009&#39;&quot;</span><span class="p">)</span> <span class="c1"># Oceania.</span>
<span class="n">rule5</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">(</span><span class="n">color3</span><span class="p">))</span>
</pre></div>
</div>
<p>Having filled these polygons, you now want to draw a black line around the polygon
boundary. There are two ways you could do this: you could add a LineSymbolizer to
each of your five rules, or you could use an also rule.</p>
<p>An also rule is basically the opposite of the else rule: the also rule only applies if at
least one other rule applies to the feature.</p>
<p>Here is how you could use an also rule to draw a border around all the filled polygons:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule6</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Rule</span><span class="p">()</span>
<span class="n">rule6</span><span class="o">.</span><span class="n">set_also</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rule6</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">color6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
</pre></div>
</div>
<p>This rule would apply if any of the other rules applied to the feature—that is, it
would draw a border around any polygon that gets filled in. But if any feature is
in a region not covered by the other rules, no border will be drawn.</p>
</div>
</div>
</section>
</section>
<section id="id5">
<h2>符号化器<a class="headerlink" href="#id5" title="此标题的永久链接">#</a></h2>
<p>Symbolizers</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--14-input--1" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--1">中文</label><div class="tab-content docutils container">
<p>符号器用于将特征绘制到地图上。在本节中，我们将了解如何使用各种类型的符号器绘制线条、多边形、标签、点和图像。</p>
</div>
<input class="tab-input" id="tab-set--14-input--2" name="tab-set--14" type="radio"><label class="tab-label" for="tab-set--14-input--2">英文</label><div class="tab-content docutils container">
<p>Symbolizers are used to draw features onto a map. In this section, we will look
at how you can use various types of symbolizers to draw lines, polygons, labels,
points, and images.</p>
</div>
</div>
<section id="id6">
<h3>绘制线条<a class="headerlink" href="#id6" title="此标题的永久链接">#</a></h3>
<p>Drawing lines</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--15-input--1" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--1">中文</label><div class="tab-content docutils container">
<p>有两种 Mapnik 符号器可用于在地图上绘制线条：LineSymbolizer 和 LinePatternSymbolizer。让我们依次了解一下它们。</p>
</div>
<input class="tab-input" id="tab-set--15-input--2" name="tab-set--15" type="radio"><label class="tab-label" for="tab-set--15-input--2">英文</label><div class="tab-content docutils container">
<p>There are two Mapnik symbolizers that can be used to draw lines onto a map:
LineSymbolizer and LinePatternSymbolizer. Let’s looks at each of these in turn.</p>
</div>
</div>
<section id="id7">
<h4>线符号化器<a class="headerlink" href="#id7" title="此标题的永久链接">#</a></h4>
<p>LineSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--16-input--1" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--1">中文</label><div class="tab-content docutils container">
<p><strong>LineSymbolizer</strong> 用于绘制线性特征和多边形的轮廓，如下图所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">image</span><span class="p">::</span> <span class="o">./</span><span class="n">img</span><span class="o">/</span><span class="mi">328</span><span class="o">-</span><span class="mf">0.</span><span class="n">png</span>
</pre></div>
</div>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">class<span class="colon">:</span></dt>
<dd class="field-odd"><p>with-border</p>
</dd>
<dt class="field-even">align<span class="colon">:</span></dt>
<dd class="field-even"><p>center</p>
</dd>
</dl>
</div></blockquote>
<p><strong>LineSymbolizer</strong> 是 Mapnik 中最有用的符号之一。以下是用于绘制前面示例中虚线的 Python 代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Stroke</span><span class="p">()</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#008000&quot;</span><span class="p">)</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">add_dash</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span>
</pre></div>
</div>
<p>如您所见，<strong>LineSymbolizer</strong> 使用 Mapnik 的 <strong>Stroke</strong> 对象来定义线条的绘制方式。使用 <strong>LineSymbolizer</strong> 时，首先需要创建 <strong>Stroke</strong> 对象，并设置各种选项来定义线条的绘制方式。然后，创建 <strong>LineSymbolizer</strong>，并将 <strong>stroke</strong> 对象传递给 <strong>LineSymbolizer</strong> 的构造函数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span>
</pre></div>
</div>
<p>接下来，我们将更详细地了解 <strong>Stroke</strong> 对象提供的各种线条绘制选项。</p>
</div>
<input class="tab-input" id="tab-set--16-input--2" name="tab-set--16" type="radio"><label class="tab-label" for="tab-set--16-input--2">英文</label><div class="tab-content docutils container">
<p>The <strong>LineSymbolizer</strong> draws linear features and traces around the outline of
polygons, as shown in the following diagram:</p>
<img alt="../_images/328-0.png" class="with-border align-center" src="../_images/328-0.png" />
<p>The LineSymbolizer is one of the most useful of the Mapnik symbolizers. Here is
the Python code that created the LineSymbolizer used to draw the dashed line in
the preceding example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Stroke</span><span class="p">()</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#008000&quot;</span><span class="p">)</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">add_dash</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the LineSymbolizer uses a Mapnik Stroke object to define how the
line will be drawn. To use a LineSymbolizer, you first create the Stroke object and
set the various options for how you want the line to be drawn. You then create your
LineSymbolizer, passing the stroke object to the LineSymbolizer’s constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s take a closer look at the various line-drawing options provided by the
Stroke object.</p>
</div>
</div>
</section>
<section id="line-color">
<h4>Line color<a class="headerlink" href="#line-color" title="此标题的永久链接">#</a></h4>
<p>Line color</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--17-input--1" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，线条以黑色绘制。您可以通过将笔触的颜色属性设置为 Mapnik Color 对象来更改此设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>有关 Mapnik 颜色对象的更多信息以及指定颜色的各种方式，请参阅本章后面的使用颜色部分。</p>
</div>
<input class="tab-input" id="tab-set--17-input--2" name="tab-set--17" type="radio"><label class="tab-label" for="tab-set--17-input--2">英文</label><div class="tab-content docutils container">
<p>By default, lines are drawn in black. You can change this by setting the stroke’s
color attribute to a Mapnik Color object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information about the Mapnik Color object, and the various ways in which
you can specify a color, please refer to the Using Colors section later in this chapter.</p>
</div>
</div>
</section>
<section id="line-width">
<h4>Line width<a class="headerlink" href="#line-width" title="此标题的永久链接">#</a></h4>
<p>Line width</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--18-input--1" name="tab-set--18" type="radio"><label class="tab-label" for="tab-set--18-input--1">中文</label><div class="tab-content docutils container">
<p>LineSymbolizer 绘制的线条默认宽度为 1 像素。要更改此设置，请将笔划的宽度属性设置为所需宽度（以像素为单位）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1.5</span>
</pre></div>
</div>
<p>请注意，您可以使用分数线宽来细粒度控制线宽。</p>
</div>
<input class="tab-input" id="tab-set--18-input--2" name="tab-set--18" type="radio"><label class="tab-label" for="tab-set--18-input--2">英文</label><div class="tab-content docutils container">
<p>The line drawn by a LineSymbolizer will be one pixel wide by default. To change
this, set the stroke’s width attribute to the desired width, in pixels:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">1.5</span>
</pre></div>
</div>
<p>Note that you can use fractional line widths for fine-grained control of your
line widths.</p>
</div>
</div>
</section>
<section id="opacity">
<h4>Opacity<a class="headerlink" href="#opacity" title="此标题的永久链接">#</a></h4>
<p>Opacity</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--19-input--1" name="tab-set--19" type="radio"><label class="tab-label" for="tab-set--19-input--1">中文</label><div class="tab-content docutils container">
<p>您可以通过设置笔触的不透明度属性来更改线条的不透明度或透明度:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.8</span>
</pre></div>
</div>
<p>不透明度的范围为 0.0（完全透明）至 1.0（完全不透明）。如果未指定不透明度，则线条将完全不透明。</p>
</div>
<input class="tab-input" id="tab-set--19-input--2" name="tab-set--19" type="radio"><label class="tab-label" for="tab-set--19-input--2">英文</label><div class="tab-content docutils container">
<p>You can change how opaque or transparent the line is by setting the stroke’s opacity attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.8</span>
</pre></div>
</div>
<p>The opacity can range from 0.0 (completely transparent) to 1.0 (completely opaque).
If the opacity is not specified, the line will be completely opaque.</p>
</div>
</div>
</section>
<section id="line-caps">
<h4>Line caps<a class="headerlink" href="#line-caps" title="此标题的永久链接">#</a></h4>
<p>Line caps</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--20-input--1" name="tab-set--20" type="radio"><label class="tab-label" for="tab-set--20-input--1">中文</label><div class="tab-content docutils container">
<p>线帽指定应如何绘制线的末端。Mapnik 支持三种标准线帽设置:</p>
<img alt="../_images/329-0.png" class="with-border align-center" src="../_images/329-0.png" />
<p>默认情况下，线条将使用 BUTT_CAP 样式，但你可以通过设置笔触的 line_cap 属性来更改此样式，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke1</span><span class="o">.</span><span class="n">line_cap</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_cap</span><span class="o">.</span><span class="n">BUTT_CAP</span>
<span class="n">stroke2</span><span class="o">.</span><span class="n">line_cap</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_cap</span><span class="o">.</span><span class="n">ROUND_CAP</span>
<span class="n">stroke3</span><span class="o">.</span><span class="n">line_cap</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_cap</span><span class="o">.</span><span class="n">SQUARE_CAP</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--20-input--2" name="tab-set--20" type="radio"><label class="tab-label" for="tab-set--20-input--2">英文</label><div class="tab-content docutils container">
<p>The line cap specifies how the ends of the line should be drawn. Mapnik supports three standard line cap settings:</p>
<img alt="../_images/329-0.png" class="with-border align-center" src="../_images/329-0.png" />
<p>By default, the lines will use BUTT_CAP style, but you can change this by setting the stroke’s line_cap attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke1</span><span class="o">.</span><span class="n">line_cap</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_cap</span><span class="o">.</span><span class="n">BUTT_CAP</span>
<span class="n">stroke2</span><span class="o">.</span><span class="n">line_cap</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_cap</span><span class="o">.</span><span class="n">ROUND_CAP</span>
<span class="n">stroke3</span><span class="o">.</span><span class="n">line_cap</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_cap</span><span class="o">.</span><span class="n">SQUARE_CAP</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="line-joins">
<h4>Line joins<a class="headerlink" href="#line-joins" title="此标题的永久链接">#</a></h4>
<p>Line joins</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--21-input--1" name="tab-set--21" type="radio"><label class="tab-label" for="tab-set--21-input--1">中文</label><div class="tab-content docutils container">
<p>当一条线改变方向时，线的“角”可以用三种标准方式之一来画出:</p>
<img alt="../_images/330-0.png" class="with-border align-center" src="../_images/330-0.png" />
<p>默认行为是使用 MITER_JOIN，但您可以通过将笔划的 line_join 属性设置为其他值来更改此行为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke1</span><span class="o">.</span><span class="n">line_join</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_join</span><span class="o">.</span><span class="n">MITER_JOIN</span>
<span class="n">stroke2</span><span class="o">.</span><span class="n">line_join</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_join</span><span class="o">.</span><span class="n">ROUND_JOIN</span>
<span class="n">stroke3</span><span class="o">.</span><span class="n">line_join</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_join</span><span class="o">.</span><span class="n">BEVEL_JOIN</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--21-input--2" name="tab-set--21" type="radio"><label class="tab-label" for="tab-set--21-input--2">英文</label><div class="tab-content docutils container">
<p>When a line changes direction, the “corner” of the line can be drawn in one of three
standard ways:</p>
<img alt="../_images/330-0.png" class="with-border align-center" src="../_images/330-0.png" />
<p>The default behavior is to use MITER_JOIN, but you can change this by setting the
stroke’s line_join attribute to a different value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke1</span><span class="o">.</span><span class="n">line_join</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_join</span><span class="o">.</span><span class="n">MITER_JOIN</span>
<span class="n">stroke2</span><span class="o">.</span><span class="n">line_join</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_join</span><span class="o">.</span><span class="n">ROUND_JOIN</span>
<span class="n">stroke3</span><span class="o">.</span><span class="n">line_join</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">line_join</span><span class="o">.</span><span class="n">BEVEL_JOIN</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dashed-and-dotted-lines">
<h4>Dashed and dotted lines<a class="headerlink" href="#dashed-and-dotted-lines" title="此标题的永久链接">#</a></h4>
<p>Dashed and dotted lines</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--22-input--1" name="tab-set--22" type="radio"><label class="tab-label" for="tab-set--22-input--1">中文</label><div class="tab-content docutils container">
<p>你可以通过给线条添加“断点”来使其看起来像虚线或点线。为此，你需要给 <strong>Stroke</strong> 添加一个或多个 <strong>dash segments</strong>。每个 <strong>dash segment</strong> 定义了 <em>短划线长度</em> 和 <em>间隔长度</em>；线条会按照指定的短划线长度绘制，然后会留出指定长度的间隔，接着继续绘制线条：</p>
<img alt="../_images/330-1.png" class="with-border align-center" src="../_images/330-1.png" />
<p>通过调用 <strong>stroke</strong> 的 <strong>add_dash()</strong> 方法，你可以将 <strong>dash segment</strong> 添加到线条上，像这样：</p>
<blockquote>
<div><p>stroke.add_dash(5, 7)</p>
</div></blockquote>
<p>这将使线条先绘制一个五像素的短划线，然后留下一个七像素的间隔。</p>
<p>你并不局限于只有一个 <strong>dash segment</strong>；如果你多次调用 <strong>add_dash()</strong>，就可以创建具有多个段的线条。这些 <strong>dash segments</strong> 会依次处理，从而让你创造出不同的虚线和点线模式。例如：</p>
<blockquote>
<div><p>stroke.add_dash(10, 2)
stroke.add_dash(2, 2)
stroke.add_dash(2, 2)</p>
</div></blockquote>
<p>上面的代码将产生如下的重复线条模式：</p>
<img alt="../_images/331-0.png" class="with-border align-center" src="../_images/331-0.png" />
<p>你可以通过使用 <strong>dashoffset</strong> 属性来控制虚线的起始位置。例如，如果你在前面的 <strong>Stroke</strong> 中添加以下内容：</p>
<blockquote>
<div><p>stroke.dashoffset = -5</p>
</div></blockquote>
<p>你的线条现在看起来将是这样的：</p>
<img alt="../_images/331-1.png" class="with-border align-center" src="../_images/331-1.png" />
<p>如你所见，负的 <strong>dashoffset</strong> 会将线条模式向左移动，而正的 <strong>dashoffset</strong> 会将模式向右移动。</p>
</div>
<input class="tab-input" id="tab-set--22-input--2" name="tab-set--22" type="radio"><label class="tab-label" for="tab-set--22-input--2">英文</label><div class="tab-content docutils container">
<p>You can add “breaks” to a line to make it appear dashed or dotted. To do this, you
add one or more <strong>dash segments</strong> to the stroke. Each dash segment defines a <em>dash
length</em> and a <em>gap length</em>; the line will be drawn for the given dash length, and will
then leave a gap of the specified length before continuing to draw the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span> <span class="n">image</span><span class="p">::</span> <span class="o">./</span><span class="n">img</span><span class="o">/</span><span class="mi">330</span><span class="o">-</span><span class="mf">1.</span><span class="n">png</span>
</pre></div>
</div>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">align<span class="colon">:</span></dt>
<dd class="field-odd"><p>center</p>
</dd>
<dt class="field-even">class<span class="colon">:</span></dt>
<dd class="field-even"><p>with-border</p>
</dd>
</dl>
</div></blockquote>
<p>You add a dash segment to a line by calling the stroke’s add_dash() method, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">add_dash</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>This will give the line a five pixel dash followed by a seven pixel gap.</p>
<p>You aren’t limited to just having a single dash segment; if you call add_dash()
multiple times, you will create a line with more than one segments. These dash
segments will be processed in turn, allowing you to create varying patterns of
dashes and dots. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">add_dash</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">add_dash</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">add_dash</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The preceding code would result in the following repeating line pattern:</p>
<img alt="../_images/331-0.png" class="with-border align-center" src="../_images/331-0.png" />
<p>You can control where the dashed line starts by using the dashoffset attribute.
For example, if you added the following to the preceding Stroke:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span><span class="o">.</span><span class="n">dashoffset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
</pre></div>
</div>
<p>Your line would now look like this:</p>
<img alt="../_images/331-1.png" class="with-border align-center" src="../_images/331-1.png" />
<p>As you can see, a negative dash offset shifts the line pattern to the left, while a
positive offset shifts the pattern to the right.</p>
</div>
</div>
</section>
<section id="drawing-roads-and-other-complex-linear-features">
<h4>Drawing roads and other complex linear features<a class="headerlink" href="#drawing-roads-and-other-complex-linear-features" title="此标题的永久链接">#</a></h4>
<p>Drawing roads and other complex linear features</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--23-input--1" name="tab-set--23" type="radio"><label class="tab-label" for="tab-set--23-input--1">中文</label><div class="tab-content docutils container">
<p>一个可能不会立即显现出来的事实是，您可以通过叠加两个 <cite>LineSymbolizer</cite> 来绘制一条道路；第一个 <cite>LineSymbolizer</cite> 绘制道路的边缘，而第二个 <cite>LineSymbolizer</cite> 绘制道路的内部。例如：</p>
<blockquote>
<div><p>stroke = mapnik.Stroke()
stroke.color = mapnik.Color(“#bf7a3a”)
stroke.width = 7.0
roadEdgeSymbolizer = mapnik.LineSymbolizer(stroke)</p>
<p>stroke = mapnik.Stroke()
stroke.color = mapnik.Color(“#ffd3a9”)
stroke.width = 6.0
roadInteriorSymbolizer = mapnik.LineSymbolizer(stroke)</p>
</div></blockquote>
<p>这种技术常用于绘制街道地图。上面定义的两个符号化器将叠加在一起，产生像这样的道路：</p>
<img alt="../_images/331-2.png" class="with-border align-center" src="../_images/331-2.png" />
<p>这种技术不仅可以用于绘制道路；符号化器的创造性使用是使用 Mapnik 实现复杂视觉效果的主要“技巧”之一。</p>
</div>
<input class="tab-input" id="tab-set--23-input--2" name="tab-set--23" type="radio"><label class="tab-label" for="tab-set--23-input--2">英文</label><div class="tab-content docutils container">
<p>One thing that may not be immediately obvious is that you can draw a road onto a
map by overlying two LineSymbolizers; the first LineSymbolizer draws the edges of
the road, while the second LineSymbolizer draws the road’s interior. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stroke</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Stroke</span><span class="p">()</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#bf7a3a&quot;</span><span class="p">)</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">7.0</span>
<span class="n">roadEdgeSymbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span>

<span class="n">stroke</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Stroke</span><span class="p">()</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;#ffd3a9&quot;</span><span class="p">)</span>
<span class="n">stroke</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">6.0</span>
<span class="n">roadInteriorSymbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LineSymbolizer</span><span class="p">(</span><span class="n">stroke</span><span class="p">)</span>
</pre></div>
</div>
<p>This technique is commonly used for drawing street maps. The two symbolizers
defined above would then be overlaid to produce a road like this:</p>
<img alt="../_images/331-2.png" class="with-border align-center" src="../_images/331-2.png" />
<p>This technique can be used for more than just drawing roads; the creative use
of symbolizers is one of the main “tricks” to achieving complex visual effects
using Mapnik.</p>
</div>
</div>
</section>
<section id="linepatternsymbolizer">
<h4>LinePatternSymbolizer<a class="headerlink" href="#linepatternsymbolizer" title="此标题的永久链接">#</a></h4>
<p>LinePatternSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--24-input--1" name="tab-set--24" type="radio"><label class="tab-label" for="tab-set--24-input--1">中文</label><div class="tab-content docutils container">
<p><cite>LinePatternSymbolizer</cite> 用于在您想绘制一条无法使用简单 <cite>Stroke</cite> 对象渲染的线时。<cite>LinePatternSymbolizer</cite> 接受一个图像文件，并沿着线段的长度或多边形的轮廓反复绘制该图像。例如，使用以下图像文件：</p>
<img alt="../_images/332-0.png" class="with-border align-center" src="../_images/332-0.png" />
<p><cite>LinePatternSymbolizer</cite> 将以如下方式绘制线条和多边形：</p>
<img alt="../_images/332-1.png" class="with-border align-center" src="../_images/332-1.png" />
<p>请注意，线性特征和多边形边界具有方向性——即，线或多边形边框从一个点移动到下一个点，按照定义几何形状时点的顺序。例如，在前面的例子中，构成线段的点是从左到右定义的——也就是说，最左侧的点首先定义，然后是中间点，最后是最右侧的点。</p>
<p>特征的方向很重要，因为它会影响 <cite>LinePatternSymbolizer</cite> 绘制图像的方式。如果前面的线串是以相反的方向定义的，<cite>LinePatternSymbolizer</cite> 将像这样绘制它：</p>
<img alt="../_images/332-2.png" class="with-border align-center" src="../_images/332-2.png" />
<p>正如您所看到的，<cite>LinePatternSymbolizer</cite> 绘制图像时会朝向线的左侧，随着它从一个点移动到下一个点。要使图像朝向右侧绘制，您需要反转特征中点的顺序。</p>
<p>要在 Python 代码中使用 <cite>LinePatternSymbolizer</cite>，您需要创建一个 <cite>mapnik.PathExpression</cite> 对象，该对象引用您想要使用的图像文件。然后，将该对象传递给 <cite>LinePatternSymbolizer</cite> 的初始化器，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PathExpression</span><span class="p">(</span><span class="s2">&quot;path/to/image.png&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LinePatternSymbolizer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--24-input--2" name="tab-set--24" type="radio"><label class="tab-label" for="tab-set--24-input--2">英文</label><div class="tab-content docutils container">
<p>The LinePatternSymbolizer is used in situations where you want to draw a line that
can’t be rendered using a simple Stroke object. The LinePatternSymbolizer accepts an
image file and draws that image repeatedly along the length of the line or around the
outline of a polygon. For example, using the following image file:</p>
<img alt="../_images/332-0.png" class="with-border align-center" src="../_images/332-0.png" />
<p>A LinePatternSymbolizer would draw lines and polygons in the following way:</p>
<img alt="../_images/332-1.png" class="with-border align-center" src="../_images/332-1.png" />
<p>Note that linear features and polygon boundaries have a direction—that is, the line
or polygon border moves from one point to the next, in the order in which the points
were defined when the geometry was created. For example, the points that make up
the line segment in the preceding example were defined from left to right—that is,
the leftmost point is defined first, then the center point, and then the rightmost point.</p>
<p>The direction of a feature is important as it affects the way the LinePatternSymbolizer
draws the image. If the preceding linestring was defined in the opposite direction,
the LinePatternSymbolizer would draw it like this:</p>
<img alt="../_images/332-2.png" class="with-border align-center" src="../_images/332-2.png" />
<p>As you can see, the LinePatternSymbolizer draws the image oriented towards the
left of the line, as it moves from one point to the next. To draw the image oriented
towards the right, you will have to reverse the order of the points within your feature.</p>
<p>To use a LinePatternSymbolizer within your Python code, you create a mapnik.
PathExpression object that refers to the image file you want to use. You then pass
this object to the LinePatternSymbolizer initializer, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PathExpression</span><span class="p">(</span><span class="s2">&quot;path/to/image.png&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">LinePatternSymbolizer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id8">
<h3>绘制多边形<a class="headerlink" href="#id8" title="此标题的永久链接">#</a></h3>
<p>Drawing polygons</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--25-input--1" name="tab-set--25" type="radio"><label class="tab-label" for="tab-set--25-input--1">中文</label><div class="tab-content docutils container">
<p>正如有两个符号器用于绘制线条一样，也有两个符号器用于绘制多边形的内部：PolygonSymbolizer 和 PolygonPatternSymbolizer。让我们仔细看看这两个符号器。</p>
</div>
<input class="tab-input" id="tab-set--25-input--2" name="tab-set--25" type="radio"><label class="tab-label" for="tab-set--25-input--2">英文</label><div class="tab-content docutils container">
<p>Just as there are two symbolizers to draw lines, there are two symbolizers to draw
the interior of a polygon: the PolygonSymbolizer and the PolygonPatternSymbolizer.
Let’s take a closer look at each of these two symbolizers.</p>
</div>
</div>
<section id="polygonsymbolizer">
<h4>PolygonSymbolizer<a class="headerlink" href="#polygonsymbolizer" title="此标题的永久链接">#</a></h4>
<p>PolygonSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--26-input--1" name="tab-set--26" type="radio"><label class="tab-label" for="tab-set--26-input--1">中文
<cite>PolygonSymbolizer</cite> 用于用单一颜色填充多边形的内部：</label><div class="tab-content docutils container">
<img alt="../_images/333-0.png" class="with-border align-center" src="../_images/333-0.png" />
<p>您可以像这样创建一个 <cite>PolygonSymbolizer</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">()</span>
</pre></div>
</div>
<p>让我们更仔细地看看控制多边形绘制方式的各种选项。</p>
</div>
<input class="tab-input" id="tab-set--26-input--2" name="tab-set--26" type="radio"><label class="tab-label" for="tab-set--26-input--2">英文</label><div class="tab-content docutils container">
<p>A PolygonSymbolizer fills the interior of a polygon with a single color:</p>
<img alt="../_images/333-0.png" class="with-border align-center" src="../_images/333-0.png" />
<p>You create a PolygonSymbolizer like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonSymbolizer</span><span class="p">()</span>
</pre></div>
</div>
<p>Let’s take a closer look at the various options for controlling how the polygon will
be drawn.</p>
</div>
</div>
</section>
<section id="fill-color">
<h4>Fill color<a class="headerlink" href="#fill-color" title="此标题的永久链接">#</a></h4>
<p>Fill color</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--27-input--1" name="tab-set--27" type="radio"><label class="tab-label" for="tab-set--27-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，<strong>PolygonSymbolizer</strong> 会将多边形的内部填充为灰色。要更改用于填充多边形的颜色，可以将 <strong>PolygonSymbolizer</strong> 的 <strong>fill</strong> 属性设置为所需的 Mapnik <strong>Color</strong> 对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>有关如何创建 Mapnik <strong>Color</strong> 对象的更多信息，请参阅本章后面的 <strong>使用颜色</strong> 部分。</p>
</div>
<input class="tab-input" id="tab-set--27-input--2" name="tab-set--27" type="radio"><label class="tab-label" for="tab-set--27-input--2">英文</label><div class="tab-content docutils container">
<p>By default, a PolygonSymbolizer will draw the interior of the polygon in grey. To
change the color used to fill the polygon, set the PolygonSymbolizer’s fill attribute
to the desired mapnik Color object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information about creating Mapnik Color objects, please refer to the Using Colors section later in this chapter.</p>
</div>
</div>
</section>
<section id="id9">
<h4>Opacity<a class="headerlink" href="#id9" title="此标题的永久链接">#</a></h4>
<p>Opacity</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--28-input--1" name="tab-set--28" type="radio"><label class="tab-label" for="tab-set--28-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，多边形将完全不透明。您可以通过设置 <strong>PolygonSymbolizer</strong> 的 <strong>opacity</strong> 属性来更改这一点，如下所示:</p>
<p>symbolizer.fill_opacity = 0.5</p>
<p>透明度的值范围从 0.0（完全透明）到 1.0（完全不透明）。在前面的插图中，左侧的多边形的透明度为 0.5。</p>
</div>
<input class="tab-input" id="tab-set--28-input--2" name="tab-set--28" type="radio"><label class="tab-label" for="tab-set--28-input--2">英文</label><div class="tab-content docutils container">
<p>By default, the polygon will be completely opaque. You can change this by setting
the PolygonSymbolizer’s opacity attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">fill_opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p>The opacity can range from 0.0 (completely transparent) to 1.0 (completely opaque).
In the preceding illustration, the left polygon had an opacity of 0.5.</p>
</div>
</div>
</section>
<section id="gamma-correction">
<h4>Gamma correction<a class="headerlink" href="#gamma-correction" title="此标题的永久链接">#</a></h4>
<p>Gamma correction</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--29-input--1" name="tab-set--29" type="radio"><label class="tab-label" for="tab-set--29-input--1">中文</label><div class="tab-content docutils container">
<p>伽马校正是一个晦涩的概念，但有时非常有用。如果你绘制两个恰好相邻且填充颜色完全相同的多边形，你仍然会看到两者之间有一条线：</p>
<img alt="../_images/334-0.png" class="with-border align-center" src="../_images/334-0.png" />
<p>这是因为 Mapnik 在处理多边形的边缘时使用了抗锯齿技术。如果你希望相邻多边形之间的线条消失，可以添加一个伽马校正因子，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.63</span>
</pre></div>
</div>
<p>这样，两个多边形就会看起来合并为一个：</p>
<img alt="../_images/334-1.png" class="with-border align-center" src="../_images/334-1.png" />
<p>可能需要进行一些实验，但通常使用大约 0.5 到 0.7 的伽马值会去除相邻多边形之间的鬼影线。默认值为 1.0，表示不会进行任何伽马校正。</p>
</div>
<input class="tab-input" id="tab-set--29-input--2" name="tab-set--29" type="radio"><label class="tab-label" for="tab-set--29-input--2">英文</label><div class="tab-content docutils container">
<p>Gamma correction is an obscure concept, but can be very useful at times. If you
draw two polygons that touch with exactly the same fill color, you will still see
a line between the two:</p>
<img alt="../_images/334-0.png" class="with-border align-center" src="../_images/334-0.png" />
<p>This is because of the way Mapnik anti-aliases the edges of the polygons. If you want
these lines between adjacent polygons to disappear, you can add a gamma correction
factor, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.63</span>
</pre></div>
</div>
<p>This results in the two polygons appearing as one:</p>
<img alt="../_images/334-1.png" class="with-border align-center" src="../_images/334-1.png" />
<p>It may take some experimenting, but using a gamma value of around 0.5 to 0.7 will
generally remove the ghost lines between adjacent polygons. The default value of 1.0
will mean that no gamma correction will be performed at all.</p>
</div>
</div>
</section>
<section id="polygonpatternsymbolizer">
<h4>PolygonPatternSymbolizer<a class="headerlink" href="#polygonpatternsymbolizer" title="此标题的永久链接">#</a></h4>
<p>PolygonPatternSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--30-input--1" name="tab-set--30" type="radio"><label class="tab-label" for="tab-set--30-input--1">中文</label><div class="tab-content docutils container">
<p><strong>PolygonPatternSymbolizer</strong> 使用提供的图像文件填充多边形的内部，如下所示：</p>
<img alt="../_images/335-0.png" class="with-border align-center" src="../_images/335-0.png" />
<p>该图像将被 <strong>平铺</strong> ——即反复绘制以填充多边形的整个内部：</p>
<a class="with-border reference internal image-reference" href="../_images/335-1.png"><img alt="../_images/335-1.png" class="with-border align-center" src="../_images/335-1.png" style="width: 290.0px; height: 290.0px;" /></a>
<p>由于一个图块的右侧将出现在相邻图块的左侧，且图块的底部将出现在下方图块的顶部（反之亦然），因此你需要选择一种适合这种平铺方式显示的图像。</p>
<p>使用 <strong>PolygonPatternSymbolizer</strong> 很简单；就像使用 <strong>LinePatternSymbolizer</strong> 一样，你创建一个新的实例，并将图像文件的引用传递给一个 <cite>mapnik.PathExpression</cite> 对象:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PathExpression</span><span class="p">(</span><span class="s2">&quot;path/to/image.png&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonPatternSymbolizer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--30-input--2" name="tab-set--30" type="radio"><label class="tab-label" for="tab-set--30-input--2">英文</label><div class="tab-content docutils container">
<p>The PolygonPatternSymbolizer fills the interior of a polygon using a supplied image
file, like this:</p>
<img alt="../_images/335-0.png" class="with-border align-center" src="../_images/335-0.png" />
<p>The image will be <strong>tiled</strong>—that is, drawn repeatedly to fill in the entire interior of
the polygon:</p>
<a class="with-border reference internal image-reference" href="../_images/335-1.png"><img alt="../_images/335-1.png" class="with-border align-center" src="../_images/335-1.png" style="width: 290.0px; height: 290.0px;" /></a>
<p>Because the right side of one tile will appear next to the left side of the adjacent tile,
and the bottom of the tile will appear immediately above the top of the tile below it
(and vice versa), you need to choose an appropriate image that will look good when
it is drawn in this way.</p>
<p>Using the PolygonPatternSymbolizer is easy; as with the LinePatternSymbolizer
you create a new instance and give it a reference to the image file in a mapnik.
PathExpression object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PathExpression</span><span class="p">(</span><span class="s2">&quot;path/to/image.png&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PolygonPatternSymbolizer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id10">
<h3>绘制标签<a class="headerlink" href="#id10" title="此标题的永久链接">#</a></h3>
<p>Drawing labels</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--31-input--1" name="tab-set--31" type="radio"><label class="tab-label" for="tab-set--31-input--1">中文</label><div class="tab-content docutils container">
<p>文本标签是任何地图中重要的一部分。在本节中，我们将探讨 <strong>TextSymbolizer</strong>，它用于在地图上绘制文本。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><strong>ShieldSymbolizer</strong> 也允许绘制标签，将文本与图像结合。我们将在绘制点的部分中介绍 <strong>ShieldSymbolizer</strong>。</p>
</div>
</div>
<input class="tab-input" id="tab-set--31-input--2" name="tab-set--31" type="radio"><label class="tab-label" for="tab-set--31-input--2">英文</label><div class="tab-content docutils container">
<p>Textual labels are an important part of any map. In this section, we will explore the
TextSymbolizer, which draws text onto a map.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The ShieldSymbolizer also allows you to draw labels, combining
text with an image. We will look at the ShieldSymbolizer in the
section on drawing points.</p>
</div>
</div>
</div>
<section id="textsymbolizer">
<h4>TextSymbolizer<a class="headerlink" href="#textsymbolizer" title="此标题的永久链接">#</a></h4>
<p>TextSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--32-input--1" name="tab-set--32" type="radio"><label class="tab-label" for="tab-set--32-input--1">中文</label><div class="tab-content docutils container">
<p><strong>TextSymbolizer</strong> 允许你在点、线和多边形要素上绘制文本：</p>
<img alt="../_images/336-0.png" class="with-border align-center" src="../_images/336-0.png" />
<p><strong>TextSymbolizer</strong> 的基本使用非常简单。例如，在前面的插图中，该多边形使用以下代码进行标注:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">TextSymbolizer</span><span class="p">(</span>
                                <span class="n">mapnik</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="s2">&quot;[label]&quot;</span><span class="p">),</span>
                                <span class="s2">&quot;DejaVu Sans Book&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                                <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>这个符号化器将使用给定的字体、字体大小和颜色显示要素的标签字段的值。每次创建一个 <strong>TextSymbolizer</strong> 对象时，你必须提供这四个参数。</p>
<p>让我们更仔细地看看这些参数，以及其他可以控制文本显示方式的选项。</p>
</div>
<input class="tab-input" id="tab-set--32-input--2" name="tab-set--32" type="radio"><label class="tab-label" for="tab-set--32-input--2">英文</label><div class="tab-content docutils container">
<p>The TextSymbolizer allows you to draw text onto point, line and polygon features:</p>
<img alt="../_images/336-0.png" class="with-border align-center" src="../_images/336-0.png" />
<p>The basic usage of a TextSymbolizer is quite simple. For example, the polygon in the
preceding illustration was labeled using the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">TextSymbolizer</span><span class="p">(</span>
                            <span class="n">mapnik</span><span class="o">.</span><span class="n">Expression</span><span class="p">(</span><span class="s2">&quot;[label]&quot;</span><span class="p">),</span>
                            <span class="s2">&quot;DejaVu Sans Book&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                            <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This symbolizer will display the value of the feature’s label field using the given
font, font size and color. Whenever you create a TextSymbolizer object, you must
provide these four parameters.</p>
<p>Let’s take a closer look at these parameters, as well as the other options you have
for controlling how the text will be displayed.</p>
</div>
</div>
</section>
<section id="id11">
<h4>指定要显示的文本<a class="headerlink" href="#id11" title="此标题的永久链接">#</a></h4>
<p>Specifying the text to be displayed</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--33-input--1" name="tab-set--33" type="radio"><label class="tab-label" for="tab-set--33-input--1">中文</label><div class="tab-content docutils container">
<p>你通过将一个 <strong>mapnik.Expression</strong> 对象作为第一个参数传递给 <strong>TextSymbolizer</strong> 构造函数来选择要显示的文本。在创建 <strong>Expression</strong> 时，你指定要显示的字段或属性的名称。请注意，显示的文本始终来自底层数据；没有选项可以硬编码标签的文本。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>对于许多数据源，字段名是区分大小写的，因此最好确保你输入的字段或属性名称完全正确。 <strong>NAME</strong> 与 <strong>name</strong> 不同。</p>
</div>
</div>
<input class="tab-input" id="tab-set--33-input--2" name="tab-set--33" type="radio"><label class="tab-label" for="tab-set--33-input--2">英文</label><div class="tab-content docutils container">
<p>You select the text to be displayed by passing a mapnik.Expression object as the
first parameter to the TextSymbolizer’s constructor. When creating an Expression,
you specify the name of the field or attribute that you want to display. Note that
the text to be displayed will always be taken from the underlying data; there is no
option for hardwiring a label’s text.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>For many data sources the name is case-sensitive, so it is best to ensure that you type in the name of the field or attribute exactly. NAME is not the same as name.</p>
</div>
</div>
</div>
</section>
<section id="id12">
<h4>选择合适的字体<a class="headerlink" href="#id12" title="此标题的永久链接">#</a></h4>
<p>Selecting a suitable font</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--34-input--1" name="tab-set--34" type="radio"><label class="tab-label" for="tab-set--34-input--1">中文</label><div class="tab-content docutils container">
<p>标签将使用你在创建 <strong>TextSymbolizer</strong> 对象时指定的字体和字体大小绘制。你有两种选择来选择字体：可以使用 Mapnik 提供的内置字体，或者安装你自己的自定义字体。</p>
<p>要查看可用的字体，可以运行以下程序:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span>
<span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FontEngine</span><span class="o">.</span><span class="n">face_names</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">font</span>
</pre></div>
</div>
<p>你可以通过以下网页了解有关安装自定义字体的更多信息：</p>
<p><a class="reference external" href="http://trac.mapnik.org/wiki/UsingCustomFonts">http://trac.mapnik.org/wiki/UsingCustomFonts</a></p>
<p>请注意，字体是通过名称指定的，字体大小是以点为单位的。</p>
</div>
<input class="tab-input" id="tab-set--34-input--2" name="tab-set--34" type="radio"><label class="tab-label" for="tab-set--34-input--2">英文</label><div class="tab-content docutils container">
<p>The label will be drawn using a font and font size you specify when you create the
TextSymbolizer object. You have two options for selecting a font: you can use one
of the built-in fonts supplied by Mapnik, or you can install your own custom font.</p>
<p>To find out what fonts are available, run the following program:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mapnik</span>
<span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FontEngine</span><span class="o">.</span><span class="n">face_names</span><span class="p">():</span>
    <span class="nb">print</span> <span class="n">font</span>
</pre></div>
</div>
<p>You can find out more about the process involved in installing a custom font on the
following web page:</p>
<p><a class="reference external" href="http://trac.mapnik.org/wiki/UsingCustomFonts">http://trac.mapnik.org/wiki/UsingCustomFonts</a></p>
<p>Note that the font is specified by name, and that the font size is in points.</p>
</div>
</div>
</section>
<section id="id13">
<h4>绘制半透明文本<a class="headerlink" href="#id13" title="此标题的永久链接">#</a></h4>
<p>Drawing semi-transparent text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--35-input--1" name="tab-set--35" type="radio"><label class="tab-label" for="tab-set--35-input--1">中文</label><div class="tab-content docutils container">
<p>你可以通过设置 <cite>opacity</cite> 属性来控制文本的透明度或不透明度，像这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p>透明度的范围从 0.0（完全透明）到 1.0（完全不透明）。</p>
</div>
<input class="tab-input" id="tab-set--35-input--2" name="tab-set--35" type="radio"><label class="tab-label" for="tab-set--35-input--2">英文</label><div class="tab-content docutils container">
<p>You can control how opaque or transparent the text is by setting the opacity
attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p>The opacity ranges from 0.0 (completely transparent) to 1.0 (completely opaque).</p>
</div>
</div>
</section>
<section id="id14">
<h4>控制文本放置<a class="headerlink" href="#id14" title="此标题的永久链接">#</a></h4>
<p>Controlling text placement</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--36-input--1" name="tab-set--36" type="radio"><label class="tab-label" for="tab-set--36-input--1">中文</label><div class="tab-content docutils container">
<p>有两种方式可以让 <cite>TextSymbolizer</cite> 将文本放置在要标注的要素上。使用 <strong>点放置</strong> （默认方式），Mapnik 会按以下方式在三个要素上绘制标签：</p>
<img alt="../_images/338-0.png" class="with-border align-center" src="../_images/338-0.png" />
<p>如你所见，标签被绘制在每个要素的中心，并且标签是水平绘制的，与线的方向无关。另一种将文本放置到要素上的方式是使用 <strong>线放置</strong> 。如果使用线放置来标注上述要素，则会得到如下结果：</p>
<img alt="../_images/338-1.png" class="with-border align-center" src="../_images/338-1.png" />
<p>请注意，矩形的标签现在沿着多边形的边界绘制，并且标签遵循线的方向。点要素没有被标注，因为点要素内部没有线。</p>
<p>你可以通过设置符号化器的 <cite>label_placement</cite> 属性来控制文本的放置方式，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sym1</span><span class="o">.</span><span class="n">label_placement</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">label_placement</span><span class="o">.</span><span class="n">POINT_PLACEMENT</span>
<span class="n">sym2</span><span class="o">.</span><span class="n">label_placement</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">label_placement</span><span class="o">.</span><span class="n">LINE_PLACEMENT</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--36-input--2" name="tab-set--36" type="radio"><label class="tab-label" for="tab-set--36-input--2">英文</label><div class="tab-content docutils container">
<p>There are two ways in which the TextSymbolizer places text onto the feature being
labeled. Using point placement (the default), Mapnik would draw labels on the
three features shown earlier in the following way:</p>
<img alt="../_images/338-0.png" class="with-border align-center" src="../_images/338-0.png" />
<p>As you can see, the labels are drawn at the center of each feature, and the labels are
drawn horizontally with no regard to the orientation of the line. The other option for
placing text onto the feature is to use <strong>line placement</strong>. Labeling the preceding features
using line placement would result in the following:</p>
<img alt="../_images/338-1.png" class="with-border align-center" src="../_images/338-1.png" />
<p>Note that the polygon’s label is now drawn along the boundary of the polygon, and
the labels now follow the orientation of the line. The point feature isn’t labeled at all,
since the point feature has no lines within it.</p>
<p>You control the placement of the text by setting the symbolizer’s label_placement
attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sym1</span><span class="o">.</span><span class="n">label_placement</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">label_placement</span><span class="o">.</span><span class="n">POINT_PLACEMENT</span>
<span class="n">sym2</span><span class="o">.</span><span class="n">label_placement</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">label_placement</span><span class="o">.</span><span class="n">LINE_PLACEMENT</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id15">
<h4>重复标签<a class="headerlink" href="#id15" title="此标题的永久链接">#</a></h4>
<p>Repeating labels</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--37-input--1" name="tab-set--37" type="radio"><label class="tab-label" for="tab-set--37-input--1">中文</label><div class="tab-content docutils container">
<p>当使用 <strong>LINE_PLACEMENT</strong> 放置标签时，Mapnik 默认只会在线的中间绘制一次标签。然而，在许多情况下，将标签沿线的长度重复显示会更合适。为此，你可以设置符号化器的 <cite>label_spacing</cite> 属性，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">label_spacing</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>设置此属性会导致标签沿着线或多边形边界重复显示。该值表示每个重复标签之间的间距，单位为像素。使用上述的标签间距，我们的线条和多边形要素将如下所示：</p>
<img alt="../_images/339-0.png" class="with-border align-center" src="../_images/339-0.png" />
<p>此外，还有几个其他属性可以用来微调重复标签的显示方式：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">symbolizer.force_odd_labels</span> <span class="pre">=</span> <span class="pre">True</span></code>
这会告诉 <cite>TextSymbolizer</cite> 始终绘制奇数个标签。在某些情况下，这样可以使标签看起来更好。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">symbolizer.maximum_angle_char_delta</span> <span class="pre">=</span> <span class="pre">45</span></code>
设置从一个字符到下一个字符的最大角度变化（单位：度）。使用此设置可以防止 Mapnik 在急转弯处绘制标签。例如：</p></li>
</ul>
<img alt="../_images/340-0.png" class="with-border align-center" src="../_images/340-0.png" />
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">symbolizer.minimum_distance</span> <span class="pre">=</span> <span class="pre">40</span></code>
设置重复标签之间的最小距离，单位为像素。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">symbolizer.label_position_tolerance</span> <span class="pre">=</span> <span class="pre">20</span></code>
设置标签沿线移动的最大距离，以避免与其他标签或急转弯相撞。该值单位为像素，默认为 <cite>minimum_distance</cite> 除以 2。</p></li>
</ul>
</div>
<input class="tab-input" id="tab-set--37-input--2" name="tab-set--37" type="radio"><label class="tab-label" for="tab-set--37-input--2">英文</label><div class="tab-content docutils container">
<p>When labels are placed using LINE_PLACEMENT, Mapnik will by default draw the
label once, in the middle of the line. In many cases, however, it makes sense to have
the label repeated along the length of the line. To do this, you set the symbolizer’s
label_spacing attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">label_spacing</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Setting this attribute causes the labels to be repeated along the line or polygon
boundary. The value is the amount of space between each repeated label, in pixels.
Using the preceding label spacing, our line and polygon features would be displayed
in the following way:</p>
<img alt="../_images/339-0.png" class="with-border align-center" src="../_images/339-0.png" />
<p>There are several other attributes that can be used to fine-tune the way repeated
labels are displayed:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.force_odd_labels</span> <span class="pre">=</span> <span class="pre">True</span></code></dt><dd><p>This tells the TextSymbolizer to always draw an odd number of labels. This can make the labels look better in some situations.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.maximum_angle_char_delta</span> <span class="pre">=</span> <span class="pre">45</span></code></dt><dd><p>This sets the maximum change in angle (measured in degrees) from one character to the next. Using this can prevent Mapnik from drawing labels around sharp corners. For example:</p>
</dd>
</dl>
</li>
</ul>
<img alt="../_images/340-0.png" class="with-border align-center" src="../_images/340-0.png" />
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.minimum_distance</span> <span class="pre">=</span> <span class="pre">40</span></code></dt><dd><p>The minimum distance between repeated labels, in pixels.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.label_position_tolerance</span> <span class="pre">=</span> <span class="pre">20</span></code></dt><dd><p>This sets the maximum distance a label can move along the line to avoid other labels and sharp corners. The value is in pixels, and defaults to minimum_distance divided by 2.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
<section id="id16">
<h4>控制文本重叠<a class="headerlink" href="#id16" title="此标题的永久链接">#</a></h4>
<p>Controlling text overlap</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--38-input--1" name="tab-set--38" type="radio"><label class="tab-label" for="tab-set--38-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，Mapnik 确保两个标签永远不会重叠。如果可能，它会调整标签的位置以避免重叠。如果你仔细查看以下两个多边形边界上的标签，你会发现第二个多边形的标签位置已被调整，以避免重叠：</p>
<a class="with-border reference internal image-reference" href="../_images/340-1.png"><img alt="../_images/340-1.png" class="with-border align-center" src="../_images/340-1.png" style="width: 564.0px; height: 324.0px;" /></a>
<p>如果 Mapnik 判断无法移动标签而不会完全误表示标签位置，它将完全隐藏该标签。在以下插图中，你可以看到两个多边形被移动到重叠的情况：</p>
<img alt="../_images/341-0.png" class="with-border align-center" src="../_images/341-0.png" />
<p><cite>allow_overlap</cite> 属性允许你改变这种行为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">allow_overlap</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>当启用此选项时，Mapnik 将不会隐藏重叠的标签，而是将它们简单地重叠绘制：</p>
<a class="with-border reference internal image-reference" href="../_images/341-1.png"><img alt="../_images/341-1.png" class="with-border align-center" src="../_images/341-1.png" style="width: 300.0px; height: 240.0px;" /></a>
</div>
<input class="tab-input" id="tab-set--38-input--2" name="tab-set--38" type="radio"><label class="tab-label" for="tab-set--38-input--2">英文</label><div class="tab-content docutils container">
<p>By default, Mapnik ensures that two labels will never intersect. If possible, it will
move the labels to avoid an overlap. If you look closely at the labels drawn around
the boundary of the following two polygons, you will see that the position of the
second polygon’s labels has been adjusted to avoid an overlap:</p>
<a class="with-border reference internal image-reference" href="../_images/340-1.png"><img alt="../_images/340-1.png" class="with-border align-center" src="../_images/340-1.png" style="width: 564.0px; height: 324.0px;" /></a>
<p>If Mapnik decides that it can’t move the label without completely misrepresenting
the position of the label, then it will hide the label completely. You can see this in
the following illustration, where the two polygons are moved so they overlap:</p>
<img alt="../_images/341-0.png" class="with-border align-center" src="../_images/341-0.png" />
<p>The allow_overlap attribute allows you to change this behavior:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">allow_overlap</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Instead of hiding the overlapping labels, Mapnik will simply draw them one on top
of the other:</p>
<a class="with-border reference internal image-reference" href="../_images/341-1.png"><img alt="../_images/341-1.png" class="with-border align-center" src="../_images/341-1.png" style="width: 300.0px; height: 240.0px;" /></a>
</div>
</div>
</section>
<section id="id17">
<h4>在深色背景上绘制文本<a class="headerlink" href="#id17" title="此标题的永久链接">#</a></h4>
<p>Drawing text on a dark background</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--39-input--1" name="tab-set--39" type="radio"><label class="tab-label" for="tab-set--39-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，TextSymbolizer 会直接将文本绘制到地图上。当文本放置在浅色区域时，这种方式效果很好，但如果底部区域是深色的，文本可能难以阅读甚至看不见：</p>
<a class="with-border reference internal image-reference" href="../_images/341-2.png"><img alt="../_images/341-2.png" class="with-border align-center" src="../_images/341-2.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>当然，你可以选择浅色的文本颜色，但这要求你提前知道背景可能是什么。一个更好的解决方案是给文本绘制一个“光晕”，就像这样：</p>
<a class="with-border reference internal image-reference" href="../_images/342-0.png"><img alt="../_images/342-0.png" class="with-border align-center" src="../_images/342-0.png" style="width: 240.0px; height: 180.0px;" /></a>
<p><cite>halo_fill</cite> 和 <cite>halo_radius</cite> 属性允许你定义绘制在文本周围的光晕的颜色和大小，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">halo_fill</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span><span class="o">.</span><span class="n">halo_radius</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>半径以像素为单位指定；通常像 1 或 2 这样的小值就足够了，可以确保文本在深色背景下可读。</p>
</div>
<input class="tab-input" id="tab-set--39-input--2" name="tab-set--39" type="radio"><label class="tab-label" for="tab-set--39-input--2">英文</label><div class="tab-content docutils container">
<p>The TextSymbolizer will normally draw the text directly onto the map. This works well
when the text is placed over a lightly-colored area of the map, but if the underlying
area is dark the text can be hard to read or even invisible:</p>
<a class="with-border reference internal image-reference" href="../_images/341-2.png"><img alt="../_images/341-2.png" class="with-border align-center" src="../_images/341-2.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>Of course, you could choose a light text color, but that requires you to know in
advance what the background is likely to be. A better solution is to draw a “halo”
around the text, like this:</p>
<a class="with-border reference internal image-reference" href="../_images/342-0.png"><img alt="../_images/342-0.png" class="with-border align-center" src="../_images/342-0.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>The halo_fill and halo_radius attributes allow you to define the color and size
of the halo to draw around the text, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">halo_fill</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span><span class="o">.</span><span class="n">halo_radius</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The radius is specified in pixels; generally a small value such as 1 or 2 is enough
to ensure that the text is readable against a dark background.</p>
</div>
</div>
</section>
<section id="id18">
<h4>调整文本的位置<a class="headerlink" href="#id18" title="此标题的永久链接">#</a></h4>
<p>Adjusting the position of the text</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--40-input--1" name="tab-set--40" type="radio"><label class="tab-label" for="tab-set--40-input--1">中文</label><div class="tab-content docutils container">
<p>默认情况下，Mapnik 会计算文本应该显示的点，然后将文本居中显示在该点上，如下所示：</p>
<a class="with-border reference internal image-reference" href="../_images/342-1.png"><img alt="../_images/342-1.png" class="with-border align-center" src="../_images/342-1.png" style="width: 37.5px; height: 33.0px;" /></a>
<p>你可以通过两种方式来调整这个位置：通过改变 <strong>垂直对齐方式</strong> 和通过指定 <strong>文本位移</strong>。</p>
<p>垂直对齐方式可以通过改变 TextSymbolizer 的 <cite>vertical_alignment</cite> 属性来控制。你可以使用三种垂直对齐值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sym1</span><span class="o">.</span><span class="n">vertical_alignment</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">vertical_alignment</span><span class="o">.</span><span class="n">TOP</span>
<span class="n">sym2</span><span class="o">.</span><span class="n">vertical_alignment</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">vertical_alignment</span><span class="o">.</span><span class="n">MIDDLE</span>
<span class="n">sym3</span><span class="o">.</span><span class="n">vertical_alignment</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">vertical_alignment</span><span class="o">.</span><span class="n">BOTTOM</span>
</pre></div>
</div>
<p><em>mapnik.vertical_alignment.MIDDLE</em> 是默认值，将标签垂直居中显示在点上，如之前所示。</p>
<p>如果你将垂直对齐方式改为 <cite>mapnik.vertical_alignment.TOP</cite>，标签会被绘制在点的上方，如下所示：</p>
<a class="with-border reference internal image-reference" href="../_images/343-0.png"><img alt="../_images/343-0.png" class="with-border align-center" src="../_images/343-0.png" style="width: 37.5px; height: 33.0px;" /></a>
<p>相反，如果你将垂直对齐方式改为 <cite>mapnik.vertical_alignment.BOTTOM</cite>，标签会被绘制在点的下方：</p>
<a class="with-border reference internal image-reference" href="../_images/343-1.png"><img alt="../_images/343-1.png" class="with-border align-center" src="../_images/343-1.png" style="width: 37.5px; height: 33.0px;" /></a>
<p>调整文本位置的另一个选项是使用 <cite>displacement</cite> 属性，通过给定的像素数来移动文本。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>这会将标签从其正常位置向右移动 5 像素，并向下移动 10 像素：</p>
<a class="with-border reference internal image-reference" href="../_images/343-2.png"><img alt="../_images/343-2.png" class="with-border align-center" src="../_images/343-2.png" style="width: 43.5px; height: 39.0px;" /></a>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><strong>注意</strong></p>
<p>改变标签的垂直位移还会改变标签的默认垂直对齐方式值。这可能会导致标签位置的意外移动，因为设置垂直位移时，标签的垂直对齐方式会作为副作用发生变化。为避免这种情况，你应该在改变垂直位移时明确设置 <cite>vertical_alignment</cite> 属性。</p>
</div>
</div>
<input class="tab-input" id="tab-set--40-input--2" name="tab-set--40" type="radio"><label class="tab-label" for="tab-set--40-input--2">英文</label><div class="tab-content docutils container">
<p>By default, Mapnik calculates the point at which the text should be displayed,
and then displays the text centered over that point, like this:</p>
<a class="with-border reference internal image-reference" href="../_images/342-1.png"><img alt="../_images/342-1.png" class="with-border align-center" src="../_images/342-1.png" style="width: 37.5px; height: 33.0px;" /></a>
<p>You can adjust this positioning in two ways: by changing the <strong>vertical alignment</strong>, and by specifying a <strong>text displacement</strong>.</p>
<p>The vertical alignment can be controlled by changing the TextSymbolizer’s
vertical_alignment attribute. There are three vertical alignment values
you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sym1</span><span class="o">.</span><span class="n">vertical_alignment</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">vertical_alignment</span><span class="o">.</span><span class="n">TOP</span>
<span class="n">sym2</span><span class="o">.</span><span class="n">vertical_alignment</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">vertical_alignment</span><span class="o">.</span><span class="n">MIDDLE</span>
<span class="n">sym3</span><span class="o">.</span><span class="n">vertical_alignment</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">vertical_alignment</span><span class="o">.</span><span class="n">BOTTOM</span>
</pre></div>
</div>
<p><em>mapnik.vertical_alignment.MIDDLE</em> is the default, and places the label centered
vertically over the point as shown earlier.</p>
<p>If you change the vertical alignment to mapnik.vertical_alignment.TOP, the label
will be drawn above the point, like this:</p>
<a class="with-border reference internal image-reference" href="../_images/343-0.png"><img alt="../_images/343-0.png" class="with-border align-center" src="../_images/343-0.png" style="width: 37.5px; height: 33.0px;" /></a>
<p>Conversely, if you change the vertical alignment to mapnik.vertical_alignment.
BOTTOM, the label will be drawn below the point:</p>
<a class="with-border reference internal image-reference" href="../_images/343-1.png"><img alt="../_images/343-1.png" class="with-border align-center" src="../_images/343-1.png" style="width: 37.5px; height: 33.0px;" /></a>
<p>Your other option for adjusting text positioning is to use the displacement attribute
to displace the text by a given number of pixels. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>This will shift the label five pixels to the right and ten pixels down from its normal
position:</p>
<a class="with-border reference internal image-reference" href="../_images/343-2.png"><img alt="../_images/343-2.png" class="with-border align-center" src="../_images/343-2.png" style="width: 43.5px; height: 39.0px;" /></a>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><strong>Beware</strong></p>
<p>Changing the vertical displacement of a label will also change the label’s
default vertical_alignment value. This can result in your label being
moved in unexpected ways, because the vertical alignment of the label is
changed as a side-effect of setting the vertical displacement. To avoid this,
you should always set the vertical_alignment attribute explicitly
whenever you change the vertical displacement.</p>
</div>
</div>
</div>
</section>
<section id="id19">
<h4>跨多行拆分标签<a class="headerlink" href="#id19" title="此标题的永久链接">#</a></h4>
<p>Splitting labels across multiple lines</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--41-input--1" name="tab-set--41" type="radio"><label class="tab-label" for="tab-set--41-input--1">中文</label><div class="tab-content docutils container">
<p>有时候，标签的长度可能太长，无法以你希望的方式显示：</p>
<a class="with-border reference internal image-reference" href="../_images/343-3.png"><img alt="../_images/343-3.png" class="with-border align-center" src="../_images/343-3.png" style="width: 276.0px; height: 180.0px;" /></a>
<p>在这种情况下，你可以使用 <cite>wrap_width</cite> 属性来强制标签换行显示。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">wrap_width</span> <span class="o">=</span> <span class="mi">70</span>
</pre></div>
</div>
<p>这将导致前面的标签像这样显示：</p>
<a class="with-border reference internal image-reference" href="../_images/344-0.png"><img alt="../_images/344-0.png" class="with-border align-center" src="../_images/344-0.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>你指定的值是每行文本的最大宽度，单位为像素。</p>
</div>
<input class="tab-input" id="tab-set--41-input--2" name="tab-set--41" type="radio"><label class="tab-label" for="tab-set--41-input--2">英文</label><div class="tab-content docutils container">
<p>Sometimes a label is too long to be displayed in the way that you might like:</p>
<a class="with-border reference internal image-reference" href="../_images/343-3.png"><img alt="../_images/343-3.png" class="with-border align-center" src="../_images/343-3.png" style="width: 276.0px; height: 180.0px;" /></a>
<p>In this case, you can use the wrap_width attribute to force the label to wrap across multiple lines. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">wrap_width</span> <span class="o">=</span> <span class="mi">70</span>
</pre></div>
</div>
<p>This will cause the preceding label to be displayed like this:</p>
<a class="with-border reference internal image-reference" href="../_images/344-0.png"><img alt="../_images/344-0.png" class="with-border align-center" src="../_images/344-0.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>The value you specify is the maximum width of each line of text, in pixels.</p>
</div>
</div>
</section>
<section id="id20">
<h4>控制字符和行距<a class="headerlink" href="#id20" title="此标题的永久链接">#</a></h4>
<p>Controlling character and line spacing</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--42-input--1" name="tab-set--42" type="radio"><label class="tab-label" for="tab-set--42-input--1">中文</label><div class="tab-content docutils container">
<p>你可以通过设置 <cite>character_spacing</cite> 属性来在标签的每个字符之间添加额外的空间，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">character_spacing</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>这将使我们的多边形标签显示如下：</p>
<a class="with-border reference internal image-reference" href="../_images/344-1.png"><img alt="../_images/344-1.png" class="with-border align-center" src="../_images/344-1.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>你还可以使用 <cite>line_spacing</cite> 属性来改变各行之间的间距：</p>
<blockquote>
<div><p>symbolizer.line_spacing = 8</p>
</div></blockquote>
<p>这样，我们的多边形标签将显示如下：</p>
<a class="with-border reference internal image-reference" href="../_images/344-2.png"><img alt="../_images/344-2.png" class="with-border align-center" src="../_images/344-2.png" style="width: 240.0px; height: 180.0px;" /></a>
<p><cite>character_spacing</cite> 和 <cite>line_spacing</cite> 的值都以像素为单位。</p>
</div>
<input class="tab-input" id="tab-set--42-input--2" name="tab-set--42" type="radio"><label class="tab-label" for="tab-set--42-input--2">英文</label><div class="tab-content docutils container">
<p>You can add extra space between each character in a label by setting the
character_spacing attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">character_spacing</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>This results in our polygon being labeled like this:</p>
<a class="with-border reference internal image-reference" href="../_images/344-1.png"><img alt="../_images/344-1.png" class="with-border align-center" src="../_images/344-1.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>You can also change the spacing between the various lines using the line_spacing attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span><span class="o">.</span><span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">8</span>
</pre></div>
</div>
<p>Our polygon will then look like this:</p>
<a class="with-border reference internal image-reference" href="../_images/344-2.png"><img alt="../_images/344-2.png" class="with-border align-center" src="../_images/344-2.png" style="width: 240.0px; height: 180.0px;" /></a>
<p>Both the character spacing and the line spacing values are in pixels.</p>
</div>
</div>
</section>
<section id="id21">
<h4>控制大写<a class="headerlink" href="#id21" title="此标题的永久链接">#</a></h4>
<p>Controlling capitalization</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--43-input--1" name="tab-set--43" type="radio"><label class="tab-label" for="tab-set--43-input--1">中文</label><div class="tab-content docutils container">
<p>有时你可能想要改变显示文本的大小写。你可以通过设置 <cite>text_transform</cite> 属性来实现，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer1</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">text_transform</span><span class="o">.</span><span class="n">uppercase</span>
<span class="n">symbolizer2</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">text_transform</span><span class="o">.</span><span class="n">lowercase</span>
</pre></div>
</div>
<p>这两个设置将导致标签显示如下：</p>
<a class="with-border reference internal image-reference" href="../_images/345-0.png"><img alt="../_images/345-0.png" class="with-border align-center" src="../_images/345-0.png" style="width: 718.1999999999999px; height: 201.6px;" /></a>
</div>
<input class="tab-input" id="tab-set--43-input--2" name="tab-set--43" type="radio"><label class="tab-label" for="tab-set--43-input--2">英文</label><div class="tab-content docutils container">
<p>There are times when you might want to change the case of the text being displayed.
You can do this by setting the text_transform attribute, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer1</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">text_transform</span><span class="o">.</span><span class="n">uppercase</span>
<span class="n">symbolizer2</span><span class="o">.</span><span class="n">text_transform</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">text_transform</span><span class="o">.</span><span class="n">lowercase</span>
</pre></div>
</div>
<p>These two settings will result in the labels being displayed as follows:</p>
<a class="with-border reference internal image-reference" href="../_images/345-0.png"><img alt="../_images/345-0.png" class="with-border align-center" src="../_images/345-0.png" style="width: 718.1999999999999px; height: 201.6px;" /></a>
</div>
</div>
</section>
<section id="id22">
<h4>高级文本放置和格式<a class="headerlink" href="#id22" title="此标题的永久链接">#</a></h4>
<p>Advanced text placement and formatting</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--44-input--1" name="tab-set--44" type="radio"><label class="tab-label" for="tab-set--44-input--1">中文</label><div class="tab-content docutils container">
<p>如果之前的标签选项不足以满足你的需求，你可以利用 Mapnik 2.1 中的一些新特性，这些特性几乎能让你对标签的放置和格式化方式进行无限制的控制。 <cite>symbolizer.placements.defaults.format_tree</cite> 属性允许你定义自己的格式化选项。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">format1</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FormattingText</span><span class="p">(</span><span class="s2">&quot;[name]&quot;</span><span class="p">)</span>
<span class="n">format1</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">face_name</span> <span class="o">=</span> <span class="s2">&quot;DejaVu Sans Book&quot;</span>
<span class="n">format1</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">format2</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FormattingText</span><span class="p">(</span><span class="s2">&quot;[abbreviation]&quot;</span><span class="p">)</span>
<span class="n">format2</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">face_name</span> <span class="o">=</span> <span class="s2">&quot;DejaVu Sans Book&quot;</span>
<span class="n">format2</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">formats</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FormattingList</span><span class="p">([</span><span class="n">format1</span><span class="p">,</span> <span class="n">format2</span><span class="p">])</span>
<span class="n">textSymbolizer</span><span class="o">.</span><span class="n">placements</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">format_tree</span> <span class="o">=</span> <span class="n">formats</span>
</pre></div>
</div>
<p>这段代码设置了两个独立的格式化器，第一个显示 <cite>name</cite> 属性为 10 号字体，而第二个显示 <cite>abbreviation</cite> 属性为 9 号字体。当文本符号化器设置为使用 <cite>FormattingList</cite> 对象时，它将依次尝试每个格式，直到找到适合可用空间的格式。</p>
<p>这样，如果有足够的空间， <cite>name</cite> 属性会被显示；如果空间不足，则会切换为显示 <cite>abbreviation</cite> 属性（字体更小）。最终的效果如下：</p>
<a class="with-border reference internal image-reference" href="../_images/346-0.png"><img alt="../_images/346-0.png" class="with-border align-center" src="../_images/346-0.png" style="width: 334.8px; height: 388.2px;" /></a>
<p>格式化列表只是格式树可用的方式之一。你甚至可以创建自己的 <cite>mapnik.FormattingNode</cite> 子类，并在每个特征渲染时手动计算标签（及其相关的格式）。</p>
<p>要了解如何在 Python 中使用这些高级格式化选项，请查看 Mapnik 源代码中的 <em>tests/visual_tests/test_python.py</em> 文件。</p>
</div>
<input class="tab-input" id="tab-set--44-input--2" name="tab-set--44" type="radio"><label class="tab-label" for="tab-set--44-input--2">英文</label><div class="tab-content docutils container">
<p>If the preceding labeling options aren’t enough, you can make use of some amazing
new features in Mapnik 2.1 that give you almost infinite control over how your labels
are placed and formatted. The symbolizer.placements.defaults.format_tree
attribute lets you define your own formatting options. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">format1</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FormattingText</span><span class="p">(</span><span class="s2">&quot;[name]&quot;</span><span class="p">)</span>
<span class="n">format1</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">face_name</span> <span class="o">=</span> <span class="s2">&quot;DejaVu Sans Book&quot;</span>
<span class="n">format1</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">format2</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FormattingText</span><span class="p">(</span><span class="s2">&quot;[abbreviation]&quot;</span><span class="p">)</span>
<span class="n">format2</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">face_name</span> <span class="o">=</span> <span class="s2">&quot;DejaVu Sans Book&quot;</span>
<span class="n">format2</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">9</span>

<span class="n">formats</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">FormattingList</span><span class="p">([</span><span class="n">format1</span><span class="p">,</span> <span class="n">format2</span><span class="p">])</span>
<span class="n">textSymbolizer</span><span class="o">.</span><span class="n">placements</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">format_tree</span> <span class="o">=</span> <span class="n">formats</span>
</pre></div>
</div>
<p>This code sets up two separate formatters, one displaying the name attribute in 10
point text, while the second displays the abbreviation attribute in 9 point text.
When the text symbolizer is set up to use a FormattingList object, each of the
formats will be tried in turn until a format is found that fits in the available space.</p>
<p>This has the effect of displaying the name attribute if there is room, but switching
to the abbreviation attribute (in a smaller text size) if the name won’t fit. The end
result would look something like this:</p>
<a class="with-border reference internal image-reference" href="../_images/346-0.png"><img alt="../_images/346-0.png" class="with-border align-center" src="../_images/346-0.png" style="width: 334.8px; height: 388.2px;" /></a>
<p>Formatting lists are only one possible way in which the format tree can be used. You
can even create your own custom subclass of mapnik.FormattingNode and manually
calculate the label (and its associated formatting) as each feature is rendered.</p>
<p>To see how these advanced formatting options can be used from within Python, check
out the <em>tests/visual_tests/test_python.py</em> file in the Mapnik source code.</p>
</div>
</div>
</section>
</section>
<section id="id23">
<h3>绘制点<a class="headerlink" href="#id23" title="此标题的永久链接">#</a></h3>
<p>Drawing points</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--45-input--1" name="tab-set--45" type="radio"><label class="tab-label" for="tab-set--45-input--1">中文</label><div class="tab-content docutils container">
<p>在 Mapnik 中，有两种绘制点的方法： <strong>PointSymbolizer</strong> 允许你在给定的点位置绘制一个图像，而 <strong>ShieldSymbolizer</strong> 则将图像与文本标签结合，生成一个“盾牌”样式。</p>
<p>让我们来看一下这两种符号化器是如何工作的。</p>
</div>
<input class="tab-input" id="tab-set--45-input--2" name="tab-set--45" type="radio"><label class="tab-label" for="tab-set--45-input--2">英文</label><div class="tab-content docutils container">
<p>There are two ways of drawing a point using Mapnik: the PointSymbolizer allows
you to draw an image at a given point, and the ShieldSymbolizer combines an image
with a textual label to produce a “shield”.</p>
<p>Let’s examine how each of these two symbolizers work.</p>
</div>
</div>
<section id="pointsymbolizer">
<h4>PointSymbolizer<a class="headerlink" href="#pointsymbolizer" title="此标题的永久链接">#</a></h4>
<p>PointSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--46-input--1" name="tab-set--46" type="radio"><label class="tab-label" for="tab-set--46-input--1">中文</label><div class="tab-content docutils container">
<p><strong>PointSymbolizer</strong> 在地图上绘制一个点图像。默认构造函数不需要参数，会将每个点显示为一个 4x4 像素的黑色方块:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">PointSymbolizer</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/347-0.png" class="with-border align-center" src="../_images/347-0.png" />
<p>或者，你可以提供一个图像文件的路径， <strong>PointSymbolizer</strong> 将使用该图像绘制每个点:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PathExpression</span><span class="p">(</span><span class="s2">&quot;path/to/image.png&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">PointSymbolizer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/347-1.png" class="with-border align-center" src="../_images/347-1.png" />
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>请注意，<strong>PointSymbolizer</strong> 会将图像绘制在指定点的中心位置。你可能需要在图像周围添加透明空间，以确保图像的期望部分位于所需的点上。例如，如果你想在某个确切位置绘制一个大头针，你可能需要将图像格式化如下：</p>
<a class="with-border reference internal image-reference" href="../_images/347-2.png"><img alt="../_images/347-2.png" class="with-border align-center" src="../_images/347-2.png" style="width: 126.6px; height: 112.8px;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>额外的（透明的）空白区域确保了大头针的尖端位于图像的中心，从而可以确保图像准确地绘制在地图上所需的位置。</p>
</div>
<p>无论你是否提供图像，<strong>PointSymbolizer</strong> 都有一些属性，你可以用来修改其行为：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.allow_overlap</span> <span class="pre">=</span> <span class="pre">True</span></code></dt><dd><p>如果将该属性设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，即使图像重叠，所有点也会被绘制。默认值（<code class="docutils literal notranslate"><span class="pre">False</span></code>）表示只有在点不重叠时才会绘制它们。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.opacity</span> <span class="pre">=</span> <span class="pre">0.75</span></code></dt><dd><p>此属性控制绘制图像时的不透明度或透明度。值为 0.0 时，图像会完全透明；值为 1.0（默认值）时，图像会完全不透明。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.transform</span> <span class="pre">=</span> <span class="pre">&quot;...&quot;</span></code></dt><dd><p>一个 SVG 转换表达式，你可以使用它来操作要显示的图像。例如，<code class="docutils literal notranslate"><span class="pre">transform=&quot;rotate(45)</span> <span class="pre">scale(0.5,</span> <span class="pre">0.5)&quot;</span></code> 会将图像顺时针旋转 45 度，然后将其缩放为原始大小的 50%。</p>
</dd>
</dl>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--46-input--2" name="tab-set--46" type="radio"><label class="tab-label" for="tab-set--46-input--2">英文</label><div class="tab-content docutils container">
<p>A PointSymbolizer draws an image at the point. The default constructor takes no
arguments and displays each point as a 4 x 4 pixel black square:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">PointSymbolizer</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/347-0.png" class="with-border align-center" src="../_images/347-0.png" />
<p>Alternatively, you can supply a path to an image file which the PointSymbolizer will
use to draw each point:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">PathExpression</span><span class="p">(</span><span class="s2">&quot;path/to/image.png&quot;</span><span class="p">)</span>
<span class="n">symbolizer</span> <span class="o">=</span> <span class="n">PointSymbolizer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/347-1.png" class="with-border align-center" src="../_images/347-1.png" />
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Be aware that the PointSymbolizer draws the image centered over the desired point. You may have to add transparent space around the image so that the desired part of the image appears over the desired point. For example, if you wish to draw a pin at an exact position, you might need to format the image like this:</p>
<a class="with-border reference internal image-reference" href="../_images/347-2.png"><img alt="../_images/347-2.png" class="with-border align-center" src="../_images/347-2.png" style="width: 126.6px; height: 112.8px;" /></a>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The extra (transparent) whitespace ensures that the point of the pin is in the center of the image, allowing the image to be drawn exactly at the desired position on the map.</p>
</div>
<p>Whether you supply an image or not, the PointSymbolizer has some attributes, which you can use to modify its behavior:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.allow_overlap</span> <span class="pre">=</span> <span class="pre">True</span></code></dt><dd><p>If you set this attribute to <code class="docutils literal notranslate"><span class="pre">True</span></code>, all points will be drawn even if the images overlap. The default (<code class="docutils literal notranslate"><span class="pre">False</span></code>) means that points will only be drawn if they don’t overlap.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.opacity</span> <span class="pre">=</span> <span class="pre">0.75</span></code></dt><dd><p>This attribute controls the amount of opaqueness or transparency used to draw the image. A value of 0.0 will draw the image completely transparent, while a value of 1.0 (the default) will draw the image completely opaque.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.transform</span> <span class="pre">=</span> <span class="pre">&quot;...&quot;</span></code></dt><dd><p>An SVG transformation expression which you can use to manipulate the image to be displayed. For example, <code class="docutils literal notranslate"><span class="pre">transform=&quot;rotate(45)</span> <span class="pre">scale(0.5,</span> <span class="pre">0.5)&quot;</span></code> will rotate the image clockwise by 45 degrees and then scale it to 50 percent of its original size.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
<section id="shieldsymbolizer">
<h4>ShieldSymbolizer<a class="headerlink" href="#shieldsymbolizer" title="此标题的永久链接">#</a></h4>
<p>ShieldSymbolizer</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--47-input--1" name="tab-set--47" type="radio"><label class="tab-label" for="tab-set--47-input--1">中文</label><div class="tab-content docutils container">
<p><strong>ShieldSymbolizer</strong> 绘制一个文本标签和一个关联的图像：</p>
<a class="with-border reference internal image-reference" href="../_images/348-0.png"><img alt="../_images/348-0.png" class="with-border align-center" src="../_images/348-0.png" style="width: 102.0px; height: 96.0px;" /></a>
<p><strong>ShieldSymbolizer</strong> 的工作方式与同时使用 <strong>TextSymbolizer</strong> 和 <strong>PointSymbolizer</strong> 渲染相同数据完全相同。唯一的区别是 <strong>ShieldSymbolizer</strong> 确保文本和图像始终一起显示；你永远不会只看到文本或只看到图像，它们总是一起显示的。</p>
<p>当你创建一个 <strong>ShieldSymbolizer</strong> 时，需要提供以下几个参数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">ShieldSymbolizer</span><span class="p">(</span><span class="n">fieldExpression</span><span class="p">,</span>
                                    <span class="n">font</span><span class="p">,</span> <span class="n">fontSize</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span>
                                    <span class="n">imagePath</span><span class="p">)</span>
</pre></div>
</div>
<p>以下是上述代码中各个部分的解释：</p>
<ul class="simple">
<li><p><strong>fieldExpression</strong> 是一个 Mapnik <strong>Expression</strong> 对象，指定要显示为文本标签的字段或属性</p></li>
<li><p><strong>font</strong> 是绘制文本时使用的字体名称</p></li>
<li><p><strong>fontSize</strong> 是文本的大小，以点为单位</p></li>
<li><p><strong>color</strong> 是一个 Mapnik <strong>Color</strong> 对象，定义用于绘制文本的颜色</p></li>
<li><p><strong>imagePath</strong> 是一个 Mapnik <strong>PathExpression</strong> 对象，包含要使用的图像文件的路径</p></li>
</ul>
<p>因为 <strong>ShieldSymbolizer</strong> 是 <strong>TextSymbolizer</strong> 的子类，所以所有 <strong>TextSymbolizer</strong> 可用的定位和格式化选项也可以应用到 <strong>ShieldSymbolizer</strong> 上。此外，因为它还绘制一个图像，<strong>ShieldSymbolizer</strong> 也继承了 <strong>PointSymbolizer</strong> 的 <cite>allow_overlap</cite> 和 <cite>opacity</cite> 属性。</p>
<p>要设置 <strong>ShieldSymbolizer</strong> 中文本的透明度，请使用 <cite>text_opacity</cite> 属性。</p>
<p>需要注意的是，你很可能需要设置 <strong>ShieldSymbolizer</strong> 的 <cite>displacement</cite> 属性，以便正确地定位文本，因为默认情况下，文本会直接绘制在图像的中心位置。</p>
</div>
<input class="tab-input" id="tab-set--47-input--2" name="tab-set--47" type="radio"><label class="tab-label" for="tab-set--47-input--2">英文</label><div class="tab-content docutils container">
<p>A ShieldSymbolizer draws a textual label and an associated image:</p>
<a class="with-border reference internal image-reference" href="../_images/348-0.png"><img alt="../_images/348-0.png" class="with-border align-center" src="../_images/348-0.png" style="width: 102.0px; height: 96.0px;" /></a>
<p>The ShieldSymbolizer works in exactly the same way as having a TextSymbolizer and a PointSymbolizer rendering the same data. The only difference is that the ShieldSymbolizer ensures that the text and image are always displayed together; you’ll never get the text without the image, or vice versa.</p>
<p>When you create a ShieldSymbolizer, you have to provide a number of parameters:</p>
<dl class="simple">
<dt>symbolizer = mapnik.ShieldSymbolizer(fieldExpression,</dt><dd><p>font, fontSize, color,
imagePath)</p>
</dd>
</dl>
<p>Following are the components of the preceding code:</p>
<ul class="simple">
<li><p>fieldExpression is a Mapnik Expression object specifying the field or attribute to display as the textual label</p></li>
<li><p>font is the name of the font to use when drawing the text</p></li>
<li><p>fontSize of the size of the text, in points</p></li>
<li><p>color is a Mapnik Color object that defines the color to use for drawing the text</p></li>
<li><p>imagePath is a Mapnik PathExpression object that holds the path to the  desired image file</p></li>
</ul>
<p>Because ShieldSymbolizer is a subclass of TextSymbolizer, all the positioning
and formatting options available for a TextSymbolizer can also be applied to a
ShieldSymbolizer. And because it also draws an image, a ShieldSymbolizer also
has the allow_overlap and opacity attributes of a PointSymbolizer.</p>
<p>To set the opacity of the ShieldSymbolizer’s text, use the text_opacity attribute.</p>
<p>Be aware that you will most probably need to set the ShieldSymbolizer’s
displacement attribute to position the text correctly, as by default the text
appears directly over the point, at the center of the image.</p>
</div>
</div>
</section>
</section>
<section id="id24">
<h3>绘制光栅图像<a class="headerlink" href="#id24" title="此标题的永久链接">#</a></h3>
<p>Drawing raster images</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--48-input--1" name="tab-set--48" type="radio"><label class="tab-label" for="tab-set--48-input--1">中文</label><div class="tab-content docutils container">
<p>GDAL 和 Raster 数据源允许你在地图中包含栅格图像。<strong>RasterSymbolizer</strong> 将这些栅格数据显示在地图图层中，如下所示：</p>
<img alt="../_images/350-0.png" class="with-border align-center" src="../_images/350-0.png" />
<p>创建一个 <strong>RasterSymbolizer</strong> 非常简单:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">RasterSymbolizer</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>RasterSymbolizer</strong> 将图层的栅格格式数据源内容绘制到地图上。<strong>RasterSymbolizer</strong> 支持以下选项来控制栅格数据的显示方式：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.opacity</span> <span class="pre">=</span> <span class="pre">0.5</span></code></dt><dd><p>这个属性控制栅格图像的透明度。值为 0.0 时图像完全透明，值为 1.0 时图像完全不透明。默认情况下，栅格图像将完全不透明。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.comp_op</span> <span class="pre">=</span> <span class="pre">mapnik.CompositeOp.hard_light</span></code></dt><dd><p>该属性告诉 <strong>RasterSymbolizer</strong> 如何将栅格数据与之前渲染的地图数据进行合并。这些“合成”操作类似于图像编辑程序（如 Photoshop 或 GIMP）中图层合并的方式。支持的合成操作包括：</p>
</dd>
</dl>
</li>
</ul>
<img alt="../_images/351-0.png" class="with-border align-center" src="../_images/351-0.png" />
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.scaling</span> <span class="pre">=</span> <span class="pre">mapnik.scaling_method.bilinear</span></code></dt><dd><p>该属性允许你控制用于缩放栅格图像数据的算法。可用的选项包括：near（使用最近邻算法）、bilinear（对所有四个颜色通道使用双线性插值）和 bilinear8（仅对单个颜色通道使用双线性插值）。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.colorizer</span> <span class="pre">=</span> <span class="pre">myRasterColorizer</span></code></dt><dd><p>该属性允许你为原始栅格数据应用自定义调色板，例如改变 DEM 文件的颜色。有关如何在 Python 中设置栅格颜色化器的信息，请参阅 Mapnik 网站上 <strong>RasterColorizer</strong> 类的文档。</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>请注意，Mapnik 不支持对栅格数据进行动态投影变换。如果你需要生成一个使用与栅格数据不同的投影的地图，你需要在显示之前将栅格数据重新投影，例如使用 <cite>gdalwarp</cite> 工具。</p>
</div>
<p><strong>RasterSymbolizer</strong> 的一个主要用途是显示如前所示的 <em>阴影地形</em> 背景。这为观众提供了对底层地形的良好印象。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>上述图像是使用来自国家高程数据集（National Elevation Dataset）中的数字高程图（DEM）数据文件创建的。此文件通过使用 <cite>gdaldem</cite> 工具的 hillshade 选项处理，生成了一个阴影地形的灰度图像。然后，使用 <strong>RasterSymbolizer</strong> 将该图像设置为 <cite>hard_light</cite> 模式，并将其覆盖在一个淡绿色背景上，同时使用 GSHHS 海岸线数据库定义海岸线。如果你想将阴影地形图像作为地图背景显示，这一过程可能会很有用。</p>
</div>
</div>
<input class="tab-input" id="tab-set--48-input--2" name="tab-set--48" type="radio"><label class="tab-label" for="tab-set--48-input--2">英文</label><div class="tab-content docutils container">
<p>The GDAL and Raster data sources allow you to include raster images within
a map. The RasterSymbolizer takes this raster data and displays it within a
map layer, like this:</p>
<img alt="../_images/350-0.png" class="with-border align-center" src="../_images/350-0.png" />
<p>Creating a RasterSymbolizer is very simple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">symbolizer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">RasterSymbolizer</span><span class="p">()</span>
</pre></div>
</div>
<p>A RasterSymbolizer draws the contents of the layer’s raster-format data source onto
the map. The RasterSymbolizer supports the following options for controlling how
the raster data is displayed:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.opacity</span> <span class="pre">=</span> <span class="pre">0.5</span></code></dt><dd><p>This controls how opaque the raster image will be. A value of 0.0 makes the image fully transparent, and a value of 1.0 makes it fully opaque. By default, the raster image will be completely opaque.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.comp_op</span> <span class="pre">=</span> <span class="pre">mapnik.CompositeOp.hard_light</span></code></dt><dd><p>This attribute tells the RasterSymbolizer how to merge the raster data with the previously-rendered map data beneath it. These “compositing” operations are similar to the way layers are merged in image editing programs such as Photoshop or the GIMP. The following compositing operations are supported:</p>
</dd>
</dl>
</li>
</ul>
<img alt="../_images/351-0.png" class="with-border align-center" src="../_images/351-0.png" />
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.scaling</span> <span class="pre">=</span> <span class="pre">mapnik.scaling_method.bilinear</span></code></dt><dd><p>This allows you to control the algorithm used to scale the raster image data. The available options are: near (uses the nearest-neighbor algorithm), bilinear (uses bilinear interpolation across all four color channels), and bilinear8 (uses bilinear interpolation for just a single color channel).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">symbolizer.colorizer</span> <span class="pre">=</span> <span class="pre">myRasterColorizer</span></code></dt><dd><p>This lets you apply a custom palette to the raw raster data, for example to change the coloring of a DEM file. For information on how to set up a raster colorizer in Python, see the documentation for the RasterColorizer class on the Mapnik website.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>Note that Mapnik does not support on-the-fly reprojection of raster data. If you need to generate a map using a projection that is different from the raster data’s projection, you will need to reproject the raster data before it can be displayed, for example by using gdalwarp.</p>
</div>
<p>One of the main uses for a RasterSymbolizer is to display a <em>shaded relief</em> background such as the one shown earlier. This gives the viewer a good impression of the underlying terrain.</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>The preceding image was created using a Digital Elevation Map (DEM-format) data file taken from the National Elevation Dataset. This file was processed using the gdaldem utility with the hillshade option to create a shaded relief grayscale image. This image was then displayed using a RasterSymbolizer set to hard_light mode, laid on top of a pale green background with the coastline defined from the GSHHS shoreline database. You may find this process useful if you want to display a shaded relief image as a background for your map.</p>
</div>
</div>
</div>
</section>
<section id="id25">
<h3>使用颜色<a class="headerlink" href="#id25" title="此标题的永久链接">#</a></h3>
<p>Using colors</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--49-input--1" name="tab-set--49" type="radio"><label class="tab-label" for="tab-set--49-input--1">中文</label><div class="tab-content docutils container">
<p>许多 Mapnik 的符号化器要求你提供一个颜色值。这些颜色值是使用 <cite>mapnik.Color</cite> 类定义的。<cite>mapnik.Color</cite> 的实例可以通过以下四种方式创建：</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(r,</span> <span class="pre">g,</span> <span class="pre">b,</span> <span class="pre">a)</span></code></dt><dd><p>通过提供单独的红色、绿色、蓝色和 alpha（透明度）值来创建一个 <strong>Color</strong> 对象。每个值应该在 0 到 255 之间。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(r,</span> <span class="pre">g,</span> <span class="pre">b)</span></code></dt><dd><p>通过提供红色、绿色和蓝色分量来创建一个 <strong>Color</strong> 对象。每个值应该在 0 到 255 之间。生成的对象将是完全不透明的。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(colorName)</span></code></dt><dd><p>通过指定一个标准的 CSS 颜色名称来创建一个 <strong>Color</strong> 对象。可用颜色名称的完整列表可以在以下网址找到：<a class="reference external" href="http://www.w3.org/TR/css3-color/#svg-color">http://www.w3.org/TR/css3-color/#svg-color</a>。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(colorCode)</span></code></dt><dd><p>通过使用 HTML 颜色代码创建一个 <strong>Color</strong> 对象，例如 “#806040” 是中等棕色。</p>
</dd>
</dl>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--49-input--2" name="tab-set--49" type="radio"><label class="tab-label" for="tab-set--49-input--2">英文</label><div class="tab-content docutils container">
<p>Many of the Mapnik symbolizers require you to supply a color value. These color
values are defined using the mapnik.Color class. Instances of mapnik.Color can
be created in one of four ways:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(r,</span> <span class="pre">g,</span> <span class="pre">b,</span> <span class="pre">a)</span></code></dt><dd><p>Creates a Color object by supplying separate red, green, blue, and alpha (opacity) values. Each of these values should be in the range 0 to 255.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(r,</span> <span class="pre">g,</span> <span class="pre">b)</span></code></dt><dd><p>Creates a Color object by supplying red, green, and blue components. Each value should be in the range 0 to 255. The resulting object will be completely opaque.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(colorName)</span></code></dt><dd><p>Creates a Color object by specifying a standard CSS color name. A complete list of the available color names can be found at: <a class="reference external" href="http://www.w3.org/TR/css3-color/#svg-color">http://www.w3.org/TR/css3-color/#svg-color</a>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mapnik.Color(colorCode)</span></code></dt><dd><p>Creates a Color object using an HTML color code, for example “#806040” is medium brown.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
</section>
<section id="id26">
<h2>地图和图层<a class="headerlink" href="#id26" title="此标题的永久链接">#</a></h2>
<p>Maps and layers</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--50-input--1" name="tab-set--50" type="radio"><label class="tab-label" for="tab-set--50-input--1">中文</label><div class="tab-content docutils container">
<p>一旦设置了数据源、符号化器、规则和样式，你就可以将它们组合成 Mapnik 层，并将这些层放置到地图上。为此，你首先需要创建一个 <cite>mapnik.Map</cite> 对象，来表示整张地图:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">srs</span><span class="p">)</span>
</pre></div>
</div>
<p>你需要提供想要生成的地图图像的宽度和高度（单位：像素），以及一个可选的 Proj.4 格式初始化字符串 <cite>srs</cite>。如果没有指定空间参考系统，地图将使用 <a href="#id27"><span class="problematic" id="id28">`</span></a>+proj=latlong +datum=WGS84`（即使用 WGS84 基准的未经投影的经纬度坐标）。</p>
<p>创建地图后，你可以设置地图的背景颜色，并通过调用 <cite>map.append_style()</cite> 方法将各种样式添加到地图中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;countryStyle&quot;</span><span class="p">,</span> <span class="n">countryStyle</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;roadStyle&quot;</span><span class="p">,</span> <span class="n">roadStyle</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;pointStyle&quot;</span><span class="p">,</span> <span class="n">pointStyle</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;rasterStyle&quot;</span><span class="p">,</span> <span class="n">rasterStyle</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>除了指定用于地图的背景颜色外，你还可以通过设置地图的 <cite>background_image</cite> 属性来使用背景图像。请注意，目前该属性接受字符串值，而不是 Mapnik 的 <cite>PathExpression</cite>，尽管未来可能会有所更改。</p>
<p>接下来，你需要在地图中创建各种层。为此，你创建一个 <cite>mapnik.Layer</cite> 对象来表示每个地图层:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">layerName</span><span class="p">,</span> <span class="n">srs</span><span class="p">)</span>
</pre></div>
</div>
<p>每个层都有一个唯一的名称，并且可以选择性地与空间参考（srs）关联。<cite>srs</cite> 字符串是 Proj.4 格式的初始化字符串；如果未提供空间参考，层将使用 <cite>+proj=latlong +datum=WGS84</cite>。</p>
<p>创建完地图层后，你需要为该层分配数据源，并选择将应用于该层的样式，通过名称标识每个样式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">myDatasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;countryStyle&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rasterStyle&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>最后，将新创建的层添加到地图中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</pre></div>
</div>
<p>接下来，让我们更详细地了解一下 <cite>Mapnik</cite> 的 <cite>Map</cite> 和 <cite>Layer</cite> 对象的一些可选方法和属性。这些方法和属性在操作地图层时非常有用，也可以帮助设置基于当前地图比例因子的选择性规则和层。</p>
</div>
<input class="tab-input" id="tab-set--50-input--2" name="tab-set--50" type="radio"><label class="tab-label" for="tab-set--50-input--2">英文</label><div class="tab-content docutils container">
<p>Once you have set up your data sources, symbolizers, rules and styles, you can
combine them into Mapnik layers and place the various layers together onto a map.
To do this, you first create a mapnik.Map object to represent the map as a whole:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">srs</span><span class="p">)</span>
</pre></div>
</div>
<p>You supply the width and height of the map image you want to generate, in pixels,
and an optional Proj.4-format initialization string in srs. If you do not specify
a spatial reference system, the map will use “+proj=latlong +datum=WGS84”
(unprojected lat/long coordinates on the WGS84 datum).</p>
<p>After creating the map, you set the map’s background color, and add your various
styles to the map by calling the map.append_style() method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;countryStyle&quot;</span><span class="p">,</span> <span class="n">countryStyle</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;roadStyle&quot;</span><span class="p">,</span> <span class="n">roadStyle</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;pointStyle&quot;</span><span class="p">,</span> <span class="n">pointStyle</span><span class="p">)</span>
<span class="nb">map</span><span class="o">.</span><span class="n">append_style</span><span class="p">(</span><span class="s2">&quot;rasterStyle&quot;</span><span class="p">,</span> <span class="n">rasterStyle</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>As well as specifying the background color to use for your
map, you can also use a background image by setting the
map’s background_image attribute. Note that this currently
accepts a string value, rather than a Mapnik PathExpression,
though this may change in the future.</p>
<p>You next need to create the various layers within the map. To do this, you create
a mapnik.Layer object to represent each map layer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">layerName</span><span class="p">,</span> <span class="n">srs</span><span class="p">)</span>
</pre></div>
</div>
<p>Each layer is given a unique name, and can optionally have a spatial reference
associated with it. The srs string is a Proj.4 format initialization string; if no
spatial reference is given, the layer will use “+proj=latlong +datum=WGS84”.</p>
<p>Once you have created your map layer, you assign it a datasource and choose the
style(s) which will apply to that layer, identifying each style by name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">layer</span><span class="o">.</span><span class="n">datasource</span> <span class="o">=</span> <span class="n">myDatasource</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;countryStyle&quot;</span><span class="p">)</span>
<span class="n">layer</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;rasterStyle&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Finally, you add your new layer to the map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s take a closer look at some of the optional methods and attributes of the Mapnik
Map and Layer objects. These can be useful when manipulating map layers, and for
setting up rules and layers which are selectively applied based on the map’s current
scale factor.</p>
</div>
</div>
<section id="id29">
<h3>地图属性和方法<a class="headerlink" href="#id29" title="此标题的永久链接">#</a></h3>
<p>Map attributes and methods</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--51-input--1" name="tab-set--51" type="radio"><label class="tab-label" for="tab-set--51-input--1">中文</label><div class="tab-content docutils container">
<p><cite>mapnik.Map</cite> 类提供了几个附加的方法和属性，你可能会觉得有用：</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>map.envelope()</strong></dt><dd><p>该方法返回一个 <cite>mapnik.Box2d</cite> 对象，表示将要显示的地图区域。<cite>mapnik.Box2d</cite> 对象支持许多有用的方法和属性，其中最重要的是包括 <cite>minx</cite>、<cite>miny</cite>、<cite>maxx</cite> 和 <cite>maxy</cite> 属性。这些属性定义了地图的边界框，以地图坐标表示。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>map.aspect_fix_mode = mapnik.aspect_fix.GROW_CANVAS</strong></dt><dd><p>这个属性控制当地图的边界的纵横比与渲染的地图图像的纵横比不匹配时，Mapnik 如何调整地图。支持以下值：</p>
<ul>
<li><p><em>GROW_BBOX</em>：扩展地图的边界框以匹配生成图像的纵横比。这是默认行为。</p></li>
<li><p><em>GROW_CANVAS</em>：扩展生成的图像以匹配边界框的纵横比。</p></li>
<li><p><em>SHRINK_BBOX</em>：缩小地图的边界框以匹配生成图像的纵横比。</p></li>
<li><p><em>SHRINK_CANVAS</em>：缩小生成的图像以匹配地图边界框的纵横比。</p></li>
<li><p><em>ADJUST_BBOX_HEIGHT</em>：扩展或缩小地图边界框的高度，同时保持宽度不变，以匹配生成图像的纵横比。</p></li>
<li><p><em>ADJUST_BBOX_WIDTH</em>：扩展或缩小地图边界框的宽度，同时保持高度不变，以匹配生成图像的纵横比。</p></li>
<li><p><em>ADJUST_CANVAS_HEIGHT</em>：扩展或缩小生成图像的高度，同时保持宽度不变，以匹配地图边界框的纵横比。</p></li>
<li><p><em>ADJUST_CANVAS_WIDTH</em>：扩展或缩小生成图像的宽度，同时保持高度不变，以匹配地图边界框的纵横比。</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>map.scale_denominator()</strong></dt><dd><p>返回生成地图时使用的当前比例分母。比例分母取决于地图的边界和渲染图像的大小。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>map.scale()</strong></dt><dd><p>返回地图使用的当前比例因子。比例因子取决于地图的边界和渲染图像的大小。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>map.zoom_all()</strong></dt><dd><p>设置地图的边界框，以涵盖每个地图层的边界框。这确保所有地图数据都会显示在地图上。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>map.zoom_to_box(mapnik.Box2d(minX, minY, maxX, maxY))</strong></dt><dd><p>将地图的边界框设置为给定的值。请注意，<cite>minX</cite>、<cite>minY</cite>、<cite>maxX</cite> 和 <cite>maxY</cite> 都是在地图的坐标系统中的值。</p>
</dd>
</dl>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--51-input--2" name="tab-set--51" type="radio"><label class="tab-label" for="tab-set--51-input--2">英文</label><div class="tab-content docutils container">
<p>The mapnik.Map class provides several additional methods and attributes which you may find useful:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">map.envelope()</span></code></dt><dd><p>This method returns a mapnik.Box2d object representing the area of the map that is to be displayed. The mapnik.Box2d object supports a number of useful methods and attributes, but most importantly includes minx, miny, maxx, and maxy attributes. These define the map’s bounding box in map coordinates.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">map.aspect_fix_mode</span> <span class="pre">=</span> <span class="pre">mapnik.aspect_fix.GROW_CANVAS</span></code></dt><dd><p>This controls how Mapnik adjusts the map if the aspect ratio of the map’s bounds does not match the aspect ratio of the rendered map image. The following values are supported:</p>
<ul>
<li><p><em>GROW_BBOX</em> expands the map’s bounding box to match the aspect ratio of the generated image. This is the default behavior.</p></li>
<li><p><em>GROW_CANVAS</em> expands the generated image to match the aspect ratio of the bounding box.</p></li>
<li><p><em>SHRINK_BBOX</em> shrinks the map’s bounding box to match the aspect ratio of the generated image.</p></li>
<li><p><em>SHRINK_CANVAS</em> shrinks the generated image to match the aspect ratio of the map’s bounding box.</p></li>
<li><p><em>ADJUST_BBOX_HEIGHT</em> expands or shrinks the height of the map’s bounding box, while keeping the width constant, to match the aspect ratio of the generated image.</p></li>
<li><p><em>ADJUST_BBOX_WIDTH</em> expands or shrinks the width of the map’s bounding box, while keeping the height constant, to match the aspect ratio of the generated image.</p></li>
<li><p><em>ADJUST_CANVAS_HEIGHT</em> expands or shrinks the height of the generated image, while keeping the width constant, to match the aspect ratio of the map’s bounding box.</p></li>
<li><p><em>ADJUST_CANVAS_WIDTH</em> expands or shrinks the width of the generated image, while keeping the height constant, to match the aspect ratio of the map’s bounding box.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">map.scale_denominator()</span></code></dt><dd><p>Returns the current scale denominator used to generate the map. The scale denominator depends on the map’s bounds and the size of the rendered image.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">map.scale()</span></code></dt><dd><p>Returns the current scale factor used by the map. The scale factor depends on the map’s bounds and the size of the rendered image.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">map.zoom_all()</span></code></dt><dd><p>Set the map’s bounding box to encompass the bounding box of each of the map’s layers. This ensures that all the map data will appear on the map.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">map.zoom_to_box(mapnik.Box2d(minX,</span> <span class="pre">minY,</span> <span class="pre">maxX,</span> <span class="pre">maxY))</span></code></dt><dd><p>Set the map’s bounding box to the given values. Note that minX, minY, maxX, and maxY are all in the map’s coordinate system.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
<section id="id30">
<h3>图层属性和方法<a class="headerlink" href="#id30" title="此标题的永久链接">#</a></h3>
<p>Layer attributes and methods</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--52-input--1" name="tab-set--52" type="radio"><label class="tab-label" for="tab-set--52-input--1">中文</label><div class="tab-content docutils container">
<p><cite>mapnik.Layer</cite> 类具有以下一些有用的属性和方法：</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>layer.envelope()</strong></dt><dd><p>该方法返回一个 <em>mapnik.Box2d</em> 对象，表示地图上包含所有图层数据的矩形区域。该对象具有 <cite>minx</cite>、<cite>miny</cite>、<cite>maxx</cite> 和 <cite>maxy</cite> 属性，存储图层边界框的坐标。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>layer.active = False</strong></dt><dd><p>这个属性可以用于隐藏地图中的某个图层。当图层的 <cite>active</cite> 属性设置为 <cite>False</cite> 时，该图层不会显示在地图上。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>layer.minzoom = 1.0/100000</strong></dt><dd><p>这个属性设置了图层的最小缩放比例因子，只有在图层满足该缩放比例时，才会在地图中显示。如果没有设置此属性，则图层没有最小缩放比例。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>layer.maxzoom = 1.0/10000</strong></dt><dd><p>这个属性设置了图层的最大缩放比例因子，只有在图层满足该缩放比例时，才会在地图上绘制。如果没有设置此属性，则图层没有最大缩放比例。</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>layer.visible(1.0/50000)</strong></dt><dd><p>该方法返回一个布尔值，指示图层在给定的缩放比例下是否可见。如果图层是活动的，且给定的缩放比例在指定的最小和最大值之间，则该图层是可见的。</p>
</dd>
</dl>
</li>
</ul>
</div>
<input class="tab-input" id="tab-set--52-input--2" name="tab-set--52" type="radio"><label class="tab-label" for="tab-set--52-input--2">英文</label><div class="tab-content docutils container">
<p>The mapnik.Layer class has the following useful attributes and methods:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">layer.envelope()</span></code></dt><dd><p>This method returns a <em>mapnik.Box2d</em> object representing the rectangular area of the map that encompasses all the layer’s data. This object has minx, miny, maxx, and maxy attributes that hold the coordinates for the layer’s bounding box.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">layer.active</span> <span class="pre">=</span> <span class="pre">False</span></code></dt><dd><p>This can be used to hide a layer within the map.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">layer.minzoom</span> <span class="pre">=</span> <span class="pre">1.0/100000</span></code></dt><dd><p>This sets the minimum scale factor which must apply if the layer is to appear within the map. If this is not set, the layer will not have a minimum scale factor.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">layer.maxzoom</span> <span class="pre">=</span> <span class="pre">1.0/10000</span></code></dt><dd><p>This sets the maximum scale factor that must apply if the layer is to be drawn onto the map. If this is not set, the layer will not have a maximum scale factor.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">layer.visible(1.0/50000)</span></code></dt><dd><p>This method returns true if this layer will appear on the map at the given scale factor. The layer is visible if it is active and the given scale factor is between the specified minimum and maximum values.</p>
</dd>
</dl>
</li>
</ul>
</div>
</div>
</section>
</section>
<section id="id31">
<h2>地图渲染<a class="headerlink" href="#id31" title="此标题的永久链接">#</a></h2>
<p>Map rendering</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--53-input--1" name="tab-set--53" type="radio"><label class="tab-label" for="tab-set--53-input--1">中文</label><div class="tab-content docutils container">
<p>在创建了 <cite>mapnik.Map</cite> 对象并设置了各个符号化器、规则、样式、数据源和图层之后，你就可以开始将地图渲染为图像。</p>
<p>在渲染地图图像之前，确保你已设置了适当的地图边界框，以便显示你感兴趣的区域。你可以通过调用 <cite>map.zoom_to_box()</cite> 显式地将地图的边界框设置为给定的坐标，或者调用 <cite>map.zoom_all()</cite> 让地图根据要显示的数据自动设置其边界。</p>
<p>一旦设置了边界框，你就可以通过调用 <cite>render_to_file()</cite> 函数来生成地图图像，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapnik</span><span class="o">.</span><span class="n">render_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="s1">&#39;map.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>此函数的参数为 <cite>mapnik.Map</cite> 对象和要写入地图的图像文件名称。如果你希望对图像格式进行更多控制，可以添加一个额外的参数来定义图像格式，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapnik</span><span class="o">.</span><span class="n">render_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="s1">&#39;map.png&#39;</span><span class="p">,</span> <span class="s1">&#39;png256&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>支持的图像格式包括：</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Image format</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>png</p></td>
<td><p>32位 PNG 格式图像</p></td>
</tr>
<tr class="row-odd"><td><p>png256</p></td>
<td><p>8位 PNG 格式图像</p></td>
</tr>
<tr class="row-even"><td><p>jpeg</p></td>
<td><p>JPEG 格式图像</p></td>
</tr>
<tr class="row-odd"><td><p>svc</p></td>
<td><p>SVG 格式图像</p></td>
</tr>
<tr class="row-even"><td><p>pdf</p></td>
<td><p>PDF 文件</p></td>
</tr>
<tr class="row-odd"><td><p>ps</p></td>
<td><p>Postscript 格式文件</p></td>
</tr>
</tbody>
</table>
</div>
<p><cite>render_to_file()</cite> 函数适用于你想从整个地图生成单个图像的情况。另一种有用的渲染地图方式是生成多个“瓦片”，然后将它们拼接在一起以显示更高分辨率的地图：</p>
<img alt="../_images/357-0.png" class="align-center" src="../_images/357-0.png" />
<p>Mapnik 提供了一个有用的函数，可以从单个地图生成像这样的小瓦片:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">render_tile_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">xOffset</span><span class="p">,</span> <span class="n">yOffset</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                        <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</pre></div>
</div>
<p>该函数的参数如下：</p>
<ul class="simple">
<li><p><em>map</em> 是包含地图数据的 <em>mapnik.Map</em> 对象</p></li>
<li><p><em>xOffset</em> 和 <em>yOffset</em> 定义了瓦片的左上角坐标（以地图坐标为单位）</p></li>
<li><p><em>width</em> 和 <em>height</em> 定义了瓦片的大小（以地图坐标为单位）</p></li>
<li><p><em>fileName</em> 是保存瓦片图像的文件名</p></li>
<li><p><em>format</em> 是用于保存此瓦片的文件格式</p></li>
</ul>
<p>你可以通过反复调用此函数来为地图生成各个瓦片。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TILES_ACROSS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TILES_DOWN</span><span class="p">):</span>
        <span class="n">xOffset</span> <span class="o">=</span> <span class="n">TILE_SIZE</span> <span class="o">*</span> <span class="n">x</span>
        <span class="n">yOffset</span> <span class="o">=</span> <span class="n">TILE_SIZE</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">tileName</span> <span class="o">=</span> <span class="s2">&quot;tile_</span><span class="si">%d</span><span class="s2">_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">mapnik</span><span class="o">.</span><span class="n">render_tile_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">xOffset</span><span class="p">,</span> <span class="n">yOffset</span><span class="p">,</span>
                                    <span class="n">TILE_SIZE</span><span class="p">,</span> <span class="n">TILE_SIZE</span><span class="p">,</span>
                                    <span class="n">tileName</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>另一种渲染地图的方式是使用 <cite>Mapnik.Image</cite> 对象将渲染后的地图数据保存在内存中。你可以通过如下方式提取 <cite>Image</cite> 对象中的原始图像数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">MAP_WIDTH</span><span class="p">,</span> <span class="n">MAP_HEIGHT</span><span class="p">)</span>
<span class="n">mapnik</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
<span class="n">imageData</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--53-input--2" name="tab-set--53" type="radio"><label class="tab-label" for="tab-set--53-input--2">英文</label><div class="tab-content docutils container">
<p>After creating your mapnik.Map object and setting up the various symbolizers, rules,
styles, data sources, and layers within it, you are finally ready to convert your map
into a rendered image.</p>
<p>Before rendering the map image, make sure that you have set the appropriate
bounding box for the map so that the map will show the area of the world you
are interested in. You can do this by either calling map.zoom_to_box() to explicitly
set the map’s bounding box to a given set of coordinates, or you can call map.
zoom_all() to have the map automatically set its bounds based on the data to
be displayed.</p>
<p>Once you have set the bounding box, you can generate your map image by calling
the render_to_file() function, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapnik</span><span class="o">.</span><span class="n">render_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="s1">&#39;map.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters are the mapnik.Map object and the name of the image file to write the
map to. If you want more control over the format of the image, you can add an extra
parameter, which defines the image format, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mapnik</span><span class="o">.</span><span class="n">render_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="s1">&#39;map.png&#39;</span><span class="p">,</span> <span class="s1">&#39;png256&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The supported image formats include the following:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Image format</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>png</p></td>
<td><p>A 32-bit PNG format image</p></td>
</tr>
<tr class="row-odd"><td><p>png256</p></td>
<td><p>An 8-bit PNG format image</p></td>
</tr>
<tr class="row-even"><td><p>jpeg</p></td>
<td><p>A JPEG-format image</p></td>
</tr>
<tr class="row-odd"><td><p>svc</p></td>
<td><p>An SVG-format image</p></td>
</tr>
<tr class="row-even"><td><p>pdf</p></td>
<td><p>A PDF file</p></td>
</tr>
<tr class="row-odd"><td><p>ps</p></td>
<td><p>A postscript format file</p></td>
</tr>
</tbody>
</table>
</div>
<p>The <em>render_to_file()</em> function works well when you want to generate a single image from your entire map. Another useful way of rendering maps is to generate a number of “tiles” which can then be stitched together to display the map at a higher resolution:</p>
<img alt="../_images/357-0.png" class="align-center" src="../_images/357-0.png" />
<p>Mapnik provides a helpful function for creating tiles like this out of a single map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">render_tile_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">xOffset</span><span class="p">,</span> <span class="n">yOffset</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                        <span class="n">fileName</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameters to this function are as follows:</p>
<ul class="simple">
<li><p><em>map</em> is the <em>mapnik.Map</em> object containing the map data</p></li>
<li><p><em>xOffset</em> and <em>yOffset</em> define the top-left corner of the tile, in map coordinates</p></li>
<li><p><em>width</em> and <em>height</em> define the size of the tile, in map coordinates</p></li>
<li><p><em>fileName</em> is the name of the file to save the tiled image into</p></li>
<li><p><em>format</em> is the file format to use for saving this tile</p></li>
</ul>
<p>You can simply call this function repeatedly to create the individual tiles for your map. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TILES_ACROSS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_TILES_DOWN</span><span class="p">):</span>
        <span class="n">xOffset</span> <span class="o">=</span> <span class="n">TILE_SIZE</span> <span class="o">*</span> <span class="n">x</span>
        <span class="n">yOffset</span> <span class="o">=</span> <span class="n">TILE_SIZE</span> <span class="o">*</span> <span class="n">y</span>
        <span class="n">tileName</span> <span class="o">=</span> <span class="s2">&quot;tile_</span><span class="si">%d</span><span class="s2">_</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">mapnik</span><span class="o">.</span><span class="n">render_tile_to_file</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">xOffset</span><span class="p">,</span> <span class="n">yOffset</span><span class="p">,</span>
                                   <span class="n">TILE_SIZE</span><span class="p">,</span> <span class="n">TILE_SIZE</span><span class="p">,</span>
                                   <span class="n">tileName</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Another way of rendering a map is to use a Mapnik.Image object to hold the
rendered map data in memory. You can then extract the raw image data from
the Image object, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">mapnik</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">MAP_WIDTH</span><span class="p">,</span> <span class="n">MAP_HEIGHT</span><span class="p">)</span>
<span class="n">mapnik</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
<span class="n">imageData</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="mapgenerator.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">重新审视 MapGenerator</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="creating.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">创建示例地图</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2025, Erik Westra
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Mapnik 深度介绍</a><ul>
<li><a class="reference internal" href="#id1">数据源</a><ul>
<li><a class="reference internal" href="#shapefile">Shapefile</a></li>
<li><a class="reference internal" href="#postgis">PostGIS</a></li>
<li><a class="reference internal" href="#gdal">Gdal</a></li>
<li><a class="reference internal" href="#ogr">Ogr</a></li>
<li><a class="reference internal" href="#sqlite">SQLite</a></li>
<li><a class="reference internal" href="#osm">OSM</a></li>
<li><a class="reference internal" href="#memorydatasource">MemoryDatasource</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">规则、过滤器和样式</a><ul>
<li><a class="reference internal" href="#id3">过滤器</a></li>
<li><a class="reference internal" href="#id4">比例分母</a></li>
<li><a class="reference internal" href="#else">“Else”规则</a></li>
<li><a class="reference internal" href="#also">“Also”规则</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">符号化器</a><ul>
<li><a class="reference internal" href="#id6">绘制线条</a><ul>
<li><a class="reference internal" href="#id7">线符号化器</a></li>
<li><a class="reference internal" href="#line-color">Line color</a></li>
<li><a class="reference internal" href="#line-width">Line width</a></li>
<li><a class="reference internal" href="#opacity">Opacity</a></li>
<li><a class="reference internal" href="#line-caps">Line caps</a></li>
<li><a class="reference internal" href="#line-joins">Line joins</a></li>
<li><a class="reference internal" href="#dashed-and-dotted-lines">Dashed and dotted lines</a></li>
<li><a class="reference internal" href="#drawing-roads-and-other-complex-linear-features">Drawing roads and other complex linear features</a></li>
<li><a class="reference internal" href="#linepatternsymbolizer">LinePatternSymbolizer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">绘制多边形</a><ul>
<li><a class="reference internal" href="#polygonsymbolizer">PolygonSymbolizer</a></li>
<li><a class="reference internal" href="#fill-color">Fill color</a></li>
<li><a class="reference internal" href="#id9">Opacity</a></li>
<li><a class="reference internal" href="#gamma-correction">Gamma correction</a></li>
<li><a class="reference internal" href="#polygonpatternsymbolizer">PolygonPatternSymbolizer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">绘制标签</a><ul>
<li><a class="reference internal" href="#textsymbolizer">TextSymbolizer</a></li>
<li><a class="reference internal" href="#id11">指定要显示的文本</a></li>
<li><a class="reference internal" href="#id12">选择合适的字体</a></li>
<li><a class="reference internal" href="#id13">绘制半透明文本</a></li>
<li><a class="reference internal" href="#id14">控制文本放置</a></li>
<li><a class="reference internal" href="#id15">重复标签</a></li>
<li><a class="reference internal" href="#id16">控制文本重叠</a></li>
<li><a class="reference internal" href="#id17">在深色背景上绘制文本</a></li>
<li><a class="reference internal" href="#id18">调整文本的位置</a></li>
<li><a class="reference internal" href="#id19">跨多行拆分标签</a></li>
<li><a class="reference internal" href="#id20">控制字符和行距</a></li>
<li><a class="reference internal" href="#id21">控制大写</a></li>
<li><a class="reference internal" href="#id22">高级文本放置和格式</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id23">绘制点</a><ul>
<li><a class="reference internal" href="#pointsymbolizer">PointSymbolizer</a></li>
<li><a class="reference internal" href="#shieldsymbolizer">ShieldSymbolizer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id24">绘制光栅图像</a></li>
<li><a class="reference internal" href="#id25">使用颜色</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id26">地图和图层</a><ul>
<li><a class="reference internal" href="#id29">地图属性和方法</a></li>
<li><a class="reference internal" href="#id30">图层属性和方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id31">地图渲染</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/translations.js"></script>
    </body>
</html>