<!doctype html>
<html class="no-js" lang="zh-CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="copyright" title="版权所有" href="../copyright.html" /><link rel="next" title="先决条件" href="prerequisites.html" /><link rel="prev" title="关于 ShapeEditor" href="about-shapeditor.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>设计 ShapeEditor - python地理空间开发 1.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyles.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">python地理空间开发 1.0 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">python地理空间开发 1.0 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">内容</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about_author.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about_reviewers.html">审稿人简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch1/index.html">1 使用 Python 进行地理空间开发</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch1/python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/geo_dev.html">地理空间开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/applications.html">地理空间开发的应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/recent_dev.html">最新动态</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch1/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch2/index.html">2 GIS</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch2/core_concepts.html">核心 GIS 概念</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/gis_data_format.html">GIS 数据格式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/working.html">手动处理 GIS 数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch2/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch3/index.html">3 用于地理空间开发的 Python 库</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch3/rw.html">读取和写入地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/dealing_proj.html">处理投影</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/analyzing.html">分析和处理地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/visualizing.html">可视化地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch3/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch4/index.html">4 地理空间数据来源</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch4/vector_format.html">矢量格式的地理空间数据来源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/raster_format.html">栅格格式地理空间数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/other_format.html">其他类型地理空间数据的来源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/choosing_format.html">选择地理空间数据源</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch4/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch5/index.html">5 使用 Python 处理地理空间数据</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch5/pre-req.html">先决条件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/rw.html">读取和写入地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/changing.html">更改基准和投影</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/representing.html">表示和存储地理空间数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/performing.html">执行地理空间计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/converting.html">转换和标准化几何和距离单位</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/exercises.html">练习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch5/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch6/index.html">6 数据库中的 GIS</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch6/spatially.html">空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/spatially-indexes.html">空间索引</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/open-source.html">支持空间功能的开源数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/commerical.html">商业空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/recommended.html">建议的最佳做法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/working.html">使用 Python 处理地理空间数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch6/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch7/index.html">7 使用空间数据</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch7/about-distal.html">关于 DISTAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/designing.html">设计和构建数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/downloading.html">下载数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/importing-data.html">导入数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/implementing.html">实现 DISTAL 应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/aplication.html">应用程序审查和改进</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch7/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch8/index.html">8 使用 Python 和 Mapnik 生成地图</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch8/introducing.html">Mapnik 简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/creating.html">创建示例地图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mapnik.html">Mapnik 深度介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mapgenerator.html">重新审视 MapGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/mapdefinition.html">地图定义文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch8/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">9 整合所有要素——完整的地图系统</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="about-shapeditor.html">关于 ShapeEditor</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">设计 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">先决条件</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-structure-ofdjango.html">Django 应用程序的结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="settingup-database.html">设置数据库</a></li>
<li class="toctree-l2"><a class="reference internal" href="settingup-shapeeditor.html">设置 ShapeEditor 项目</a></li>
<li class="toctree-l2"><a class="reference internal" href="defining-shapeditor.html">定义 ShapeEditor 的应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-shared.html">创建共享应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="defining-datamodel.html">定义数据模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="playing.html">玩转管理系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch10/index.html">10 ShapeEditor – 实现列表视图、导入和导出</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch10/implementing.html">实现“列出 Shapefile”视图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/importing.html">导入 Shapefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/exporting.html">导出 shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch10/summary.html">小结</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ch11/index.html">11 ShapeEditor – 选择和编辑特征</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ch11/selecting.html">选择要编辑的要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/editring.html">编辑要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/adding.html">添加要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/deleting.html">删除要素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/deleting-shapefiles.html">删除 shapefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/using.html">使用 ShapeEditor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/further.html">进一步改进和增强</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch11/summary.html">小结</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="shapeeditor">
<h1>设计 ShapeEditor<a class="headerlink" href="#shapeeditor" title="此标题的永久链接">#</a></h1>
<p>Designing ShapeEditor</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">中文</label><div class="tab-content docutils container">
<p>让我们深入了解 <strong>ShapeEditor</strong> 的各个部分，看看实现这些功能所涉及的内容。<strong>ShapeEditor</strong> 将支持以下活动：</p>
<ul class="simple">
<li><p>从 Shapefile 导入几何特征和属性</p></li>
<li><p>允许用户选择要编辑的特征</p></li>
<li><p>显示适当类型的编辑器，让用户编辑特征的几何形状</p></li>
<li><p>将几何特征和属性导出回 Shapefile</p></li>
</ul>
<p>接下来，我们将详细查看这些用户活动，了解它们在 <strong>ShapeEditor</strong> 系统中如何实现。</p>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">英文</label><div class="tab-content docutils container">
<p>Let’s take a closer look at the various parts of the ShapeEditor, to see what’s involved
in implementing it. The ShapeEditor is going to support the following activities:</p>
<ul class="simple">
<li><p>Importing the geometrical features and attributes from a shapefile</p></li>
<li><p>Allowing the user to select a feature to be edited</p></li>
<li><p>Displaying the appropriate type of editor to allow the user to edit the feature’s geometry</p></li>
<li><p>Exporting the geometrical features and attributes back into a shapefile</p></li>
</ul>
<p>Let’s take a closer look at each of these user activities, to see how they will be
implemented within the ShapeEditor system.</p>
</div>
</div>
<section id="shapefile">
<h2>导入 Shapefile<a class="headerlink" href="#shapefile" title="此标题的永久链接">#</a></h2>
<p>Importing a shapefile</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">中文</label><div class="tab-content docutils container">
<p>当用户导入一个 Shapefile 时，我们需要将该 Shapefile 的内容存储到数据库中，以便 GeoDjango 可以对其进行操作。由于我们事先无法知道 Shapefile 中会包含哪些类型的几何形状，或者每个特征可能关联的属性，因此我们需要在数据库中为 Shapefile 的内容提供一种通用的表示方式，而不是为 Shapefile 的每个属性定义单独的字段。为了支持这一点，我们将使用以下数据库对象集合：</p>
<img alt="../_images/375-0.png" class="align-center" src="../_images/375-0.png" />
<p>每个导入的 Shapefile 将通过一个单独的 <strong>Shapefile</strong> 对象在数据库中表示。每个 <strong>Shapefile</strong> 对象将拥有一组 <strong>Attribute</strong> 对象，这些对象定义了 Shapefile 中每个属性的名称和数据类型。<strong>Shapefile</strong> 对象还将拥有一组 <strong>Feature</strong> 对象，每个导入的特征对应一个 <strong>Feature</strong> 对象。<strong>Feature</strong> 对象将包含特征的几何形状，并且会包含一组 <strong>AttributeValue</strong> 对象，存储该特征每个属性的值。</p>
<p>为了更好地理解这一点，假设我们将 <strong>World Borders Dataset</strong> 导入到 <strong>ShapeEditor</strong> 中。该 Shapefile 的内容将在数据库中以以下方式存储：</p>
<img alt="../_images/376-0.png" class="align-center" src="../_images/376-0.png" />
<p>我们将使用一个 <strong>Shapefile</strong> 对象来表示上传的 Shapefile。该对象将关联多个 <strong>Attribute</strong> 对象，每个 <strong>Attribute</strong> 对象代表 Shapefile 中的一个属性。同时，Shapefile 还将关联多个 <strong>Feature</strong> 对象；每个特征的 <strong>MultiPolygon</strong> 几何形状将存储在相应的 <strong>Feature</strong> 对象中，而每个特征的属性将存储在一系列 <strong>AttributeValue</strong> 对象中。</p>
<p>尽管这种方式在数据库中存储 Shapefile 数据稍显间接（通常我们会使用 <strong>ogrinspect</strong> 管理命令根据 Shapefile 的特征和属性创建一个静态的 GeoDjango 模型），但我们必须这样做，因为我们无法预先知道 Shapefile 的结构，并且不希望每次导入一个 Shapefile 时都需要定义新的数据库表。</p>
<p>在这个基本的模型设计完成后，我们可以继续设计其余的“导入 Shapefile”逻辑。</p>
<p>由于 Shapefile 在磁盘上由多个单独的文件表示，我们将期望用户将 Shapefile 打包成一个 ZIP 压缩文件并上传该压缩包。这样我们就不需要处理多个文件上传的问题，并且对用户来说也更为方便，因为 Shapefile 通常已经是 ZIP 格式的。</p>
<p>一旦 ZIP 压缩包上传完成，我们的代码将需要解压该压缩包并提取构成 Shapefile 的单个文件。然后，我们需要读取 Shapefile 来找出其属性，创建适当的 <strong>Attribute</strong> 对象，然后逐个处理 Shapefile 的特征，创建 <strong>Feature</strong> 和 <strong>AttributeValue</strong> 对象。这一过程的实现会相当简单。</p>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">英文</label><div class="tab-content docutils container">
<p>When the user imports a shapefile, we have to store the contents of that shapefile
in the database so that GeoDjango can work with it. Because we don’t know in
advance what types of geometries the shapefile will contain, or what attributes
might be associated with each feature, we need to have a generic representation
of a shapefile’s contents in the database rather than defining separate fields in
the database for each of the shapefile’s attributes.To support this, we’ll use the
following collection of database objects:</p>
<img alt="../_images/375-0.png" class="align-center" src="../_images/375-0.png" />
<p>Each imported shapefile will be represented by a single Shapefile object in the
database. Each Shapefile object will have a set of Attribute objects, which define
the name and data type for each attribute within the shapefile. The Shapefile object
will also have a set of Feature objects, one for each imported feature. The Feature
object will hold the feature’s geometry, and will in turn have a set of AttributeValue
objects, holding the value of each attribute for that feature.</p>
<p>To see how this works, let’s imagine that we import the World Borders Dataset into
the ShapeEditor. The contents of this shapefile would be stored in the database in
the following way:</p>
<img alt="../_images/376-0.png" class="align-center" src="../_images/376-0.png" />
<p>We will use a <em>Shapefile</em> object to represent the uploaded shapefile. This object
will have a number of <em>Attribute</em> objects associated with it, one for each of the
shapefile’s attributes. There are also a number of <em>Feature</em> objects associated with
the shapefile; the MultiPolygon geometry for each feature will be stored in the
<em>Feature</em> object itself, while the attributes for each feature will be stored in a
series of <em>AttributeValue</em> objects.</p>
<p>While this is a somewhat roundabout way of storing shapefile data in a database
(it would be more common to use the <em>ogrinspect</em> management command to create
a static GeoDjango model out of the shapefile’s features and attributes), we have to
do it this way because we don’t know the shapefile’s structure ahead of time, and
don’t want to have to define a new database table whenever a shapefile is imported.</p>
<p>With this basic model in place to represent a shapefile’s data in the database, we can
continue designing the rest of the “Import Shapefile” logic.</p>
<p>Because shapefiles are represented on disk by a number of separate files, we will
expect the user to create a ZIP archive out of the shapefile and upload the zipped
shapefile. This saves us having to handle multiple file uploads for a single shapefile,
and makes things more convenient for the user as shapefiles often come in ZIP
format already.</p>
<p>Once the ZIP archive has been uploaded, our code will need to decompress the
archive and extract the individual files that make up the shapefile. We’ll then
have to read through the shapefile to find its attributes, create the appropriate
<em>Attribute</em> objects, and then process the shapefile’s features one at a time,
creating <em>Feature</em> and <em>AttributeValue</em> objects as we go. All of this will be
quite straightforward to implement.</p>
</div>
</div>
</section>
<section id="id1">
<h2>选择要素<a class="headerlink" href="#id1" title="此标题的永久链接">#</a></h2>
<p>Selecting a feature</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">中文</label><div class="tab-content docutils container">
<p>在用户能够编辑特征之前，我们必须让用户选择该特征。不幸的是，GeoDjango 的内置滑动地图接口并不支持通过点击来选择特征。这是因为 GeoDjango 只能一次性显示单个特征，得益于 GeoDjango 的几何字段实现方式。</p>
<p>GeoDjango 应用程序通常允许你通过显示一个属性列表（例如，城市名称）来选择一个特征，然后让用户从中选择特征。不幸的是，这对于我们来说也行不通。由于 ShapeEditor 允许用户导入任何 Shapefile，因此不能保证 Shapefile 的属性值能够用于选择特征。可能有的 Shapefile 根本没有属性，或者具有对最终用户毫无意义的属性——或者相反，可能有数十个属性。我们无法知道应该显示哪个属性，甚至无法确定是否有合适的属性可以用来选择特征。因此，我们在选择要编辑的特征时，实际上无法使用属性。</p>
<p>我们将采取完全不同的方法。我们将绕过 GeoDjango 内置的编辑器，而是直接使用 OpenLayers 来显示包含所有导入 Shapefile 特征的地图。然后，我们将让用户在地图中点击某个特征来选择它进行编辑。</p>
<p>以下是我们将如何实现这个功能的方式：</p>
<img alt="../_images/378-0.png" class="align-center" src="../_images/378-0.png" />
<p>OpenLayers 需要一个地图切片源来进行显示，因此我们将创建一个简单的 <strong>Tile Map Server (TMS)</strong>，它基于 Mapnik 渲染器来显示存储在数据库中的 Shapefile 特征。我们还将编写一个简单的 JavaScript “点击处理器”，拦截地图上的点击事件，并通过 AJAX 请求将点击信息发送到服务器，以查看用户点击的是哪个特征。如果用户确实点击了一个特征（而不仅仅是点击了地图的背景），用户的网页浏览器将被重定向到“编辑特征”页面，以便用户能够编辑所点击的特征。</p>
<p>这里涉及的内容较多，需要编写相当多的自定义代码，但最终结果是一个用户友好的 ShapeEditor 界面，允许用户通过简单的点击选择要编辑的特征。在构建这个功能的过程中，我们还将学习如何在 GeoDjango 应用程序中直接使用 OpenLayers，并如何实现基于 Mapnik 的自定义 Tile Map Server。</p>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">英文</label><div class="tab-content docutils container">
<p>Before the user can edit a feature, we have to let the user select that feature.
Unfortunately, GeoDjango’s build-in slippy map interface won’t allow us to select a
feature by clicking on it. This is because GeoDjango can only display a single feature
on a map at once, thanks to the way GeoDjango’s geometry fields are implemented.</p>
<p>The usual way a GeoDjango application allows you to select a feature is by
displaying a list of attributes (for example, city names) and then allowing the user to
choose a feature from that list. Unfortunately, that won’t work for us either. Because
the ShapeEditor allows the user to import any shapefile, there’s no guarantee that the
shapefile’s attribute values can be used to select a feature. It may be that a shapefile
has no attributes at all, or has attributes that mean nothing to the end user—or,
conversely has dozens of attributes. There is no way of knowing which attribute to
display, or even if there is a suitable attribute that can be used to select a feature.
Because of this, we really can’t use attributes when selecting the feature to edit.</p>
<p>We’re going to take a completely different approach. We will bypass GeoDjango’s
built-in editor and instead use OpenLayers directly to display a map showing all
the features in the imported shapefile. We’ll then let the user click on a feature
within the map to select it for editing.</p>
<p>Here is how we’ll implement this particular feature:</p>
<img alt="../_images/378-0.png" class="align-center" src="../_images/378-0.png" />
<p>OpenLayers needs to have a source of map tiles to display, so we’ll create our own
simple <strong>Tile Map Server (TMS)</strong> built on top of a Mapnik-based map renderer to
display the shapefile’s features stored in the database. We’ll also write a simple “click
handler” in JavaScript that intercepts clicks on the map and sends off an AJAX request
to the server to see which feature the user clicked on. If the user does click on a feature
(rather than just clicking on the map’s background), the user’s web browser will be
redirected to the “Edit Feature” page so that the user can edit the clicked-on feature.</p>
<p>There’s a lot here, requiring a fair amount of custom coding, but the end result is
a friendly interface to the ShapeEditor, allowing the user to simply point-and-click
at a desired feature to edit it. In the process of building all this, we’ll also learn how
to use OpenLayers directly within a GeoDjango application, and how to implement
our own Tile Map Server built on top of Mapnik.</p>
</div>
</div>
</section>
<section id="id2">
<h2>编辑要素<a class="headerlink" href="#id2" title="此标题的永久链接">#</a></h2>
<p>Editing a feature</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">中文</label><div class="tab-content docutils container">
<p>为了让用户编辑特征，我们将使用 GeoDjango 的内置几何编辑小部件。这里需要做一些工作，因为我们希望在 GeoDjango 的管理界面之外使用该小部件，因此需要对界面进行一些自定义。</p>
<p>唯一需要解决的另一个问题是，我们无法提前知道将要编辑的特征类型。Shapefiles 可以包含任何类型的几何体，从点（Points）和线（LineStrings）到多边形集合（MultiPolygons）和几何集合（GeometryCollections）。幸运的是，Shapefile 中的所有特征必须具有相同的几何类型，因此我们可以将几何类型存储在 Shapefile 对象中，并在编辑该 Shapefile 的特征时，使用它来选择适当类型的编辑器。</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">英文</label><div class="tab-content docutils container">
<p>To let the user edit the feature, we’ll use GeoDjango’s built-in geometry editing
widget. There is a slight amount of work required here, because we want to use
this widget outside of GeoDjango’s admin interface and will need to customize
the interface slightly.</p>
<p>The only other issue that needs to be dealt with is the fact that we don’t know
in advance what type of feature we’ll be editing. Shapefiles can hold any type
of geometry, from Points and LineStrings through to MultiPolygons and
GeometryCollections. Fortunately, all the features in a shapefile have to have
the same geometry type, so we can store the geometry type in the Shapefile
object, and use it to select the appropriate type of editor when editing that
shapefile’s features.</p>
</div>
</div>
</section>
<section id="id3">
<h2>导出 Shapefile<a class="headerlink" href="#id3" title="此标题的永久链接">#</a></h2>
<p>Exporting a shapefile</p>
<div class="tab-set docutils container">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">中文</label><div class="tab-content docutils container">
<p>导出 Shapefile 涉及到 “导入 Shapefile” 过程的逆操作：我们需要在磁盘上创建一个新的 Shapefile，定义将存储在 Shapefile 中的各种属性，然后处理所有的特征及其属性，写入到 Shapefile 中。一旦完成这一步，我们可以从 Shapefile 的内容创建一个 ZIP 存档，并告诉用户的 Web 浏览器下载该 ZIP 存档到用户的硬盘。</p>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">英文</label><div class="tab-content docutils container">
<p>Exporting a shapefile involves the reverse of the “Import Shapefile” process: we have
to create a new shapefile on disk, define the various attributes that will be stored
in the shapefile, and then process all the features and their attributes, writing them
out to the shapefile. Once this has been done, we can create a ZIP archive from the
contents of the shapefile, and tell the user’s web browser to download that ZIP
archive to the user’s hard disk.</p>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="prerequisites.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">先决条件</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="about-shapeditor.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">关于 ShapeEditor</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2025, Erik Westra
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">设计 ShapeEditor</a><ul>
<li><a class="reference internal" href="#shapefile">导入 Shapefile</a></li>
<li><a class="reference internal" href="#id1">选择要素</a></li>
<li><a class="reference internal" href="#id2">编辑要素</a></li>
<li><a class="reference internal" href="#id3">导出 Shapefile</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/translations.js"></script>
    </body>
</html>